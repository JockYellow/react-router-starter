## Routes Dump (20251124_141707)
專案根目錄：D:\CloudflarePage\react-router-starter\

## Root: D:\CloudflarePage\react-router-starter\app
### 檔案清單（相對 D:\CloudflarePage\react-router-starter\）
app\app.css
app\components\DevMenu.tsx
app\content\blog\categories.json
app\content\blog\posts\2025-02-05-color-palette.json
app\content\blog\posts\2025-02-10-workers-routing.json
app\content\blog\posts\2025-11-18-post-mi4alit2-u8dbwy.json
app\content\blog\posts\2025-11-18-post-mi4f16ip-egcwkp.json
app\content\blog\posts\2025-11-20-post-mi7a5anc.json
app\content\blog\posts\2025-11-20-post-mi7a9fyv.json
app\content\changelog\2025-11-12-update.json
app\content\changelog\2025-11-13-update.json
app\content\changelog\2025-11-14-update.json
app\content\changelog\2025-11-18-blog.json
app\content\changelog\2025-11-20-blog.json
app\content\changelog\2025-11-21-update.json
app\content\changelog\2025-11-24-update.json
app\entry.server.tsx
app\lib\admin-auth.server.ts
app\lib\blog-accent.ts
app\lib\blog.d1.server.ts
app\lib\blog.server.ts
app\lib\blog.types.ts
app\lib\changelog.server.ts
app\lib\d1.server.ts
app\lib\image-processing.server.ts
app\lib\r2.server.ts
app\root.tsx
app\routes.ts
app\routes\_index.tsx
app\routes\about.tsx
app\routes\admin.blog-edit.tsx
app\routes\admin.login.tsx
app\routes\admin.tsx
app\routes\api.blog-post.tsx
app\routes\blog.$slug.tsx
app\routes\blog.tsx
app\routes\changelog.tsx
app\routes\outerspace\Gravity.tsx
app\routes\outerspace\index.tsx
app\routes\outerspace\OuterSpaceSenter.tsx
app\routes\outerspace\PokeAPIcreatures.tsx

---
### app\app.css
```css
/* app/app.css */
@import "tailwindcss" source(".");

/* === Design Tokens === */
@theme {
  --font-sans:
    "Inter", ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
    "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";

  /* brand colors */
  --color-brand-50:  #FFF7E1;
  --color-brand-100: #FBEFC8;
  --color-brand-200: #F1E2A4;
  --color-brand-300: #E8C872; /* 主黃 */
  --color-brand-400: #D9B45A;
  --color-brand-500: #B9923E;
  --color-brand-600: #8B6C26;

  --color-accent-50:  #F8F5FF;
  --color-accent-100: #EDE8FE;
  --color-accent-200: #DAD3FA;
  --color-accent-300: #BFB4EE;
  --color-accent-400: #7A6AAE; /* 主紫 */
  --color-accent-500: #6B5CA0;
  --color-accent-600: #4C3D81;

  --color-module-hero:     #FFEAC5;
  --color-module-about:    #F6DFFF;
  --color-module-skills:   #DDEBFF;
  --color-module-projects: #DDF8EF;
  --color-module-contact:  #FFE0D9;

  --color-warm-0:   #FFFFFF;
  --color-warm-25:  #FDFCFB;
  --color-warm-50:  #F6F5F2; /* 背景暖白 */
  --color-warm-100: #EEECE6;

  /* radii / shadow */
  --radius-card: 1rem;     /* 16px */
  --shadow-soft: 0 6px 18px rgba(20, 10, 0, 0.06);
  --shadow-hover: 0 10px 26px rgba(20, 10, 0, 0.08);
}

/* === Base === */
html, body {
  color: #1E1B16;
  background:
    radial-gradient(circle at top left, rgba(255, 244, 209, 0.8), rgba(255, 244, 209, 0) 55%),
    radial-gradient(circle at 80% 20%, rgba(219, 208, 253, 0.7), rgba(219, 208, 253, 0) 60%),
    var(--color-warm-50);
  font-family: var(--font-sans);
  @media (prefers-color-scheme: dark) {
    color-scheme: dark;
  }
}
html { scroll-behavior: smooth; }

/* 區塊統一間距與標題 */
.section { @apply py-14 md:py-20; }
.section-title {
  @apply text-2xl md:text-3xl font-semibold tracking-tight text-neutral-900 flex items-center gap-3;
}
.section-title::before {
  content: "";
  width: 40px;
  height: 4px;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--color-accent-500), var(--color-brand-400));
  display: inline-block;
}
.eyebrow {
  letter-spacing: 0.24em;
  text-transform: uppercase;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--color-accent-600);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}
.eyebrow::before {
  content: "";
  width: 18px;
  height: 1px;
  background: currentColor;
  opacity: 0.6;
}

.module-panel {
  --module-color: var(--color-warm-0);
  position: relative;
  border-radius: 1.75rem;
  padding: clamp(1.75rem, 4vw, 3rem);
  background: color-mix(in oklab, var(--module-color) 85%, white);
  border: 1px solid color-mix(in oklab, var(--module-color) 50%, #6B5CA0 8%);
  box-shadow: 0 30px 70px rgba(17, 12, 5, 0.08);
  overflow: hidden;
}
.module-panel::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(circle at 80% 0%, rgba(255,255,255,0.9), transparent 45%);
  mix-blend-mode: screen;
  opacity: 0.4;
}
.module-panel > * { position: relative; z-index: 1; }
.module-hero { --module-color: var(--color-module-hero); }
.module-about { --module-color: var(--color-module-about); }
.module-skills { --module-color: var(--color-module-skills); }
.module-projects { --module-color: var(--color-module-projects); }
.module-contact { --module-color: var(--color-module-contact); }
.animate-room-in {
  animation: room-in 420ms ease both;
  transform-origin: center;
}
/* Sticky tab shell for homepage */
.sticky-tabs-shell {
  background:
    radial-gradient(circle at 20% 40%, rgba(255,244,209,0.6), transparent 45%),
    radial-gradient(circle at 80% 0%, rgba(216,201,255,0.55), transparent 40%),
    linear-gradient(180deg, rgba(255,255,255,0.88), rgba(255,255,255,0.6));
  backdrop-filter: blur(18px);
  border-bottom: 1px solid rgba(0,0,0,0.04);
  box-shadow: 0 12px 32px rgba(50,35,15,0.08);
  border-radius: 0 0 24px 24px;
  position: relative;
}
@media (prefers-color-scheme: dark) {
  .sticky-tabs-shell {
    background:
      radial-gradient(circle at 20% 40%, rgba(124,96,180,0.22), transparent 38%),
      radial-gradient(circle at 80% 0%, rgba(114,168,220,0.22), transparent 32%),
      linear-gradient(180deg, rgba(26,26,30,0.9), rgba(26,26,30,0.8)),
      rgba(26,26,30,0.82);
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
}
.sticky-tabs {
  gap: 0.6rem;
  justify-content: flex-start;
}
@keyframes room-in {
  from {
    opacity: 0;
    transform: translateX(12px) scale(0.985);
  }
  to {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}
.module-meta {
  @apply text-sm text-neutral-600;
  opacity: 0.9;
}

/* === Components === */
@layer components {
  .card {
    border-radius: calc(var(--radius-card) * 1.1);
    box-shadow: 0 18px 38px rgba(26, 19, 6, 0.08);
    @apply bg-white/95 border border-[color:rgba(0,0,0,0.08)] p-6 transition-shadow;
  }
  .card:hover { box-shadow: var(--shadow-hover); }

  .input {
    @apply w-full rounded-md border border-neutral-300 bg-white px-3 py-2 outline-none
           focus:ring-2 focus:ring-[--color-accent-200] focus:border-[--color-accent-400];
  }

  /* 移除 @apply btn，直接展開 utility（這樣 Tailwind 才不會報 unknown utility） */
  .btn-primary {
    @apply inline-flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition text-neutral-900;
    background: linear-gradient(180deg, var(--color-brand-200), var(--color-brand-300));
    box-shadow: 0 1px 0 rgba(255,255,255,.6) inset, 0 6px 16px rgba(185,146,62,.18);
  }
  .btn-primary:hover {
    background: linear-gradient(180deg, var(--color-brand-200), var(--color-brand-400));
  }

  .btn-ghost {
    @apply inline-flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition text-[--color-accent-500] bg-[color:transparent] hover:bg-[--color-accent-50];
    border: 1px solid var(--color-accent-200);
  }

  .link-soft {
    @apply text-[--color-accent-500] hover:text-[--color-accent-400] underline-offset-4 hover:underline;
  }

  .chip {
    @apply inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs;
    background: color-mix(in oklab, var(--color-accent-50) 70%, white);
    border: 1px solid var(--color-accent-200);
    color: var(--color-accent-500);
  }

  /* 細分隔線：比實線更柔和 */
  .divider {
    background: linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent);
    height: 1px;
  }

  .stat-pill {
    @apply inline-flex flex-col rounded-2xl px-4 py-3 text-xs uppercase tracking-[0.25em] font-semibold text-neutral-800;
    border: 1px solid rgba(0,0,0,0.08);
    background: rgba(255,255,255,0.45);
    backdrop-filter: blur(6px);
  }

  .skill-card {
    border-radius: 1.25rem;
    padding: 1.5rem;
    background: rgba(255,255,255,0.7);
    border: 1px solid rgba(123,106,174,0.15);
    box-shadow: 0 10px 25px rgba(17, 14, 12, 0.08);
    transition: transform .2s ease, box-shadow .2s ease;
  }
  .skill-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 18px 38px rgba(17, 14, 12, 0.12);
  }

  .hover-raise { transform: translateY(0); transition: transform .2s ease, box-shadow .2s ease; }
  .hover-raise:hover { transform: translateY(-2px); box-shadow: var(--shadow-hover); }
}

```

---
### app\components\DevMenu.tsx
```tsx
import { useEffect, useRef, useState } from "react";

/**
 * 隱藏的管理入口：
 * - 本機 DEV 自動顯示（加速開發）
 * - 非 DEV：在右下角隱藏熱區「連點 5 下」→ 跳出密碼 prompt →
 *   密碼正確即解鎖並記錄於 localStorage，之後同瀏覽器都會顯示。
 *
 * 注意：這不是嚴格安全機制，僅用於避免一般訪客看到入口。
 * 建議將密碼設在環境變數 `VITE_ADMIN_PASS`（或預設 "letmein"）。
 */
export default function DevMenu() {
  const [show, setShow] = useState(false);
  const [isLocal, setIsLocal] = useState(false);
  const tapCount = useRef(0);
  const tapTimer = useRef<number | null>(null);

  const handleSecretTap = () => {
    tapCount.current += 1;
    if (tapTimer.current) {
      window.clearTimeout(tapTimer.current);
    }
    tapTimer.current = window.setTimeout(() => {
      tapCount.current = 0;
    }, 1600);

    if (tapCount.current >= 5) {
      tapCount.current = 0;
      localStorage.setItem("showAdminMenu", "1");
      setShow(true);
    }
  };

  useEffect(() => {
    const stored = localStorage.getItem("showAdminMenu") === "1";
    const host = window.location.hostname;
    const isLocalHost =
      host === "localhost" ||
      host === "127.0.0.1" ||
      host.startsWith("192.168.") ||
      host.startsWith("10.");

    setIsLocal(import.meta.env.DEV || isLocalHost);

    if (import.meta.env.DEV || isLocalHost || stored) {
      setShow(true);
    }
    return () => {
      if (tapTimer.current) window.clearTimeout(tapTimer.current);
    };
  }, []);

  return (
    <>
      {/* 右下角隱藏熱區：點擊 5 下觸發密碼驗證 */}
      <button
        type="button"
        aria-label="Admin unlock area"
        onClick={handleSecretTap}
        className="fixed bottom-4 right-4 h-10 w-10 opacity-0"
        style={{ zIndex: 40 }}
      />

      {show && (
        <div className="fixed bottom-4 right-4 z-50">
          {isLocal ? (
            <a
              href="http://127.0.0.1:43210/admin/"
              className="px-4 py-2 rounded-xl shadow-md bg-black/80 text-white text-sm hover:bg-black"
            >
              管理後台
            </a>
          ) : (
            <a
              href="/admin"
              title="Blog 管理"
              className="flex h-10 w-10 items-center justify-center rounded-full bg-black/80 text-white text-lg shadow-md hover:bg-black"
            >
              ✎
            </a>
          )}
        </div>
      )}
    </>
  );
}

```

---
### app\content\blog\categories.json
```json
{
  "categories": [
    {
      "id": "edge",
      "title": "Edge 筆記",
      "description": "Workers 與邊緣部署心得。",
      "children": [
        {
          "id": "edge-routing",
          "title": "Routing"
        },
        {
          "id": "edge-observability",
          "title": "Observability"
        }
      ]
    },
    {
      "id": "design",
      "title": "Design System",
      "description": "色彩、Token 與 UI 演進。",
      "children": [
        {
          "id": "design-color",
          "title": "Color"
        },
        {
          "id": "design-system",
          "title": "System"
        }
      ]
    },
    {
      "id": "cat-mi4akefj-9chrlz",
      "title": "旅行",
      "description": "想成為興趣 但現實不允",
      "children": [
        {
          "id": "2024",
          "title": "2024美國行"
        }
      ]
    },
    {
      "id": "cat-mi4f0f4z-urks8l",
      "title": "日記",
      "description": "純純的文字欲",
      "children": [
        {
          "id": "subcat-mi4f100p-htiheo",
          "title": "樹洞"
        },
        {
          "id": "subcat-mi7a8xcl-hlv5sb",
          "title": "還在內耗",
          "description": "總在反省的時候"
        }
      ]
    },
    {
      "id": "cat-mi7a5z88-81296v",
      "title": "短思還在想",
      "description": "我想到聽到什麼一句話",
      "children": [
        {
          "id": "subcat-mi7a6mc2-gyhglj",
          "title": "野生銘誌"
        }
      ]
    }
  ]
}

```

---
### app\content\blog\posts\2025-02-05-color-palette.json
```json
{
  "title": "Token 化的色彩混合",
  "body": "將 UI token 與 CSS variables 調校成兩組色盤，\n在深色背景也能維持柔和節奏。\n同步記錄了 Figma plugin 的測試心得。\n以上都是假的 並沒有",
  "categoryId": "design",
  "subcategoryId": "design-color",
  "publishedAt": "2025-02-05T06:00:00.000Z",
  "slug": "color-palette"
}

```

---
### app\content\blog\posts\2025-02-10-workers-routing.json
```json
{
  "title": "Workers x React Router Routing 策略",
  "body": "這次把 React Router v7 loader 與 Workers KV 快取重新整理，\n從 Route Manifest 到 Edge 服務端渲染都記錄下來。\n也練習在 DevTools 觀察 WSS streaming 的效能。",
  "categoryId": "edge",
  "subcategoryId": "edge-routing",
  "publishedAt": "2025-02-09T19:00:00.000Z",
  "slug": "workers-routing"
}

```

---
### app\content\blog\posts\2025-11-18-post-mi4alit2-u8dbwy.json
```json
{
  "title": "出發前的逃避是最危險的距離",
  "body": "回顧我的旅行。\n\n很久沒有出國了，而且還是去往美國，一個總在電視上遙望的國度。\n\n只少，到了現場才驚覺，這個世界比想像中的還近。\n\n熟悉而陌生的文化、一目目不該習以為常的景色，映照在眼裡，勾起記憶中的片片文化。\n\n要從哪裡細數? 從小的”卡通”，偶而瞥見的美劇，廢寢忘食的美式情景喜劇，還有一部部如數家珍的電影。\n\n雖然那時，所謂版權意識只存在片頭的警告中，後續就會被詭異的、跑到鏡頭前的黑影給遮住了。看著所謂先行版、高清版、超清版、韓語無字版等等，可疑的讓人忘記自己在看電影，彷彿縮於一禺的再看一些糟糕的東西。(當然，現在知道那些糟糕並無差異。)\n\n扯遠了，對於美國的追憶我想接下來還有好大的段落可以不斷穿插，拉回來說這次的旅遊預備。必須說，我所投注的心力真的蠻少的，事前幾乎沒有什麼進行行程規劃，唯一出的意見－\"優勝美地\"。過去的成本又高的離譜，要翻山越嶺才有辦法。 以我對於旅程的掌控程度來說，這一次的可以說是”零”。 至於為什麼會造成這樣的怠惰，回顧一下我自己在旅遊的時候，確實，只要是有旅伴的，我幾乎都懶得安排，也不是沒有毛起來當導遊過，但....就感覺蠻累的，而且與其嘗試搜盡資訊來與自己的期待碰撞，我想，我內心有著潛意識告訴自己，那不如不帶預期的去體驗吧！當然，也不否認，就是我懶罷。\n\n我這次，真的已經很早就報備父母了，但鄰近時地提及，自然還是帶給他們”驚喜”。但我想，最大的驚喜，還是留給了我的另一個家－教會。\n\n很難忘記，前一周大家緊鑼密鼓的排演，準備盛大的迎來又一次的農會表演。回顧這個活動，我從不認為自己是重要主角，但也確實，再次次的活動中，被慢慢賦予了一些定位，兒主之友、收線特派員、搬運弟兄組等等。這些不起眼卻又實實在在貢獻的角色，尤其看著其他無名肢體的默默付出，一種感動與使命讓我也產生了捨我其誰的錯覺。\n\n我在排定這場旅遊時，我有沒有想到呢 ? 肯定沒有！　但是隨著時間臨近，大概是兩到三個月的時候，我發現怎麼算、好像都沒辦法避開，那復活的節日。天啊，這下到底該怎麼辦？\n\n逃避雖然沒用，但是可以騙過自己，看著日子漸漸地近了，手機拿起來滑開了主德哥的訊息位置，但也依然沒有勇氣坦承。＂下一次見面、下一周、回家後就用訊息＂，一次次的拖延，將石頭漸漸推上高峰。走在逃避的路線中，終究會遇上盡頭。而盡頭，是最溫暖、最洞悉人的師母，我想，這就上帝他的仁慈，用最溫柔的鋼索，漸漸嵌入我的皮膚之中。\n\n＂下周也要麻煩您支援兒主囉！，所以請你也要記得來參加早崇拜。＂隨著師母的詢問，顯然這路已經到了盡頭，隱瞞的控訴已經是最高的罪行，我不可能讓更多的謊言建築在我的家中。\n\n＂我下周要出去玩＂，我說的很輕描淡寫，而隨著師母笑著問話，才發現這一切案情並不單純，眼前這小子不只是知情未報，甚至逃避的讓人吃驚了！整整快兩周的行程，竟壓到最後一刻才要鬆口。\n\n＂要我幫你跟主德哥說嗎？＂我當時依然故作堅強的說＂不用＂。再被叮嚀著要好好聚會後，我竟帶著微微的舒坦離開，就好像我自己已經努力過了、做了什麼似的。並沒有！\n\n我還是高估了我自己的堅決，或說低估自己的無能。直到在機場的一通電話，我的罪惡感才爆發。",
  "categoryId": "cat-mi4akefj-9chrlz",
  "subcategoryId": "2024",
  "publishedAt": "2025-11-17T17:00:00.000Z",
  "slug": "post-mi4alit2-u8dbwy"
}

```

---
### app\content\blog\posts\2025-11-18-post-mi4f16ip-egcwkp.json
```json
{
  "title": "面對錯誤/訊息嗎",
  "body": "手機又留有好幾則未回的訊息\n\n統編忘記檢查、新窗口還沒連繫、錯誤訊息還沒說明、新的會議還沒約….\n\n好想要無視阿!!!\n\n每個提問都有可能是隱藏的缺失，一隻隻箭在朝我射來的路上，我還要打開來被刺成刺蝟嗎?\n\n說我不愛回訊息，但其實我話超多的，根本不怕跟別人溝通。\n\n所謂的不回，是物理上的無視與心理上的不適。\n\n無視、無謂、無法\n\n慢慢將他放到過期，然後就…\n\n“哎呀 我忘記了”\n\n但怎麼可能忘記呢? 最後還是從小本本上被更多代辦事項壓到最底下而已\n\n緊急的狀態等級已經到極限了，驚嘆號再多不夠分類，或者說再多也無法鞭策我進行下一步動作\n\n事件的重要跟緊急又總是只有第一象限了。\n\n就像現在我還有些東西，要做、要看。但我還是在這裡跟自己發牢騷。\n\n訊息真的好煩阿!! \n\n但我為什麼怎麼不喜歡面對錯誤呢? 我從未立過完美人設，因為我要用迷糊跟不記得來逃避一些既來的控訴。但我依然對於種種指責採取無視政策，逃避，又是我唯一對自己的慢性毒藥。",
  "categoryId": "cat-mi4f0f4z-urks8l",
  "subcategoryId": "subcat-mi4f100p-htiheo",
  "publishedAt": "2025-11-18T02:00:00.000Z",
  "slug": "post-mi4f16ip-egcwkp"
}

```

---
### app\content\blog\posts\2025-11-20-post-mi7a5anc.json
```json
{
  "title": "生命的長度，在於你記得什麼、做過什麼，而不在於時間過了多久",
  "body": "阿阿阿！感覺我的人生總有些時候不小心按到skip",
  "categoryId": "cat-mi7a5z88-81296v",
  "subcategoryId": "subcat-mi7a6mc2-gyhglj",
  "publishedAt": "2025-11-20T10:19:43.000Z",
  "slug": "post-mi7a5anc",
  "createdAt": "2025-11-20T10:22:07.137Z",
  "updatedAt": "2025-11-20T10:22:07.137Z"
}

```

---
### app\content\blog\posts\2025-11-20-post-mi7a9fyv.json
```json
{
  "title": "我想要聽演唱會(?",
  "body": "時間一年一年的過\n\n總在努力尋找些什麼、證明自己存在過\n\n但又不知道什麼是自己真正想要的、什麼是自己期待遇見的\n\n什麼是自己內心渴望的\n\n這一年 算是演唱會元年\n\n我用大大小小的演出畫出我生活個隔間\n\n每場的感動不盡相同、想要留下些什麼，才發現過了一年自己還在盲目的刷卡，而少有將生命的長度延續。\n\n接下來是連續三天的演唱會，幸福之餘，難免開始懷疑自己：這是我想要的豐富嗎？我的寂寞與渴望，是否有在一陣陣的歌聲及樂器中滿足？\n\n真心懷疑……\n\n前面又看了藍色巨星，對於爵士也燃起了一些興趣，但又害怕這所謂的＂興趣＂，也只是一時興起的激情，等到求知慾、熱度退卻，我又回到地面上繼續撰寫內耗般的文章。\n\n說也沮喪（？　對於自身的自嘲文章下筆如有神助，但是對於一篇篇自己實際期待的旅遊文章、心得文章，其實一丁點也沒有。\n\n感覺是腦裡的片片記憶，當落地之時，猶如雪花，其實沒有想像中繽紛、有趣、充滿靈性與豐富的思緒。\n\n只有水而已。",
  "categoryId": "cat-mi4f0f4z-urks8l",
  "subcategoryId": "subcat-mi7a8xcl-hlv5sb",
  "publishedAt": "2025-11-20T10:22:07.000Z",
  "slug": "post-mi7a9fyv",
  "createdAt": "2025-11-20T10:23:30.237Z",
  "updatedAt": "2025-11-20T10:23:30.237Z"
}

```

---
### app\content\changelog\2025-11-12-update.json
```json
{
  "date": "2025-11-12",
  "title": "增加地端管理選單",
  "tag": "add",
  "notes": [
    "新增管理UI功能",
    "新增管理後台",
    "把Changelog Page 的更新方式放到後台裡面"
  ]
}

```

---
### app\content\changelog\2025-11-13-update.json
```json
{
  "date": "2025-11-13",
  "title": "更新選單功能 UI進行更新",
  "tag": "add",
  "notes": [
    "新增Git add & push",
    "寫更完整的 Git 紀錄",
    "確認可以一鍵到布署"
  ]
}

```

---
### app\content\changelog\2025-11-14-update.json
```json
{
  "date": "2025-11-14",
  "title": "首頁改版",
  "tag": "add",
  "notes": [
    "模組切換建在頁面頂部直接切換文案、點擊平滑捲動。",
    "樣式同步調整；Hero 配色和字色更新以維持足夠對比。"
  ]
}

```

---
### app\content\changelog\2025-11-18-blog.json
```json
{
  "date": "2025-11-18",
  "title": "新增BLOG 功能",
  "tag": "add",
  "notes": [
    "有兩層階的項目管理",
    "目前可以貼純文字",
    "編輯更新篩選等基本功能都上去了"
  ]
}

```

---
### app\content\changelog\2025-11-20-blog.json
```json
{
  "date": "2025-11-20",
  "title": "BLOG 編輯功能線上版(研究中)",
  "tag": "add",
  "notes": [
    "將文章完全轉移進了DB",
    "預計讓blog可以線上編輯、使用帳密登入"
  ]
}

```

---
### app\content\changelog\2025-11-21-update.json
```json
{
  "date": "2025-11-21",
  "title": "新增\"外掛\"用空間路由",
  "tag": "add",
  "notes": [
    "嘗試增加複雜的頁面",
    "讓AI生成的漂亮網頁可以被執行"
  ]
}

```

---
### app\content\changelog\2025-11-24-update.json
```json
{
  "date": "2025-11-24",
  "title": "更新自適應部落格功能~ 還在研究中",
  "tag": "add",
  "notes": [
    "可以上傳圖片",
    "用上了儲存空間"
  ]
}

```

---
### app\entry.server.tsx
```tsx
import type { AppLoadContext, EntryContext } from "react-router";
import { ServerRouter } from "react-router";
import { isbot } from "isbot";
import { renderToReadableStream } from "react-dom/server";

export default async function handleRequest(
  request: Request,
  responseStatusCode: number,
  responseHeaders: Headers,
  routerContext: EntryContext,
  _loadContext: AppLoadContext,
) {
  let shellRendered = false;
  const userAgent = request.headers.get("user-agent");

  const body = await renderToReadableStream(
    <ServerRouter context={routerContext} url={request.url} />,
    {
      onError(error: unknown) {
        responseStatusCode = 500;
        // Log streaming rendering errors from inside the shell.  Don't log
        // errors encountered during initial shell rendering since they'll
        // reject and get logged in handleDocumentRequest.
        if (shellRendered) {
          console.error(error);
        }
      },
    },
  );
  shellRendered = true;

  // Ensure requests from bots and SPA Mode renders wait for all content to load before responding
  // https://react.dev/reference/react-dom/server/renderToPipeableStream#waiting-for-all-content-to-load-for-crawlers-and-static-generation
  if ((userAgent && isbot(userAgent)) || routerContext.isSpaMode) {
    await body.allReady;
  }

  responseHeaders.set("Content-Type", "text/html; charset=utf-8");
  return new Response(body, {
    headers: responseHeaders,
    status: responseStatusCode,
  });
}

```

---
### app\lib\admin-auth.server.ts
```ts
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

type Context = LoaderFunctionArgs["context"] | ActionFunctionArgs["context"];

const COOKIE_NAME = "admin_session";
const COOKIE_MAX_AGE = 30 * 24 * 60 * 60; // 30 days

function parseCookies(request: Request) {
  const header = request.headers.get("cookie") ?? "";
  return Object.fromEntries(
    header
      .split(";")
      .map((c) => c.trim())
      .filter(Boolean)
      .map((c) => {
        const [k, ...rest] = c.split("=");
        return [k, rest.join("=")];
      }),
  );
}

export function getAdminPassword(context: Context): string | null {
  const ctx = context as any;
  return (
    ctx?.cloudflare?.env?.ADMIN_PASS ??
    ctx?.env?.ADMIN_PASS ??
    ctx?.ADMIN_PASS ??
    process.env.ADMIN_PASS ??
    "letmein"
  );
}

export function isAdmin(request: Request) {
  const cookies = parseCookies(request);
  return cookies[COOKIE_NAME] === "1";
}

export function requireAdmin(request: Request, context: Context) {
  if (isAdmin(request)) return;
  const url = new URL("/admin/login", request.url);
  throw new Response(null, {
    status: 302,
    headers: {
      Location: url.toString(),
    },
  });
}

export function createAdminSessionCookie() {
  return [
    `${COOKIE_NAME}=1`,
    "Path=/",
    "HttpOnly",
    "SameSite=Lax",
    `Max-Age=${COOKIE_MAX_AGE}`,
  ].join("; ");
}

export function clearAdminSessionCookie() {
  return [`${COOKIE_NAME}=; Path=/`, "HttpOnly", "SameSite=Lax", "Max-Age=0"].join("; ");
}

```

---
### app\lib\blog-accent.ts
```ts
import type { BlogCategory, BlogPost } from "./blog.types";

const ACCENT_PALETTE = ["#B9923E", "#6B5CA0", "#2563EB", "#0EA5E9", "#10B981", "#F97316", "#F43F5E"];

export function deriveAccentColor(post: Pick<BlogPost, "categoryId" | "subcategoryId" | "tags" | "slug">, categories?: BlogCategory[]) {
  if (categories?.length && post.categoryId) {
    const categoryIndex = categories.findIndex((cat) => cat.id === post.categoryId);
    if (categoryIndex >= 0) {
      return ACCENT_PALETTE[categoryIndex % ACCENT_PALETTE.length];
    }
  }
  const source =
    post.subcategoryId ||
    post.categoryId ||
    (Array.isArray(post.tags) && post.tags.length ? post.tags[0] : "") ||
    post.slug ||
    "post";
  const hash = Array.from(source).reduce((sum, ch) => sum + ch.charCodeAt(0), 0);
  return ACCENT_PALETTE[hash % ACCENT_PALETTE.length];
}

```

---
### app\lib\blog.d1.server.ts
```ts
import type { BlogPost } from "./blog.types";

function parseTags(raw: string | null | undefined) {
  if (!raw) return [] as string[];
  try {
    const parsed = JSON.parse(raw);
    if (Array.isArray(parsed)) {
      return parsed.map((tag) => tag.toString());
    }
  } catch {
    // ignore broken JSON and fall back to empty array
  }
  return [];
}

function mapRowToPost(row: Record<string, any>): BlogPost {
  return {
    slug: row.slug,
    title: row.title,
    summary: row.summary ?? "",
    body: row.body ?? "",
    imageUrl: row.image_url ?? null,
    tags: parseTags(row.tags),
    categoryId: row.category_id ?? undefined,
    subcategoryId: row.subcategory_id ?? undefined,
    publishedAt: row.published_at,
    createdAt: row.created_at,
    updatedAt: row.updated_at,
  };
}

export async function getAllBlogPosts(db: D1Database): Promise<BlogPost[]> {
  const statement = db.prepare(
    `SELECT slug, title, summary, body, image_url, tags, category_id, subcategory_id, published_at, created_at, updated_at
     FROM blog_posts
     ORDER BY datetime(published_at) DESC, id DESC`,
  );
  const { results } = await statement.all<Record<string, any>>();
  return results.map(mapRowToPost);
}

export async function getBlogPostBySlug(db: D1Database, slug: string): Promise<BlogPost | null> {
  const statement = db.prepare(
    `SELECT slug, title, summary, body, image_url, tags, category_id, subcategory_id, published_at, created_at, updated_at
     FROM blog_posts WHERE slug = ? LIMIT 1`,
  );
  const row = await statement.bind(slug).first<Record<string, any>>();
  return row ? mapRowToPost(row) : null;
}

```

---
### app\lib\blog.server.ts
```ts
import type { BlogCategory, BlogPost } from "./blog.types";
export type { BlogCategory, BlogSubcategory, BlogPost } from "./blog.types";

const BLOG_POST_RE = /^[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-z0-9\-]+\.json$/i;

export async function loadBlogCategories() {
  if (import.meta.env.DEV) {
    try {
      const fs = await import("node:fs/promises");
      const path = await import("node:path");
      const { fileURLToPath } = await import("node:url");
      const __filename = fileURLToPath(import.meta.url);
      const __dirname = path.dirname(__filename);
      const candidates = [
        path.resolve(__dirname, "../content/blog/categories.json"),
        path.resolve(process.cwd(), "app/content/blog/categories.json"),
      ];
      for (const candidate of candidates) {
        try {
          const raw = await fs.readFile(candidate, "utf8");
          const data = JSON.parse(raw) as { categories: BlogCategory[] };
          return data.categories || [];
        } catch {
          continue;
        }
      }
    } catch {
      // ignore
    }
  }
  const mod: any = await import("../content/blog/categories.json");
  const data = mod.default ?? mod;
  return (data.categories || []) as BlogCategory[];
}

function deriveSummary(body: string) {
  const firstParagraph =
    body
      ?.split(/\n+/)
      .map((line) => line.trim())
      .filter(Boolean)[0] ?? "";
  if (!firstParagraph) return "";
  return firstParagraph.length > 200 ? `${firstParagraph.slice(0, 197)}…` : firstParagraph;
}

export async function loadBlogPosts() {
  const posts: BlogPost[] = [];
  if (import.meta.env.DEV) {
    try {
      const fs = await import("node:fs/promises");
      const path = await import("node:path");
      const { fileURLToPath } = await import("node:url");
      const __filename = fileURLToPath(import.meta.url);
      const __dirname = path.dirname(__filename);
      const candidates = [
        path.resolve(__dirname, "../content/blog/posts"),
        path.resolve(process.cwd(), "app/content/blog/posts"),
      ];
      let dir: string | null = null;
      for (const candidate of candidates) {
        try {
          const stat = await fs.stat(candidate);
          if (stat.isDirectory()) {
            dir = candidate;
            break;
          }
        } catch {
          continue;
        }
      }
      if (dir) {
        const files = (await fs.readdir(dir)).filter((f) => BLOG_POST_RE.test(f));
        for (const file of files) {
          try {
            const raw = await fs.readFile(path.join(dir, file), "utf8");
            posts.push({ ...(JSON.parse(raw) as BlogPost), filename: file });
          } catch {
            // ignore malformed file
          }
        }
      }
    } catch {
      // ignore
    }
  }
  if (!posts.length) {
    const modules = import.meta.glob("../content/blog/posts/*.json", { eager: true });
    for (const [p, mod] of Object.entries(modules)) {
      const data = (mod as any).default ?? (mod as any);
      const filename = p.split("/").pop();
      posts.push({ ...(data as BlogPost), filename });
    }
  }
  const normalized = posts.map((post) => {
    const body = typeof post.body === "string" ? post.body : "";
    const createdAt = post.createdAt ?? post.publishedAt ?? new Date().toISOString();
    const updatedAt = post.updatedAt ?? createdAt;
    const summary = post.summary ?? deriveSummary(body);
    const tags = Array.isArray(post.tags) ? post.tags.map((tag) => tag.toString()) : [];
    const imageUrl = typeof (post as any).imageUrl === "string" ? (post as any).imageUrl : null;
    return {
      ...post,
      body,
      summary,
      tags,
      createdAt,
      updatedAt,
      imageUrl,
      slug: post.slug ?? (post as any).filename?.replace(/^\d{4}-\d{2}-\d{2}-/, "").replace(/\.json$/, ""),
    };
  });
  normalized.sort((a, b) => (a.publishedAt < b.publishedAt ? 1 : -1));
  return normalized;
}

```

---
### app\lib\blog.types.ts
```ts
export type BlogSubcategory = {
  id: string;
  title: string;
  description?: string;
};

export type BlogCategory = {
  id: string;
  title: string;
  description?: string;
  children: BlogSubcategory[];
};

export type BlogPost = {
  slug: string;
  title: string;
  summary: string;
  body: string;
  imageUrl: string | null;
  tags: string[];
  publishedAt: string; // ISO string
  createdAt: string;
  updatedAt: string;
  categoryId?: string | null;
  subcategoryId?: string | null;
  filename?: string;
};

```

---
### app\lib\changelog.server.ts
```ts
import type { LoaderFunctionArgs } from "react-router";

export type ChangelogItem = {
  date: string;
  title: string;
  notes?: string[];
  tag?: "add" | "fix" | "change" | "docs";
  filename?: string;
};

/**
 * Shared loader utility so both首頁和 changelog 頁都能讀取相同來源。
 */
export async function loadChangelogItems(_args?: LoaderFunctionArgs) {
  if (import.meta.env.DEV) {
    try {
      const fs = await import("node:fs/promises");
      const path = await import("node:path");
      const { fileURLToPath } = await import("node:url");

      const __filename = fileURLToPath(import.meta.url);
      const __dirname = path.dirname(__filename);
      const candidates = [
        path.resolve(__dirname, "../content/changelog"),
        path.resolve(process.cwd(), "app/content/changelog"),
      ];

      let contentDir: string | null = null;
      for (const candidate of candidates) {
        try {
          const stat = await fs.stat(candidate);
          if (stat.isDirectory()) {
            contentDir = candidate;
            break;
          }
        } catch {
          // ignore
        }
      }

      if (contentDir) {
        const NAME_RE = /^\d{4}-\d{2}-\d{2}-[a-z0-9\-]+\.json$/i;
        const files = (await fs.readdir(contentDir)).filter((f) => NAME_RE.test(f));
        const items: ChangelogItem[] = [];
        for (const file of files) {
          try {
            const raw = await fs.readFile(path.join(contentDir, file), "utf8");
            const data = JSON.parse(raw) as ChangelogItem;
            items.push({ ...data, filename: file });
          } catch {
            // ignore broken file
          }
        }
        items.sort((a, b) => (a.date < b.date ? 1 : -1));
        return items;
      }
    } catch {
      // dev file read failed, fall back to Vite glob
    }
  }

  const modules = import.meta.glob("../content/changelog/*.json", { eager: true });
  const items: ChangelogItem[] = Object.entries(modules).map(([p, m]: any) => {
    const data = m.default ?? m;
    const filename = p.split("/").pop();
    return { ...data, filename } as ChangelogItem;
  });
  items.sort((a, b) => (a.date < b.date ? 1 : -1));
  return items;
}

```

---
### app\lib\d1.server.ts
```ts
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

type Context = LoaderFunctionArgs["context"] | ActionFunctionArgs["context"];

export function requireBlogDb(context: Context) {
  const ctx = context as any;
  const db =
    ctx?.cloudflare?.env?.BLOG_DB ??
    ctx?.cloudflare?.env?.blog_db ??
    ctx?.env?.BLOG_DB ??
    ctx?.env?.blog_db ??
    ctx?.BLOG_DB ??
    ctx?.blog_db;
  if (!db) {
    throw new Response("BLOG_DB binding is missing", { status: 500 });
  }
  return db as D1Database;
}

```

---
### app\lib\image-processing.server.ts
```ts
import { decode as decodeJpeg } from "@jsquash/jpeg";
import { decode as decodePng } from "@jsquash/png";
import { decode as decodeWebp, encode as encodeWebp } from "@jsquash/webp";
import resize from "@jsquash/resize";

type DecodedImage = Awaited<ReturnType<typeof decodeJpeg>>;

const MAX_WIDTH = 1600;
const WEBP_QUALITY = 78;

function guessMime(file: File) {
  if (file.type) return file.type;
  const name = file.name.toLowerCase();
  if (name.endsWith(".png")) return "image/png";
  if (name.endsWith(".webp")) return "image/webp";
  return "image/jpeg";
}

async function decodeImage(buffer: ArrayBuffer, mime: string): Promise<DecodedImage> {
  switch (mime) {
    case "image/png":
      return decodePng(buffer);
    case "image/webp":
      return decodeWebp(buffer);
    default:
      return decodeJpeg(buffer);
  }
}

export async function processCoverImage(file: File) {
  const mime = guessMime(file);
  const raw = await file.arrayBuffer();
  if (!raw.byteLength) {
    throw new Error("圖片檔案為空");
  }
  const decoded = await decodeImage(raw, mime);
  const resized = decoded.width > MAX_WIDTH ? await resize(decoded, { width: MAX_WIDTH }) : decoded;
  const webp = await encodeWebp(resized, { quality: WEBP_QUALITY });
  return {
    data: webp,
    contentType: "image/webp",
    width: resized.width,
    height: resized.height,
  };
}

```

---
### app\lib\r2.server.ts
```ts
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

type Context = LoaderFunctionArgs["context"] | ActionFunctionArgs["context"];

function resolveEnv(context: Context) {
  const ctx = context as any;
  return (
    ctx?.cloudflare?.env ??
    ctx?.env ??
    ctx ??
    {}
  ) as Record<string, unknown>;
}

export function requireBlogImagesBucket(context: Context) {
  const env = resolveEnv(context);
  const bucket = (env.BLOG_IMAGES ?? (env as any).blog_images) as R2Bucket | undefined;
  if (!bucket) {
    throw new Response("BLOG_IMAGES binding is missing", { status: 500 });
  }
  return bucket;
}

export function requireBlogImagesPublicBase(context: Context) {
  const env = resolveEnv(context);
  const base =
    (env as any).BLOG_IMAGES_PUBLIC_BASE_URL ??
    (env as any).blog_images_public_base_url ??
    (env as any).BLOG_IMAGES_PUBLIC_BASE ??
    (env as any).blog_images_public_base;
  if (!base || typeof base !== "string") {
    throw new Response("BLOG_IMAGES_PUBLIC_BASE_URL is missing", { status: 500 });
  }
  return base.endsWith("/") ? base : `${base}/`;
}

export function buildPublicImageUrl(base: string, key: string) {
  try {
    return new URL(key, base).toString();
  } catch {
    return `${base}${key}`;
  }
}

```

---
### app\root.tsx
```tsx
// app/root.tsx
import {
  Link,
  Links,
  Outlet,
  Scripts,
  useLocation,
} from "react-router";
import { useEffect, useRef, useState } from "react";
import "./app.css";

import DevMenu from "./components/DevMenu";



/** 自動隱藏 Header，向下捲動隱藏、向上顯示 */
function AutoHideHeader() {
  const [hidden, setHidden] = useState(false);
  const lastY = useRef(0);
  const ticking = useRef(false);
  useEffect(() => {
    function onScroll() {
      const y = window.scrollY || 0;
      if (!ticking.current) {
        window.requestAnimationFrame(() => {
          const goingDown = y > lastY.current;
          const delta = Math.abs(y - lastY.current);
          if (y < 24 || !goingDown || delta > 10) {
            setHidden(false);
          } else if (goingDown && y > 96) {
            setHidden(true);
          }
          lastY.current = y;
          ticking.current = false;
        });
        ticking.current = true;
      }
    }
    window.addEventListener("scroll", onScroll, { passive: true });
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  return (
    <header
      className={`fixed inset-x-0 top-0 z-50 transition-transform duration-300 will-change-transform
      ${hidden ? "-translate-y-full" : "translate-y-0"}`}
    >
      <div className="backdrop-blur-md bg-[--color-warm-25]/80 border-b border-[--color-warm-100]">
        <div className="mx-auto max-w-6xl px-4 h-14 flex items-center justify-between">
          <Link to="/" className="font-semibold tracking-wide">個人網站</Link>
          <div className="flex items-center gap-4 text-sm">
            <Link to="/blog" className="link-soft hidden md:inline">文章列表</Link>
            <Link to="/changelog" className="link-soft">更新日誌</Link>
          </div>
        </div>
      </div>
    </header>
  );
}

/** 頁面框架 */
function App() {
  const { pathname } = useLocation();
  useEffect(() => {
    window.scrollTo({ top: 0, behavior: "instant" as ScrollBehavior });
  }, [pathname]);

  return (
    <div className="min-h-screen bg-[--color-warm-50] text-neutral-900">
      <AutoHideHeader />
      <main className="pt-16">
        <Outlet />
      </main>
      <DevMenu />
      <footer className="mt-16 border-t">
        <div className="mx-auto max-w-6xl px-4 py-8 text-sm text-neutral-600">
          © {new Date().getFullYear()} 個人網站
        </div>
      </footer>
    </div>
  );
}

/** HTML 骨架 */
export function Layout() {
  return (
    <html lang="zh-Hant">
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>個人網站</title>
        <Links />
      </head>
      <body>
        <App />
        <Scripts />
      </body>
    </html>
  );
}

export default App;

```

---
### app\routes.ts
```ts
// app/routes.ts
import { type RouteConfig, index, route } from "@react-router/dev/routes";


export default [
  index("routes/_index.tsx"), 
  route("about", "routes/about.tsx"),
  route("blog", "routes/blog.tsx"),
  route("blog/:slug", "routes/blog.$slug.tsx"),
  route("changelog", "routes/changelog.tsx"),
  route("admin/login", "routes/admin.login.tsx"),
  route("admin/blog-edit", "routes/admin.blog-edit.tsx"),
  route("admin", "routes/admin.tsx"),
  route("outerspace", "routes/outerspace/index.tsx"),
  route("outerspace/OuterSpaceSenter", "routes/outerspace/OuterSpaceSenter.tsx"),
  route("outerspace/PokeAPIcreatures", "routes/outerspace/PokeAPIcreatures.tsx"),
  route("outerspace/Gravity", "routes/outerspace/Gravity.tsx"),
] satisfies RouteConfig;

```

---
### app\routes\_index.tsx
```tsx
import { useEffect, useState } from "react";
import { Link } from "react-router";

// --- 資料設定 (可在這裡修改你的文字) ---
const SECTIONS = {
  hero: {
    id: "hero",
    label: "主頁",
    title: "你好，歡迎來到我的個人網站",
    description: "這是一個關於技術、設計與生活的紀錄空間。",
    accent: "var(--color-brand-400)",
    background: "var(--color-brand-50)",
    meta: "WELCOME",
    content: (
      <>
        <p>在這裡，我分享我的開發心得、設計實驗以及生活中的點滴。</p>
        <p>請隨意瀏覽上方的頁籤，探索更多關於我的資訊。</p>
      </>
    ),
  },
  about: {
    id: "about",
    label: "關於",
    title: "關於我",
    description: "熱愛探索新技術的前端開發者。",
    accent: "var(--color-accent-400)",
    background: "var(--color-module-about)",
    meta: "ABOUT ME",
    content: (
      <>
        <p>我喜歡用程式碼解決問題，也著迷於優雅的使用者介面設計。</p>
        <ul className="list-disc list-inside space-y-2 text-neutral-700 mt-4">
          <li>擅長 React 與現代前端生態系</li>
          <li>注重細節與使用者體驗</li>
          <li>持續學習 Edge Computing 與 Serverless 架構</li>
        </ul>
      </>
    ),
  },
  skills: {
    id: "skills",
    label: "技能",
    title: "技術堆疊",
    description: "我常用的工具與技術。",
    accent: "#3B82F6",
    background: "var(--color-module-skills)",
    meta: "SKILLS",
    content: (
      <div className="flex flex-wrap gap-2 mt-4">
        {["React", "Remix", "TypeScript", "Tailwind CSS", "Cloudflare Workers", "Figma"].map((skill) => (
          <span key={skill} className="chip">
            {skill}
          </span>
        ))}
      </div>
    ),
  },
  projects: {
    id: "projects",
    label: "專案",
    title: "精選專案",
    description: "近期的一些實作與實驗。",
    accent: "#10B981",
    background: "var(--color-module-projects)",
    meta: "PROJECTS",
    content: (
      <div className="grid gap-4 md:grid-cols-2 mt-4">
        <Link to="/outerspace" className="card hover:border-emerald-400 group transition-all">
          <h4 className="font-bold text-lg group-hover:text-emerald-600">OuterSpace 實驗室</h4>
          <p className="text-sm text-neutral-500 mt-1">3D 視覺與互動介面的實驗場域。</p>
        </Link>
        <Link to="/blog" className="card hover:border-emerald-400 group transition-all">
          <h4 className="font-bold text-lg group-hover:text-emerald-600">技術部落格</h4>
          <p className="text-sm text-neutral-500 mt-1">紀錄開發過程中的踩坑與心得。</p>
        </Link>
      </div>
    ),
  },
  contact: {
    id: "contact",
    label: "聯絡",
    title: "保持聯繫",
    description: "有什麼想法嗎？歡迎來信。",
    accent: "#F43F5E",
    background: "var(--color-module-contact)",
    meta: "CONTACT",
    content: (
      <div className="flex flex-col gap-4 mt-4">
        <p>你可以透過以下方式找到我：</p>
        <a href="mailto:your.email@example.com" className="btn-primary w-fit">
          發送郵件
        </a>
      </div>
    ),
  },
};

type SectionKey = keyof typeof SECTIONS;

export default function Index() {
  const [activeSection, setActiveSection] = useState<SectionKey>("hero");

  // 當 activeSection 改變時，自動捲回頂部，解決切換長短內容時的空白問題
  useEffect(() => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  }, [activeSection]);

  const activeData = SECTIONS[activeSection];

  return (
    <div className="mx-auto max-w-6xl px-4 pb-20 space-y-8 min-h-[calc(100vh-4rem)]">
      {/* Sticky Navigation Tabs */}
      <div className="sticky top-0 z-30 -mx-4 pt-4 px-4 bg-gradient-to-b from-[--color-warm-50] via-[--color-warm-50]/95 to-transparent pb-4">
        <nav className="sticky-tabs-shell p-1.5 flex flex-wrap gap-1 w-fit mx-auto md:mx-0">
          {(Object.keys(SECTIONS) as SectionKey[]).map((key) => {
            const item = SECTIONS[key];
            const isActive = activeSection === key;
            return (
              <button
                key={key}
                // 使用 onMouseEnter 實現滑鼠滑過即切換
                onMouseEnter={() => setActiveSection(key)}
                onClick={() => setActiveSection(key)} // 保留點擊以支援觸控裝置
                className={`
                  px-4 py-2 rounded-xl text-sm font-medium transition-all duration-200 relative
                  ${isActive ? "text-neutral-900 shadow-sm" : "text-neutral-500 hover:text-neutral-700 hover:bg-black/5"}
                `}
                style={{
                  background: isActive ? "rgba(255,255,255,0.8)" : "transparent",
                }}
              >
                {item.label}
                {isActive && (
                  <span 
                    className="absolute inset-x-0 -bottom-1 h-0.5 rounded-full mx-3" 
                    style={{ backgroundColor: item.accent }} 
                  />
                )}
              </button>
            );
          })}
        </nav>
      </div>

      {/* Main Content Area */}
      <section className="animate-room-in">
        <div
          key={activeSection} // Key change triggers re-animation
          className="module-panel relative overflow-hidden transition-colors duration-500"
          style={{
            background: activeData.background,
            borderColor: `${activeData.accent}33`, // 20% opacity border
            ["--module-accent" as any]: activeData.accent,
          }}
        >
          {/* Decorative Layer */}
          <div 
            className="absolute -right-20 -top-20 w-96 h-96 opacity-20 pointer-events-none blur-3xl rounded-full transition-colors duration-700"
            style={{ background: activeData.accent }}
          />

          <div className="relative z-10 space-y-6 max-w-2xl">
            <div className="space-y-2">
              <div className="eyebrow" style={{ color: activeData.accent }}>
                {activeData.meta}
              </div>
              <h2 className="text-3xl md:text-4xl font-bold text-neutral-900 tracking-tight">
                {activeData.title}
              </h2>
              <p className="text-lg text-neutral-600 leading-relaxed">
                {activeData.description}
              </p>
            </div>

            <div className="divider opacity-20" />

            <div className="text-neutral-700 leading-7">
              {activeData.content}
            </div>
          </div>
        </div>
      </section>
    </div>
  );
}
```

---
### app\routes\about.tsx
```tsx
// app/routes/about.tsx
// app/routes/about.tsx
export default function AboutPage() {
  return (
    <main className="max-w-3xl mx-auto px-4 py-12 leading-relaxed">
      <h1 className="text-3xl font-bold mb-6">關於這個專案</h1>

      <p className="mb-4">
        這是一個以 React Router Framework 為基礎、部署在 Cloudflare Workers 上的部落格專案。
        主要目標是從零開始，透過實作學習現代前端架構，並體驗「前後端在同一份程式碼中」的開發模式。
      </p>

      <p className="mb-4">
        網站的資料來源使用 Notion 作為 CMS，留言資料存放於 Cloudflare D1。
        所有頁面都由 Workers 在邊緣節點進行伺服端渲染（SSR），使內容能快速且安全地傳遞到世界各地的使用者。
      </p>

      <h2 className="text-2xl font-semibold mt-8 mb-3">主要功能規劃</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>首頁與關於頁</li>
        <li>部落格列表與文章頁</li>
        <li>留言板（D1 資料庫）</li>
        <li>RSS Feed</li>
        <li>互動圖表頁（未來示範資料視覺化）</li>
        <li>密碼保護頁（中介層驗證）</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">目前進度</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>已完成：基本架構、首頁、關於頁、部落格假資料、樣式設定</li>
        <li>進行中：Notion API 串接與留言板互動</li>
        <li>待完成：RSS、D1 實作、密碼頁、圖表</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">技術架構</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>React Router v7（檔案式路由、loader/action）</li>
        <li>Cloudflare Workers（邊緣運算與伺服端渲染）</li>
        <li>Cloudflare D1（留言資料庫）</li>
        <li>Notion API（文章內容來源）</li>
        <li>Tailwind CSS（樣式）</li>
        <li>TypeScript + Vite（開發環境）</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">開發理念</h2>
      <p className="mb-4">
        專案採取「邊學邊做」的方式推進。每一週聚焦於不同面向：第一週完成網站骨架，
        第二週整合外部資料與互動功能，第三週優化效能與擴充應用。
      </p>

      <p className="mb-4">
        最終希望這個網站不只是作品展示，也是一份可持續擴充的個人開發框架，
        未來能作為更多 Cloudflare Edge App 的基礎。
      </p>

      <footer className="mt-12 text-sm text-gray-500">
        © {new Date().getFullYear()} 個人專案開發筆記
      </footer>
    </main>
  );
}

```

---
### app\routes\admin.blog-edit.tsx
```tsx
import { useEffect, useMemo, useState } from "react";
import { useLoaderData } from "react-router";
import type { LoaderFunctionArgs } from "react-router";
import { loadBlogCategories } from "../lib/blog.server";
import type { BlogCategory, BlogPost } from "../lib/blog.types";
import { requireAdmin } from "../lib/admin-auth.server";

type LoaderData = Awaited<ReturnType<typeof loader>>;

export async function loader({ request, context }: LoaderFunctionArgs) {
  requireAdmin(request, context);
  const url = new URL(request.url);
  const slug = url.searchParams.get("slug") ?? "";
  const categories = await loadBlogCategories();
  return Response.json({ slug, categories });
}

type FormState = {
  slug: string;
  title: string;
  summary: string;
  body: string;
  tagsInput: string;
  categoryId: string;
  subcategoryId: string;
  publishedAtInput: string;
  updatedAtBase: string;
  isExisting: boolean;
  imageUrl: string;
  imageFile: File | null;
};

function defaultFormState(initialSlug: string): FormState {
  return {
    slug: initialSlug,
    title: "",
    summary: "",
    body: "",
    tagsInput: "",
    categoryId: "",
    subcategoryId: "",
    publishedAtInput: formatDatetimeLocal(new Date().toISOString()),
    updatedAtBase: "",
    isExisting: false,
    imageUrl: "",
    imageFile: null,
  };
}

function formatDatetimeLocal(iso?: string | null) {
  if (!iso) return "";
  const date = new Date(iso);
  if (Number.isNaN(date.valueOf())) return "";
  const pad = (value: number) => value.toString().padStart(2, "0");
  return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(
    date.getHours(),
  )}:${pad(date.getMinutes())}`;
}

function parseTags(input: string) {
  return input
    .split(",")
    .map((tag) => tag.trim())
    .filter(Boolean);
}

export default function AdminBlogEditPage() {
  const { slug: initialSlug, categories } = useLoaderData() as LoaderData;
  const [formState, setFormState] = useState<FormState>(() => defaultFormState(initialSlug));
  const [isFetching, setIsFetching] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [message, setMessage] = useState<string | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [imagePreview, setImagePreview] = useState<string | null>(null);

  const availableSubcategories = useMemo(() => {
    return categories.find((cat) => cat.id === formState.categoryId)?.children ?? [];
  }, [categories, formState.categoryId]);

  useEffect(() => {
    if (initialSlug) {
      void fetchPost(initialSlug);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [initialSlug]);

  useEffect(() => {
    let nextObjectUrl: string | null = null;
    if (formState.imageFile) {
      nextObjectUrl = URL.createObjectURL(formState.imageFile);
      setImagePreview(nextObjectUrl);
    } else {
      setImagePreview(formState.imageUrl || null);
    }
    return () => {
      if (nextObjectUrl) {
        URL.revokeObjectURL(nextObjectUrl);
      }
    };
  }, [formState.imageFile, formState.imageUrl]);

  async function fetchPost(slug: string) {
    if (!slug) return;
    setIsFetching(true);
    setMessage(null);
    setError(null);
    try {
      const res = await fetch(`/api/blog-post?slug=${encodeURIComponent(slug)}`);
      if (!res.ok) {
        throw new Error(await res.text());
      }
      const post = (await res.json()) as BlogPost;
      setFormState((prev) => ({
        ...prev,
        slug: post.slug ?? slug,
        title: post.title ?? "",
        summary: post.summary ?? "",
        body: post.body ?? "",
        tagsInput: Array.isArray(post.tags) ? post.tags.join(", ") : "",
        categoryId: post.categoryId ?? "",
        subcategoryId: post.subcategoryId ?? "",
        publishedAtInput: formatDatetimeLocal(post.publishedAt),
        updatedAtBase: post.updatedAt ?? "",
        isExisting: true,
        imageUrl: post.imageUrl ?? "",
        imageFile: null,
      }));
      setMessage("已載入最新內容");
    } catch (err: any) {
      setError(err.message || "載入文章失敗");
    } finally {
      setIsFetching(false);
    }
  }

  async function handleSave() {
    if (!formState.title || !formState.body) {
      setError("請至少填寫標題與內容");
      return;
    }
    if (formState.isExisting && !formState.slug) {
      setError("無法更新：缺少 slug");
      return;
    }

    setIsSaving(true);
    setError(null);
    setMessage(null);

    let endpoint = "/api/blog-post";
    let method: "POST" | "PUT" = "POST";

    const formData = new FormData();
    formData.append("title", formState.title);
    formData.append("summary", formState.summary);
    formData.append("body", formState.body);
    formData.append("tags", formState.tagsInput);
    if (formState.categoryId) formData.append("categoryId", formState.categoryId);
    if (formState.subcategoryId) formData.append("subcategoryId", formState.subcategoryId);
    if (formState.publishedAtInput) {
      formData.append("publishedAt", new Date(formState.publishedAtInput).toISOString());
    }
    if (formState.imageFile) {
      formData.append("image", formState.imageFile);
    }

    if (formState.isExisting) {
      method = "PUT";
      endpoint = `/api/blog-post?slug=${encodeURIComponent(formState.slug)}`;
      formData.append("updatedAtBase", formState.updatedAtBase);
    } else if (formState.slug) {
      formData.append("slug", formState.slug);
    }

    try {
      const res = await fetch(endpoint, {
        method,
        body: formData,
      });

      if (res.status === 409) {
        setError("文章已在別處被更新或 slug 重複，請重新載入。");
        if (formState.slug) {
          await fetchPost(formState.slug);
        }
        return;
      }
      if (!res.ok) {
        throw new Error(await res.text());
      }

      const data = await res.json();
      if (method === "POST") {
        const nextSlug = data.slug as string;
        await fetchPost(nextSlug);
        setMessage("已建立文章");
      } else {
        const refreshed = data.post as any;
        setFormState((prev) => ({
          ...prev,
          imageFile: null,
          imageUrl: refreshed?.imageUrl ?? prev.imageUrl,
          updatedAtBase: refreshed?.updatedAt ?? prev.updatedAtBase,
        }));
        setMessage("已儲存最新內容");
      }
    } catch (err: any) {
      setError(err.message || "儲存失敗");
    } finally {
      setIsSaving(false);
    }
  }

  function handleInputChange<T extends keyof FormState>(key: T, value: FormState[T]) {
    setFormState((prev) => ({ ...prev, [key]: value }));
  }

  function handleImageChange(file: File | null) {
    setFormState((prev) => ({ ...prev, imageFile: file }));
  }

  function handleCategoryChange(value: string) {
    setFormState((prev) => {
      const category = categories.find((cat) => cat.id === value);
      const subIsValid = category?.children.some((child) => child.id === prev.subcategoryId);
      return {
        ...prev,
        categoryId: value,
        subcategoryId: subIsValid ? prev.subcategoryId : "",
      };
    });
  }

  return (
    <div className="mx-auto max-w-3xl px-4 py-10 space-y-6">
      <header className="space-y-2">
        <p className="eyebrow text-neutral-500">Blog 編輯介面</p>
        <h1 className="text-3xl font-bold text-neutral-900">雲端文章管理</h1>
        <p className="text-sm text-neutral-600">
          透過 Cloudflare D1 直接讀寫文章，更新後網站即時同步，不需重新部署。
        </p>
      </header>

      <div className="space-y-4 rounded-2xl border border-neutral-200 bg-white/90 p-6 shadow-sm">
        <div className="grid gap-4 md:grid-cols-[1fr_auto]">
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            Slug
            <input
              type="text"
              value={formState.slug}
              onChange={(e) => handleInputChange("slug", e.target.value)}
              className="input"
              placeholder="color-palette"
              disabled={formState.isExisting}
            />
          </label>
          <button
            type="button"
            className="btn-ghost h-fit self-end"
            onClick={() => fetchPost(formState.slug)}
            disabled={!formState.slug || isFetching}
          >
            {isFetching ? "載入中..." : "重新載入"}
          </button>
        </div>

        <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
          標題
          <input
            type="text"
            value={formState.title}
            onChange={(e) => handleInputChange("title", e.target.value)}
            className="input"
            placeholder="Workers + React Router 的實測"
          />
        </label>

        <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
          摘要
          <textarea
            value={formState.summary}
            onChange={(e) => handleInputChange("summary", e.target.value)}
            className="textarea"
            rows={3}
            placeholder="文章簡短說明，會用於列表與 meta。"
          />
        </label>

        <div className="grid gap-4 md:grid-cols-[1fr_auto] md:items-end">
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            封面圖片
            <input
              type="file"
              accept="image/*"
              onChange={(e) => handleImageChange(e.target.files?.[0] ?? null)}
              className="input file:mr-2 file:rounded-md file:border-0 file:bg-[--color-accent-50] file:px-3 file:py-2 file:text-sm"
            />
            <span className="text-xs font-normal text-neutral-500">
              新增或更新時若未選擇圖片，會沿用目前封面。
            </span>
          </label>
          <div className="flex flex-col items-start gap-2">
            {imagePreview ? (
              <img
                src={imagePreview}
                alt="文章封面預覽"
                className="h-24 w-36 rounded-lg border border-neutral-200 object-cover"
              />
            ) : (
              <div className="flex h-24 w-36 items-center justify-center rounded-lg border border-dashed border-neutral-300 text-xs text-neutral-500">
                尚未設定封面
              </div>
            )}
            {formState.imageFile ? (
              <button type="button" className="btn-ghost text-xs px-3 py-1" onClick={() => handleImageChange(null)}>
                清除新圖片
              </button>
            ) : null}
          </div>
        </div>

        <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
          內文
          <textarea
            value={formState.body}
            onChange={(e) => handleInputChange("body", e.target.value)}
            className="textarea"
            rows={10}
            placeholder="這裡貼上 Markdown 或純文字內容"
          />
        </label>

        <div className="grid gap-4 md:grid-cols-2">
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            標籤（逗號分隔）
            <input
              type="text"
              value={formState.tagsInput}
              onChange={(e) => handleInputChange("tagsInput", e.target.value)}
              className="input"
              placeholder="Workers, React Router, D1"
            />
          </label>
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            發佈時間
            <input
              type="datetime-local"
              value={formState.publishedAtInput}
              onChange={(e) => handleInputChange("publishedAtInput", e.target.value)}
              className="input"
            />
          </label>
        </div>

        <div className="grid gap-4 md:grid-cols-2">
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            分類
            <select
              className="input"
              value={formState.categoryId}
              onChange={(e) => handleCategoryChange(e.target.value)}
            >
              <option value="">選擇分類</option>
              {categories.map((category) => (
                <option key={category.id} value={category.id}>
                  {category.title}
                </option>
              ))}
            </select>
          </label>
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            子分類
            <select
              className="input"
              value={formState.subcategoryId}
              onChange={(e) => handleInputChange("subcategoryId", e.target.value)}
              disabled={!availableSubcategories.length}
            >
              <option value="">選擇子分類</option>
              {availableSubcategories.map((subcategory) => (
                <option key={subcategory.id} value={subcategory.id}>
                  {subcategory.title}
                </option>
              ))}
            </select>
          </label>
        </div>

        <div className="flex flex-wrap items-center gap-3">
          <button
            type="button"
            className="btn-primary"
            onClick={handleSave}
            disabled={isSaving || isFetching}
          >
            {isSaving ? "儲存中..." : "儲存文章"}
          </button>
          {message ? <p className="text-sm text-green-600">{message}</p> : null}
          {error ? <p className="text-sm text-red-600">{error}</p> : null}
        </div>
      </div>
    </div>
  );
}

```

---
### app\routes\admin.login.tsx
```tsx
import { Form, useActionData } from "react-router";
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

import {
  createAdminSessionCookie,
  getAdminPassword,
  isAdmin,
} from "../lib/admin-auth.server";

export async function loader({ request }: LoaderFunctionArgs) {
  if (isAdmin(request)) {
    const url = new URL("/admin", request.url);
    return new Response(null, {
      status: 302,
      headers: { Location: url.toString() },
    });
  }
  return {}; // noop, renders form
}

export async function action({ request, context }: ActionFunctionArgs) {
  const formData = await request.formData();
  const password = (formData.get("password") ?? "").toString();
  const expected = getAdminPassword(context);

  if (!expected) {
    return { error: "未設定管理密碼 (ADMIN_PASS)" };
  }

  if (password !== expected) {
    return { error: "密碼錯誤" };
  }

  const url = new URL("/admin", request.url);
  return new Response(null, {
    status: 302,
    headers: {
      Location: url.toString(),
      "Set-Cookie": createAdminSessionCookie(),
    },
  });
}

export default function AdminLoginPage() {
  const actionData = useActionData<typeof action>();

  return (
    <div className="min-h-screen flex items-center justify-center bg-[--color-warm-50] px-4 py-12">
      <div className="w-full max-w-sm rounded-2xl border border-neutral-200 bg-white/90 p-6 shadow-lg space-y-4">
        <div className="space-y-1">
          <p className="eyebrow text-neutral-500">Admin</p>
          <h1 className="text-2xl font-semibold text-neutral-900">登入管理後台</h1>
          <p className="text-sm text-neutral-600">請輸入管理密碼繼續。</p>
        </div>

        <Form method="post" className="space-y-3">
          <input
            type="password"
            name="password"
            placeholder="Password"
            autoFocus
            required
            className="input"
          />
          {actionData && "error" in actionData ? (
            <p className="text-sm text-red-600">{(actionData as any).error}</p>
          ) : null}
          <button type="submit" className="btn-primary w-full">
            登入
          </button>
        </Form>
      </div>
    </div>
  );
}

```

---
### app\routes\admin.tsx
```tsx
import { useMemo, useState } from "react";
import { Form, Link, useLoaderData, useNavigation } from "react-router";
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

import { requireAdmin } from "../lib/admin-auth.server";
import { requireBlogDb } from "../lib/d1.server";
import { getAllBlogPosts } from "../lib/blog.d1.server";
import type { BlogCategory, BlogPost } from "../lib/blog.types";
import { loadBlogCategories } from "../lib/blog.server";

type LoaderData = {
  posts: BlogPost[];
  categories: BlogCategory[];
  tags: string[];
};

type FormState = {
  slug: string;
  title: string;
  summary: string;
  body: string;
  publishedAt: string;
  tagsInput: string;
  categoryId: string;
  subcategoryId: string;
};

function deriveSummary(body: string) {
  const firstParagraph =
    body
      ?.split(/\n+/)
      .map((line) => line.trim())
      .filter(Boolean)[0] ?? "";
  if (!firstParagraph) return "";
  return firstParagraph.length > 200 ? `${firstParagraph.slice(0, 197)}…` : firstParagraph;
}

export async function loader({ request, context }: LoaderFunctionArgs) {
  requireAdmin(request, context);
  const db = requireBlogDb(context);
  const posts = await getAllBlogPosts(db);
  const categories = await loadBlogCategories();
  const tagSet = new Set<string>();
  for (const post of posts) {
    if (Array.isArray(post.tags)) {
      for (const tag of post.tags) {
        const value = (tag ?? "").toString().trim();
        if (value) tagSet.add(value);
      }
    }
  }
  const tags = Array.from(tagSet).sort((a, b) => a.localeCompare(b, "zh-Hant"));
  return { posts, categories, tags };
}

export async function action({ request, context }: ActionFunctionArgs) {
  requireAdmin(request, context);
  const formData = await request.formData();
  const intent = (formData.get("intent") ?? "").toString();
  const db = requireBlogDb(context);

  if (intent === "delete") {
    const slug = (formData.get("slug") ?? "").toString().trim();
    if (!slug) return { error: "slug 必填" };
    await db.prepare("DELETE FROM blog_posts WHERE slug = ?").bind(slug).run();
    const url = new URL("/admin", request.url);
    return new Response(null, {
      status: 302,
      headers: { Location: url.toString() },
    });
  }

  if (intent === "upsert") {
    const slug = (formData.get("slug") ?? "").toString().trim();
    const title = (formData.get("title") ?? "").toString().trim();
    const body = (formData.get("body") ?? "").toString();
    const publishedAt = (formData.get("publishedAt") ?? "").toString().trim();
    const summaryInput = (formData.get("summary") ?? "").toString().trim();
    const tagsInput = (formData.get("tags") ?? "").toString().trim();
    const selectedTags = formData
      .getAll("tag")
      .map((t) => t.toString().trim())
      .filter(Boolean);
    const categoryId = (formData.get("categoryId") ?? "").toString().trim() || null;
    const subcategoryId = (formData.get("subcategoryId") ?? "").toString().trim() || null;

    if (!slug || !title || !body) {
      return { error: "slug、title、body 必填" };
    }
    const now = new Date().toISOString();
    const summary = summaryInput || deriveSummary(body);
    const tagSet = new Set<string>();
    for (const tag of selectedTags) {
      tagSet.add(tag);
    }
    if (tagsInput) {
      for (const raw of tagsInput.split(",")) {
        const value = raw.trim();
        if (value) tagSet.add(value);
      }
    }
    const tags = Array.from(tagSet);
    const pub = publishedAt || now;

    await db
      .prepare(
        `INSERT INTO blog_posts (slug, title, summary, body, tags, category_id, subcategory_id, published_at, created_at, updated_at)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
         ON CONFLICT(slug) DO UPDATE SET
           title = excluded.title,
           summary = excluded.summary,
           body = excluded.body,
           tags = excluded.tags,
           category_id = excluded.category_id,
           subcategory_id = excluded.subcategory_id,
           published_at = excluded.published_at,
           updated_at = excluded.updated_at`,
      )
      .bind(
        slug,
        title,
        summary,
        body,
        JSON.stringify(tags),
        categoryId,
        subcategoryId,
        pub,
        now,
        now,
      )
      .run();

    const url = new URL("/admin", request.url);
    return new Response(null, {
      status: 302,
      headers: { Location: url.toString() },
    });
  }

  return { error: "未知 intent" };
}

function formatDate(date: string) {
  try {
    return new Intl.DateTimeFormat("zh-Hant", { dateStyle: "medium", timeStyle: "short" }).format(
      new Date(date),
    );
  } catch {
    return date;
  }
}

export default function AdminPage() {
  const { posts, categories, tags } = useLoaderData<typeof loader>() as LoaderData;
  const navigation = useNavigation();

  const isSubmitting = navigation.state === "submitting";

  const [formState, setFormState] = useState<FormState>(() => ({
    slug: "",
    title: "",
    summary: "",
    body: "",
    publishedAt: "",
    tagsInput: "",
    categoryId: "",
    subcategoryId: "",
  }));

  function handleFormChange<K extends keyof FormState>(key: K, value: FormState[K]) {
    setFormState((prev) => ({ ...prev, [key]: value }));
  }

  function resetForm() {
    setFormState({
      slug: "",
      title: "",
      summary: "",
      body: "",
      publishedAt: "",
      tagsInput: "",
      categoryId: "",
      subcategoryId: "",
    });
  }

  function handleLoadPost(post: BlogPost) {
    setFormState({
      slug: post.slug ?? "",
      title: post.title ?? "",
      summary: post.summary ?? "",
      body: post.body ?? "",
      publishedAt: post.publishedAt ?? "",
      tagsInput: Array.isArray(post.tags) ? post.tags.join(", ") : "",
      categoryId: (post.categoryId ?? "") || "",
      subcategoryId: (post.subcategoryId ?? "") || "",
    });
  }

  const availableSubcategories = useMemo(() => {
    const category = categories.find((cat) => cat.id === formState.categoryId);
    return category?.children ?? [];
  }, [categories, formState.categoryId]);

  return (
    <div className="mx-auto max-w-5xl px-4 py-10 space-y-8">
      <header className="flex items-center justify-between gap-4">
        <div>
          <p className="eyebrow text-neutral-500">Admin</p>
          <h1 className="text-3xl font-bold text-neutral-900">Blog 管理</h1>
          <p className="text-sm text-neutral-600">新增 / 更新 / 刪除部落格文章，直接寫入 D1。</p>
        </div>
        <Link to="/" className="btn-ghost">
          返回前台
        </Link>
      </header>

      <section className="grid gap-6 lg:grid-cols-[1.4fr_1fr]">
        <div className="card bg-white/95 space-y-4">
          <div>
            <p className="font-semibold text-neutral-900">新增或更新</p>
            <p className="text-xs text-neutral-500">同 slug 會覆蓋內容，空白欄位會沿用保存的值。</p>
          </div>
          <Form method="post" className="space-y-3">
            <input type="hidden" name="intent" value="upsert" />
            <div className="grid gap-3 md:grid-cols-2">
              <input
                name="slug"
                placeholder="slug (唯一)"
                required
                className="input"
                value={formState.slug}
                onChange={(e) => handleFormChange("slug", e.target.value)}
              />
              <input
                name="title"
                placeholder="標題"
                required
                className="input"
                value={formState.title}
                onChange={(e) => handleFormChange("title", e.target.value)}
              />
            </div>
            <div className="grid gap-3 md:grid-cols-2">
              <input
                name="publishedAt"
                placeholder="發布時間 ISO，可留空"
                className="input"
                value={formState.publishedAt}
                onChange={(e) => handleFormChange("publishedAt", e.target.value)}
              />
              <input
                name="summary"
                placeholder="摘要，可留空自動取第一段"
                className="input"
                value={formState.summary}
                onChange={(e) => handleFormChange("summary", e.target.value)}
              />
            </div>
            <div className="grid gap-3 md:grid-cols-2">
              <select
                name="categoryId"
                className="input"
                value={formState.categoryId}
                onChange={(e) => {
                  handleFormChange("categoryId", e.target.value);
                  handleFormChange("subcategoryId", "");
                }}
              >
                <option value="">未分類</option>
                {categories.map((category) => (
                  <option key={category.id} value={category.id}>
                    {category.title}
                  </option>
                ))}
              </select>
              <select
                name="subcategoryId"
                className="input"
                value={formState.subcategoryId}
                onChange={(e) => handleFormChange("subcategoryId", e.target.value)}
                disabled={!availableSubcategories.length}
              >
                <option value="">未分類</option>
                {availableSubcategories.map((subcategory) => (
                  <option key={subcategory.id} value={subcategory.id}>
                    {subcategory.title}
                  </option>
                ))}
              </select>
            </div>
            <div className="space-y-2">
              <input
                name="tags"
                placeholder="自訂標籤，以逗號分隔，可留空"
                className="input"
                value={formState.tagsInput}
                onChange={(e) => handleFormChange("tagsInput", e.target.value)}
              />
              {tags.length ? (
                <div className="space-y-1">
                  <p className="text-xs font-medium text-neutral-700">從現有標籤選擇：</p>
                  <div className="flex flex-wrap gap-2">
                    {tags.map((tag) => (
                      <label
                        key={tag}
                        className="inline-flex items-center gap-1 rounded-full border border-neutral-200 bg-neutral-50 px-2 py-1 text-xs text-neutral-700"
                      >
                        <input type="checkbox" name="tag" value={tag} className="h-3 w-3" />
                        <span>{tag}</span>
                      </label>
                    ))}
                  </div>
                </div>
              ) : null}
            </div>
            <textarea
              name="body"
              placeholder="文章內容（支援純文字換行）"
              rows={10}
              required
              className="input"
              value={formState.body}
              onChange={(e) => handleFormChange("body", e.target.value)}
            />
            <div className="flex flex-wrap items-center gap-3">
              <button type="submit" className="btn-primary" disabled={isSubmitting}>
                {isSubmitting ? "送出中..." : "儲存 / 更新"}
              </button>
              <button type="button" className="btn-ghost text-sm" onClick={resetForm}>
                清空表單（新增新文章）
              </button>
            </div>
          </Form>
        </div>

        <div className="card bg-white/95 space-y-4">
          <div>
            <p className="font-semibold text-neutral-900">現有文章</p>
            <p className="text-xs text-neutral-500">點擊載入可帶入表單，刪除會立即移除。</p>
          </div>
          <div className="space-y-3 max-h-[600px] overflow-auto">
            {posts.length === 0 ? (
              <p className="text-sm text-neutral-600">目前沒有文章。</p>
            ) : (
              posts.map((post) => (
                <div
                  key={post.slug + post.publishedAt}
                  className="flex items-start justify-between gap-3 rounded-xl border border-neutral-200/80 bg-white/80 px-4 py-3"
                >
                  <div className="space-y-1">
                    <p className="text-sm font-semibold text-neutral-900">{post.title}</p>
                    <p className="text-xs text-neutral-500">{post.slug}</p>
                    <p className="text-xs text-neutral-500">{formatDate(post.updatedAt ?? post.createdAt)}</p>
                  </div>
                  <div className="flex flex-col items-end gap-2">
                    <button
                      type="button"
                      className="text-xs text-blue-600 hover:underline"
                      onClick={() => handleLoadPost(post)}
                    >
                      載入到表單
                    </button>
                    <Form
                      method="post"
                      onSubmit={(e) => {
                        if (!window.confirm(`確定刪除「${post.title}」?`)) {
                          e.preventDefault();
                        }
                      }}
                    >
                      <input type="hidden" name="intent" value="delete" />
                      <input type="hidden" name="slug" value={post.slug} />
                      <button type="submit" className="text-xs text-red-600 hover:underline">
                        刪除
                      </button>
                    </Form>
                  </div>
                </div>
              ))
            )}
          </div>
        </div>
      </section>
    </div>
  );
}

```

---
### app\routes\api.blog-post.tsx
```tsx
import type { LoaderFunctionArgs, ActionFunctionArgs } from "react-router";

import { requireBlogDb } from "../lib/d1.server";
import { getBlogPostBySlug } from "../lib/blog.d1.server";
import type { BlogPost } from "../lib/blog.types";
import { requireAdmin } from "../lib/admin-auth.server";
import { processCoverImage } from "../lib/image-processing.server";
import { buildPublicImageUrl, requireBlogImagesBucket, requireBlogImagesPublicBase } from "../lib/r2.server";

type IncomingPostPayload = Partial<BlogPost> & {
  updatedAtBase?: string;
  categoryId?: string | null;
  subcategoryId?: string | null;
  imageFile?: File | null;
};

function slugify(value: string) {
  return value
    .toLowerCase()
    .trim()
    .normalize("NFKD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "")
    .replace(/-{2,}/g, "-");
}

function normalizeIsoDate(value: unknown, fallback: string) {
  if (!value) return fallback;
  const parsed = new Date(value as string);
  if (Number.isNaN(parsed.valueOf())) return fallback;
  return parsed.toISOString();
}

function normalizeString(value: unknown) {
  return (value ?? "").toString().trim();
}

function normalizeCategory(value: unknown) {
  const normalized = normalizeString(value);
  return normalized || null;
}

function parseTags(input: unknown) {
  const tags = new Set<string>();
  if (Array.isArray(input)) {
    for (const tag of input) {
      const value = normalizeString(tag);
      if (value) tags.add(value);
    }
  } else if (typeof input === "string") {
    for (const raw of input.split(",")) {
      const value = normalizeString(raw);
      if (value) tags.add(value);
    }
  }
  return Array.from(tags);
}

async function parsePayload(request: Request): Promise<IncomingPostPayload> {
  const contentType = request.headers.get("content-type") ?? "";
  if (contentType.startsWith("multipart/form-data")) {
    const formData = await request.formData();
    const tags = new Set<string>();
    const tagsField = formData.get("tags");
    if (typeof tagsField === "string") {
      for (const raw of tagsField.split(",")) {
        const value = normalizeString(raw);
        if (value) tags.add(value);
      }
    }
    for (const raw of formData.getAll("tag")) {
      const value = normalizeString(raw);
      if (value) tags.add(value);
    }

    const imageCandidate = formData.get("image");
    const imageFile = imageCandidate instanceof File && imageCandidate.size > 0 ? imageCandidate : null;

    const hasBody = formData.has("body");
    const hasSummary = formData.has("summary");
    const hasTitle = formData.has("title");
    const hasPublishedAt = formData.has("publishedAt");

    return {
      slug: normalizeString(formData.get("slug")),
      title: hasTitle ? normalizeString(formData.get("title")) : undefined,
      summary: hasSummary ? normalizeString(formData.get("summary")) : undefined,
      body: hasBody ? (formData.get("body") ?? "").toString() : undefined,
      categoryId: formData.has("categoryId") ? normalizeCategory(formData.get("categoryId")) : undefined,
      subcategoryId: formData.has("subcategoryId") ? normalizeCategory(formData.get("subcategoryId")) : undefined,
      publishedAt: hasPublishedAt ? normalizeString(formData.get("publishedAt")) : undefined,
      updatedAtBase: formData.has("updatedAtBase") ? normalizeString(formData.get("updatedAtBase")) : undefined,
      tags: Array.from(tags),
      imageFile,
    };
  }

  const payload = (await request.json()) as any;
  return {
    slug: normalizeString(payload.slug),
    title: normalizeString(payload.title),
    summary: normalizeString(payload.summary),
    body: (payload.body ?? "").toString(),
    categoryId: normalizeCategory(payload.categoryId),
    subcategoryId: normalizeCategory(payload.subcategoryId),
    publishedAt: normalizeString(payload.publishedAt),
    updatedAtBase: normalizeString(payload.updatedAtBase),
    tags: parseTags(payload.tags),
  };
}

async function uploadCoverImage(context: ActionFunctionArgs["context"], file: File, slug: string) {
  if (file.type && !file.type.startsWith("image/")) {
    throw Response.json({ error: "僅支援上傳圖片" }, { status: 400 });
  }
  const bucket = requireBlogImagesBucket(context);
  const publicBase = requireBlogImagesPublicBase(context);
  const processed = await processCoverImage(file);
  const key = `posts/${slug}/cover.webp`;
  await bucket.put(key, processed.data, {
    httpMetadata: {
      contentType: processed.contentType,
      cacheControl: "public, max-age=31536000, immutable",
    },
  });
  return buildPublicImageUrl(publicBase, key);
}

export async function loader({ request, context }: LoaderFunctionArgs) {
  requireAdmin(request, context);
  const url = new URL(request.url);
  const slug = url.searchParams.get("slug");
  if (!slug) {
    throw Response.json({ error: "slug is required" }, { status: 400 });
  }
  const db = requireBlogDb(context);
  const post = await getBlogPostBySlug(db, slug);
  if (!post) {
    throw Response.json({ error: "Post not found" }, { status: 404 });
  }
  return Response.json(post);
}

async function handlePost(request: Request, context: ActionFunctionArgs["context"]) {
  const payload = await parsePayload(request);
  const title = normalizeString(payload.title);
  const body = (payload.body ?? "").toString();
  const summary = normalizeString(payload.summary);
  const categoryId = normalizeCategory(payload.categoryId);
  const subcategoryId = normalizeCategory(payload.subcategoryId);

  if (!title || !body) {
    throw Response.json({ error: "title and body are required" }, { status: 400 });
  }
  const slugInput = payload.slug || title;
  const slug = slugify(slugInput) || slugify(`${title}-${Date.now()}`);
  const now = new Date().toISOString();
  const publishedAt = normalizeIsoDate(payload.publishedAt, now);
  const createdAt = payload.createdAt ?? now;
  const updatedAt = now;

  const db = requireBlogDb(context);
  const existing = await getBlogPostBySlug(db, slug);
  if (existing) {
    throw Response.json({ error: "slug already exists" }, { status: 409 });
  }

  const tags = JSON.stringify(parseTags(payload.tags));
  let imageUrl: string | null = null;
  if (payload.imageFile) {
    imageUrl = await uploadCoverImage(context, payload.imageFile, slug);
  }

  await db
    .prepare(
      `INSERT INTO blog_posts
        (slug, title, summary, body, image_url, tags, category_id, subcategory_id, published_at, created_at, updated_at)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
    )
    .bind(slug, title, summary, body, imageUrl, tags, categoryId, subcategoryId, publishedAt, createdAt, updatedAt)
    .run();

  return Response.json({ ok: true, slug, imageUrl });
}

async function handlePut(request: Request, context: ActionFunctionArgs["context"]) {
  const url = new URL(request.url);
  const slug = url.searchParams.get("slug");
  if (!slug) {
    throw Response.json({ error: "slug is required" }, { status: 400 });
  }

  const payload = await parsePayload(request);

  const db = requireBlogDb(context);
  const existing = await getBlogPostBySlug(db, slug);
  if (!existing) {
    throw Response.json({ error: "Post not found" }, { status: 404 });
  }
  if (!payload.updatedAtBase) {
    throw Response.json({ error: "updatedAtBase is required" }, { status: 400 });
  }
  if (existing.updatedAt !== payload.updatedAtBase) {
    throw Response.json({ error: "Post was updated elsewhere" }, { status: 409 });
  }

  const title = normalizeString(payload.title) || existing.title;
  const summary = normalizeString(payload.summary) || existing.summary;
  const body = (payload.body ?? existing.body).toString();
  const tags = JSON.stringify(parseTags(payload.tags ?? existing.tags));
  const categoryId = normalizeCategory(payload.categoryId ?? existing.categoryId);
  const subcategoryId = normalizeCategory(payload.subcategoryId ?? existing.subcategoryId);
  const publishedAt = normalizeIsoDate(payload.publishedAt ?? existing.publishedAt, existing.publishedAt);
  const updatedAt = normalizeIsoDate(payload.updatedAt ?? new Date().toISOString(), new Date().toISOString());

  let imageUrl = existing.imageUrl ?? null;
  if (payload.imageFile) {
    imageUrl = await uploadCoverImage(context, payload.imageFile, slug);
  }

  await db
    .prepare(
      `UPDATE blog_posts
       SET title = ?, summary = ?, body = ?, image_url = ?, tags = ?, category_id = ?, subcategory_id = ?, published_at = ?, updated_at = ?
       WHERE slug = ?`,
    )
    .bind(title, summary, body, imageUrl, tags, categoryId, subcategoryId, publishedAt, updatedAt, slug)
    .run();

  const refreshed = await getBlogPostBySlug(db, slug);
  return Response.json({ ok: true, post: refreshed });
}

export async function action({ request, context }: ActionFunctionArgs) {
  requireAdmin(request, context);
  switch (request.method.toUpperCase()) {
    case "POST":
      return handlePost(request, context);
    case "PUT":
      return handlePut(request, context);
    default:
      throw Response.json({ error: "Method not allowed" }, { status: 405 });
  }
}

```

---
### app\routes\blog.$slug.tsx
```tsx
import { type CSSProperties, useMemo } from "react";
import { Link, useLoaderData } from "react-router";
import type { LoaderFunctionArgs } from "react-router";

import { loadBlogCategories } from "../lib/blog.server";
import type { BlogPost, BlogCategory } from "../lib/blog.types";
import { requireBlogDb } from "../lib/d1.server";
import { getBlogPostBySlug } from "../lib/blog.d1.server";
import { deriveAccentColor } from "../lib/blog-accent";

type LoaderData = {
  post: BlogPost;
  categories: BlogCategory[];
  accent: string;
};

function formatDate(date: string) {
  try {
    return new Intl.DateTimeFormat("zh-Hant", {
      year: "numeric",
      month: "short",
      day: "numeric",
    }).format(new Date(date));
  } catch {
    return date;
  }
}

function paragraphize(body: string) {
  return body
    .split(/\n+/)
    .map((line) => line.trim())
    .filter(Boolean);
}

function formatCategory(post: BlogPost, categories: BlogCategory[]) {
  const category = categories.find((c) => c.id === post.categoryId);
  const sub = category?.children.find((child) => child.id === post.subcategoryId);
  if (category && sub) return `${category.title} / ${sub.title}`;
  if (category) return category.title;
  return "未分類";
}

export async function loader({ params, context }: LoaderFunctionArgs) {
  const slug = params.slug;
  if (!slug) {
    throw Response.json({ error: "slug is required" }, { status: 400 });
  }
  const db = requireBlogDb(context);
  const post = await getBlogPostBySlug(db, slug);
  if (!post) {
    throw Response.json({ error: "Post not found" }, { status: 404 });
  }
  const categories = await loadBlogCategories();
  const accent = deriveAccentColor(post, categories);
  return Response.json({ post, categories, accent });
}

export default function BlogPostPage() {
  const { post, categories, accent } = useLoaderData() as LoaderData;
  const categoryLabel = formatCategory(post, categories);
  const accentStyle = useMemo(() => ({ "--post-accent": accent } as CSSProperties), [accent]);
  const paragraphs = useMemo(() => paragraphize(post.body), [post.body]);

  return (
    <div className="min-h-screen pb-12" style={accentStyle}>
      <section className="relative isolate h-72 w-full overflow-hidden bg-[color:var(--post-accent)]/10">
        {post.imageUrl ? (
          <img src={post.imageUrl} alt={post.title} className="absolute inset-0 h-full w-full object-cover" />
        ) : (
          <div className="absolute inset-0 bg-gradient-to-br from-[color:var(--post-accent)]/35 via-white to-[color:var(--post-accent)]/15" />
        )}
        <div className="absolute inset-0 bg-gradient-to-b from-black/35 via-black/15 to-white" />
        <div className="relative mx-auto flex h-full max-w-5xl items-end px-4 pb-8 text-white">
          <div className="space-y-3">
            <div className="flex flex-wrap items-center gap-3 text-[11px] uppercase tracking-[0.22em]">
              <span className="rounded-full bg-white/20 px-3 py-1 font-semibold text-white/90">{categoryLabel}</span>
              <span className="rounded-full bg-white/18 px-3 py-1 font-semibold text-white/80">
                {formatDate(post.publishedAt)}
              </span>
            </div>
            <h1 className="text-3xl font-bold leading-tight drop-shadow-sm md:text-4xl">{post.title}</h1>
            {post.tags?.length ? (
              <div className="flex flex-wrap gap-2">
                {post.tags.slice(0, 6).map((tag) => (
                  <span
                    key={tag}
                    className="rounded-full bg-white/15 px-3 py-1 text-xs font-medium text-white/90 backdrop-blur"
                  >
                    #{tag}
                  </span>
                ))}
              </div>
            ) : null}
          </div>
        </div>
      </section>

      <main className="mx-auto mt-8 flex max-w-4xl flex-col gap-6 px-4">
        <div className="flex flex-wrap items-center gap-2 text-sm text-neutral-600">
          <Link to="/blog" className="text-sm font-medium text-[color:var(--post-accent)] hover:underline">
            ← 返回列表
          </Link>
          <span className="rounded-full border border-[color:var(--post-accent)]/40 bg-[color:var(--post-accent)]/10 px-3 py-1 text-xs font-semibold text-neutral-700">
            {categoryLabel}
          </span>
          <span className="rounded-full border border-[color:var(--post-accent)]/30 bg-white px-3 py-1 text-xs text-neutral-600">
            {formatDate(post.publishedAt)}
          </span>
        </div>

        <article className="rounded-2xl border border-[color:var(--post-accent)]/20 bg-white/95 p-6 shadow-sm">
          <div className="mb-4 h-1 w-16 rounded-full bg-[color:var(--post-accent)]/70" />
          <div className="space-y-6 text-neutral-800">
            {paragraphs.map((paragraph, index) => (
              <p key={index} className="leading-relaxed">
                {paragraph}
              </p>
            ))}
          </div>
        </article>
      </main>
    </div>
  );
}

```

---
### app\routes\blog.tsx
```tsx
import { type CSSProperties } from "react";
import { Link, useLoaderData } from "react-router";
import type { LoaderFunctionArgs } from "react-router";

import { loadBlogCategories } from "../lib/blog.server";
import type { BlogCategory, BlogPost } from "../lib/blog.types";
import { getAllBlogPosts } from "../lib/blog.d1.server";
import { requireBlogDb } from "../lib/d1.server";
import { deriveAccentColor } from "../lib/blog-accent";

function formatDate(date: string) {
  try {
    return new Intl.DateTimeFormat("zh-Hant", {
      year: "numeric",
      month: "short",
      day: "numeric",
    }).format(new Date(date));
  } catch {
    return date;
  }
}

function paragraphize(body: string) {
  return body
    .split(/\n+/)
    .map((line) => line.trim())
    .filter(Boolean);
}

function formatCategory(post: BlogPost, categories: BlogCategory[]) {
  const category = categories.find((c) => c.id === post.categoryId);
  const sub = category?.children.find((child) => child.id === post.subcategoryId);
  if (category && sub) return `${category.title} / ${sub.title}`;
  if (category) return category.title;
  return "未分類";
}

function buildExcerpt(post: BlogPost) {
  const paragraph = post.summary || paragraphize(post.body)[0] || "";
  if (!paragraph) return "";
  return paragraph.length > 160 ? `${paragraph.slice(0, 157)}…` : paragraph;
}

function buildLink(categoryId?: string | null, subcategoryId?: string | null) {
  const params = new URLSearchParams();
  if (categoryId) params.set("category", categoryId);
  if (subcategoryId) params.set("subcategory", subcategoryId);
  const query = params.toString();
  return query ? `?${query}` : "";
}

export async function loader({ request, context }: LoaderFunctionArgs) {
  const url = new URL(request.url);
  const categoryId = url.searchParams.get("category");
  const subcategoryId = url.searchParams.get("subcategory");

  const categories = await loadBlogCategories();

  const db = requireBlogDb(context);
  const posts: BlogPost[] = await getAllBlogPosts(db);

  const selectedCategory = categories.find((cat) => cat.id === categoryId) ?? null;
  const selectedSubcategory = selectedCategory?.children.find((child) => child.id === subcategoryId) ?? null;

  const filteredPosts = posts.filter((post) => {
    if (selectedCategory && post.categoryId !== selectedCategory.id) return false;
    if (selectedSubcategory && post.subcategoryId !== selectedSubcategory.id) return false;
    return true;
  });

  return {
    categories,
    posts: filteredPosts,
    selectedCategoryId: selectedCategory?.id ?? null,
    selectedSubcategoryId: selectedSubcategory?.id ?? null,
  } satisfies {
    categories: BlogCategory[];
    posts: BlogPost[];
    selectedCategoryId: string | null;
    selectedSubcategoryId: string | null;
  };
}

export default function BlogPage() {
  const { categories, posts, selectedCategoryId, selectedSubcategoryId } = useLoaderData() as Awaited<
    ReturnType<typeof loader>
  >;

  return (
    <div className="mx-auto max-w-5xl px-4 py-12 space-y-12">
      <header className="space-y-4 text-center">
        <p className="eyebrow text-neutral-500">Blog</p>
        <h1 className="text-3xl md:text-4xl font-bold text-neutral-900">兩層分類的純文字筆記</h1>
        <p className="text-neutral-600 max-w-2xl mx-auto">
          從後台新增文章，這裡會根據分類即時顯示。先用文字與段落記錄想法，未來再補圖表與語法上色。
        </p>
      </header>

      <section className="grid gap-8 lg:grid-cols-[260px_1fr]">
        <aside className="space-y-4">
          <div className="card bg-white/90 p-5 space-y-4">
            <div>
              <p className="text-sm font-semibold text-neutral-800">分類</p>
              <p className="text-xs text-neutral-500">兩層架構，便於將文章歸檔。</p>
            </div>
            <div className="flex flex-wrap gap-2">
              <Link
                to={buildLink()}
                className={`chip ${!selectedCategoryId ? "bg-neutral-900 text-white" : ""}`.trim()}
              >
                全部文章
              </Link>
            </div>
            <div className="space-y-4">
              {categories.map((category) => (
                <div key={category.id} className="space-y-2">
                  <Link
                    to={buildLink(category.id)}
                    className={`flex items-center justify-between rounded-2xl border px-3 py-2 text-sm transition ${
                      selectedCategoryId === category.id
                        ? "bg-neutral-900 text-white border-neutral-900"
                        : "bg-white text-neutral-700 border-neutral-200"
                    }`}
                  >
                    <span>{category.title}</span>
                    <span className="text-xs text-neutral-500">{category.children.length} 子分類</span>
                  </Link>
                  {selectedCategoryId === category.id && category.children.length ? (
                    <div className="flex flex-wrap gap-2">
                      {category.children.map((child) => (
                        <Link
                          key={child.id}
                          to={buildLink(category.id, child.id)}
                          className={`chip ${
                            selectedSubcategoryId === child.id ? "bg-neutral-900 text-white" : ""
                          }`.trim()}
                        >
                          {child.title}
                        </Link>
                      ))}
                    </div>
                  ) : null}
                </div>
              ))}
            </div>
          </div>
        </aside>

        {posts.length ? (
          <div className="grid gap-6 sm:grid-cols-2 xl:grid-cols-3">
            {posts.map((post) => {
              const accent = deriveAccentColor(post, categories);
              const excerpt = buildExcerpt(post);
              const categoryLabel = formatCategory(post, categories);
              return (
                <Link
                  key={(post.filename ?? post.slug ?? post.title) + post.publishedAt}
                  to={`/blog/${post.slug}`}
                  className="group h-full"
                  style={{ "--post-accent": accent } as CSSProperties}
                >
                  <article className="flex h-full flex-col overflow-hidden rounded-2xl border border-[color:rgba(0,0,0,0.08)] bg-white/95 shadow-sm transition hover:-translate-y-1 hover:shadow-lg">
                    <div className="relative h-48 w-full overflow-hidden">
                      {post.imageUrl ? (
                        <img
                          src={post.imageUrl}
                          alt={post.title}
                          loading="lazy"
                          className="h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]"
                        />
                      ) : (
                        <div className="flex h-full w-full items-center justify-center bg-[color:var(--post-accent)]/15 text-xs font-medium text-neutral-600">
                          封面待補
                        </div>
                      )}
                      <div className="pointer-events-none absolute inset-x-0 bottom-0 h-12 bg-gradient-to-t from-white/95 via-white/40 to-transparent" />
                    </div>

                    <div className="flex flex-1 flex-col gap-3 p-6">
                      <div className="flex items-center justify-between text-[11px] uppercase tracking-[0.24em] text-neutral-500">
                        <span>{formatDate(post.publishedAt)}</span>
                        <span className="rounded-full bg-[color:var(--post-accent)]/15 px-3 py-1 text-[10px] font-semibold text-[color:var(--post-accent)]">
                          {categoryLabel}
                        </span>
                      </div>
                      <h2 className="text-xl font-semibold text-neutral-900 transition group-hover:text-neutral-700">
                        {post.title}
                      </h2>
                      {excerpt ? (
                        <p
                          className="text-sm leading-relaxed text-neutral-700"
                          style={{
                            display: "-webkit-box",
                            WebkitLineClamp: 3,
                            WebkitBoxOrient: "vertical",
                            overflow: "hidden",
                          }}
                        >
                          {excerpt}
                        </p>
                      ) : null}
                      {post.tags?.length ? (
                        <div className="mt-auto flex flex-wrap gap-2 pt-2">
                          {post.tags.slice(0, 4).map((tag) => (
                            <span
                              key={tag}
                              className="chip border-[color:var(--post-accent)]/60 bg-[color:var(--post-accent)]/10 text-[color:var(--post-accent)]"
                            >
                              #{tag}
                            </span>
                          ))}
                        </div>
                      ) : null}
                    </div>
                    <div className="h-1 bg-[color:var(--post-accent)]/60" />
                  </article>
                </Link>
              );
            })}
          </div>
        ) : (
          <p className="text-sm text-neutral-600">目前沒有符合條件的文章。</p>
        )}
      </section>
    </div>
  );
}

```

---
### app\routes\changelog.tsx
```tsx
// app/routes/changelog.tsx
import type { LoaderFunctionArgs } from "react-router";
import { useLoaderData, Link } from "react-router";
import { loadChangelogItems, type ChangelogItem } from "../lib/changelog.server";

export async function loader(args: LoaderFunctionArgs) {
  return loadChangelogItems(args);
}


function Tag({ t }: { t?: ChangelogItem["tag"] }) {
  const map = { add: "新增", fix: "修正", change: "變更", docs: "文件" } as const;
  return t ? <span className="chip">{map[t]}</span> : null;
}

export default function ChangelogPage() {
  const items = useLoaderData() as ChangelogItem[];
  return (
    <main className="mx-auto max-w-3xl px-4 py-12">
      <header className="mb-8">
        <h1 className="text-3xl font-bold">更新日誌</h1>
        {import.meta.env.DEV ? (
          <p className="mt-2 text-neutral-600">
            開發模式即時讀取檔案（app/content/changelog/）
          </p>
        ) : (
          <p className="mt-2 text-neutral-600">靜態內容（build 時打包）</p>
        )}
        <p className="mt-2"><Link to="/" className="link-soft">回首頁</Link></p>
      </header>

      <div className="space-y-4">
        {items.map((log, i) => (
          <article key={(log.filename ?? "") + i} className="card hover-raise">
            <div className="flex items-center gap-3 text-sm text-neutral-600">
              <time dateTime={log.date} className="font-medium text-neutral-800">{log.date}</time>
              <Tag t={log.tag} />
            </div>
            <h2 className="mt-2 text-lg font-semibold">{log.title}</h2>
            {log.notes?.length ? (
              <ul className="mt-2 list-disc pl-5 text-sm text-neutral-700 space-y-1">
                {log.notes.map((n, j) => <li key={j}>{n}</li>)}
              </ul>
            ) : null}
            {import.meta.env.DEV && log.filename ? (
              <p className="mt-2 text-xs text-neutral-400">{log.filename}</p>
            ) : null}
          </article>
        ))}
        {!items.length && (
          <p className="text-neutral-500">目前沒有日誌。到後台新增一筆試試。</p>
        )}
      </div>
    </main>
  );
}

```

---
### app\routes\outerspace\Gravity.tsx
```tsx
import React, { useState, useEffect, useRef } from 'react';
import { Rocket, Weight, Ruler, Thermometer, Info, ArrowRight, RotateCw, Play, Calculator, MousePointer2, Move } from 'lucide-react';
import type { Route } from "./+types/gravity";

// Meta 設定
export function meta({}: Route.MetaArgs) {
  return [
    { title: "Gravity Lab // 行星重力實驗室" },
    { name: "description", content: "計算與模擬太陽系行星重力" },
  ];
}

// 定義行星資料介面
interface PlanetBody {
  id: string;
  englishName: string;
  gravity: number;
  meanRadius: number;
  avgTemp: number;
  density: number;
  moons: { moon: string; rel: string }[] | null;
}

// 靜態備用數據
const FALLBACK_DATA: PlanetBody[] = [
  { id: 'mercury', englishName: 'Mercury', gravity: 3.7, meanRadius: 2439.7, avgTemp: 440, density: 5.427, moons: null },
  { id: 'venus', englishName: 'Venus', gravity: 8.87, meanRadius: 6051.8, avgTemp: 737, density: 5.243, moons: null },
  { id: 'earth', englishName: 'Earth', gravity: 9.8, meanRadius: 6371, avgTemp: 288, density: 5.514, moons: [{ moon: 'Moon', rel: '' }] },
  { id: 'moon', englishName: 'Moon', gravity: 1.62, meanRadius: 1737.1, avgTemp: 220, density: 3.344, moons: null },
  { id: 'mars', englishName: 'Mars', gravity: 3.71, meanRadius: 3389.5, avgTemp: 210, density: 3.933, moons: [{ moon: 'Phobos', rel: '' }, { moon: 'Deimos', rel: '' }] },
  { id: 'jupiter', englishName: 'Jupiter', gravity: 24.79, meanRadius: 69911, avgTemp: 165, density: 1.326, moons: Array(79).fill({ moon: 'x', rel: '' }) },
  { id: 'saturn', englishName: 'Saturn', gravity: 10.44, meanRadius: 58232, avgTemp: 134, density: 0.687, moons: Array(82).fill({ moon: 'x', rel: '' }) },
  { id: 'uranus', englishName: 'Uranus', gravity: 8.69, meanRadius: 25362, avgTemp: 76, density: 1.271, moons: Array(27).fill({ moon: 'x', rel: '' }) },
  { id: 'neptune', englishName: 'Neptune', gravity: 11.15, meanRadius: 24622, avgTemp: 72, density: 1.638, moons: Array(14).fill({ moon: 'x', rel: '' }) },
  { id: 'pluto', englishName: 'Pluto', gravity: 0.62, meanRadius: 1188.3, avgTemp: 44, density: 1.88, moons: Array(5).fill({ moon: 'x', rel: '' }) },
];

// --- 物理模擬畫布組件 ---
const GravityPlayground = ({ gravity, planetName }: { gravity: number, planetName: string }) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);
  
  // 物理狀態
  const physicsRef = useRef({
    x: 100, y: 100, // 位置
    vx: 5, vy: 0,   // 速度
    radius: 30,
    isDragging: false,
    lastX: 0, lastY: 0, // 用於計算投擲速度
    trail: [] as {x: number, y: number, alpha: number}[] // 軌跡
  });

  useEffect(() => {
    const canvas = canvasRef.current;
    const container = containerRef.current;
    if (!canvas || !container) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    // 調整畫布大小
    const resize = () => {
      canvas.width = container.clientWidth;
      canvas.height = container.clientHeight;
    };
    resize();
    window.addEventListener('resize', resize);

    let animationId: number;
    const scale = 20; // 物理縮放比例 (1 meter = 20 pixels)

    const update = () => {
      const p = physicsRef.current;
      const width = canvas.width;
      const height = canvas.height;

      // 清空畫布
      ctx.fillStyle = '#0f172a'; // slate-950
      ctx.fillRect(0, 0, width, height);

      // 繪製背景網格 (每 100px)
      ctx.strokeStyle = '#1e293b';
      ctx.lineWidth = 1;
      ctx.beginPath();
      for(let i=0; i<width; i+=100) { ctx.moveTo(i,0); ctx.lineTo(i,height); }
      for(let i=0; i<height; i+=100) { ctx.moveTo(0,i); ctx.lineTo(width,i); }
      ctx.stroke();

      // --- 物理運算 ---
      if (!p.isDragging) {
        // 重力 (Gravity) - F = ma
        // 這裡簡化為速度每幀增加 (gravity * scale * dt)
        // 假設 60fps, dt 約 0.016s
        p.vy += (gravity * scale) * 0.016; 
        
        // 空氣阻力 (Air Resistance) - 簡單模擬
        p.vx *= 0.99;
        p.vy *= 0.99;

        // 更新位置
        p.x += p.vx;
        p.y += p.vy;

        // 地板碰撞 (Bounce)
        if (p.y + p.radius > height) {
          p.y = height - p.radius;
          p.vy *= -0.7; // 彈性係數 (損失能量)
          // 防止在地板微小抖動
          if (Math.abs(p.vy) < gravity) p.vy = 0;
          // 地板摩擦力
          p.vx *= 0.9;
        }
        // 天花板碰撞
        if (p.y - p.radius < 0) {
          p.y = p.radius;
          p.vy *= -0.7;
        }
        // 牆壁碰撞
        if (p.x + p.radius > width) {
          p.x = width - p.radius;
          p.vx *= -0.7;
        }
        if (p.x - p.radius < 0) {
          p.x = p.radius;
          p.vx *= -0.7;
        }
      }

      // --- 繪製軌跡 ---
      if (Math.abs(p.vx) > 0.1 || Math.abs(p.vy) > 0.1 || p.isDragging) {
         p.trail.push({ x: p.x, y: p.y, alpha: 1.0 });
      }
      if (p.trail.length > 50) p.trail.shift(); // 限制軌跡長度

      p.trail.forEach((point, index) => {
        point.alpha -= 0.02; // 慢慢消失
        if (point.alpha > 0) {
          ctx.beginPath();
          ctx.arc(point.x, point.y, 3, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(99, 102, 241, ${point.alpha})`; // Indigo color
          ctx.fill();
        }
      });
      // 清理完全消失的點
      p.trail = p.trail.filter(t => t.alpha > 0);

      // --- 繪製物體 (箱子) ---
      ctx.save();
      ctx.translate(p.x, p.y);
      // 根據速度稍微旋轉 (視覺效果)
      if (!p.isDragging) ctx.rotate((p.vx * 0.1)); 
      
      // 箱子本體
      ctx.fillStyle = p.isDragging ? '#818cf8' : '#6366f1'; // indigo-400 / indigo-500
      ctx.shadowColor = 'rgba(99, 102, 241, 0.5)';
      ctx.shadowBlur = 20;
      // 畫圓角矩形
      ctx.beginPath();
      ctx.roundRect(-p.radius, -p.radius, p.radius*2, p.radius*2, 10);
      ctx.fill();
      
      // 箱子上的文字 (重力值)
      ctx.fillStyle = 'white';
      ctx.font = 'bold 12px monospace';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(`${gravity}g`, 0, 0);
      
      ctx.restore();

      // --- 繪製互動提示 ---
      if (!p.isDragging && Math.abs(p.vx) < 0.5 && Math.abs(p.vy) < 0.5 && p.y > height - p.radius - 5) {
         ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
         ctx.font = '12px sans-serif';
         ctx.textAlign = 'center';
         ctx.fillText("Drag me!", p.x, p.y - p.radius - 15);
      }

      animationId = requestAnimationFrame(update);
    };

    animationId = requestAnimationFrame(update);
    return () => {
      cancelAnimationFrame(animationId);
      window.removeEventListener('resize', resize);
    };
  }, [gravity]); // 當重力改變時，這個 effect 不需要重啟，但 gravity 變數會在 render loop 中被讀取

  // --- 滑鼠互動處理 ---
  const handlePointerDown = (e: React.PointerEvent) => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;

    const p = physicsRef.current;
    const dist = Math.sqrt((mouseX - p.x) ** 2 + (mouseY - p.y) ** 2);

    if (dist < p.radius * 2) { // 增加一點判定範圍比較好抓
      p.isDragging = true;
      p.vx = 0;
      p.vy = 0;
      canvas.setPointerCapture(e.pointerId);
    }
  };

  const handlePointerMove = (e: React.PointerEvent) => {
    const p = physicsRef.current;
    if (p.isDragging) {
      const canvas = canvasRef.current;
      if (!canvas) return;
      const rect = canvas.getBoundingClientRect();
      
      // 記錄上一幀位置來計算投擲速度
      p.lastX = p.x;
      p.lastY = p.y;
      
      p.x = e.clientX - rect.left;
      p.y = e.clientY - rect.top;
    }
  };

  const handlePointerUp = (e: React.PointerEvent) => {
    const p = physicsRef.current;
    if (p.isDragging) {
      p.isDragging = false;
      const canvas = canvasRef.current;
      if (!canvas) return;
      const rect = canvas.getBoundingClientRect();
      const currentX = e.clientX - rect.left;
      const currentY = e.clientY - rect.top;
      
      // 計算投擲速度 (簡單的微分)
      // 增加係數讓投擲更有力
      p.vx = (currentX - p.lastX) * 1.5; 
      p.vy = (currentY - p.lastY) * 1.5;
    }
  };

  return (
    <div ref={containerRef} className="w-full h-full min-h-[400px] relative rounded-3xl overflow-hidden border border-slate-700 bg-slate-900 shadow-2xl">
      <div className="absolute top-4 left-4 pointer-events-none select-none z-10">
         <div className="bg-slate-950/80 backdrop-blur px-4 py-2 rounded-lg border border-indigo-500/30 text-indigo-400 font-mono text-sm">
            <div className="flex items-center gap-2 font-bold">
               <RotateCw size={14} className="animate-spin-slow" />
               PHYSICS ENGINE
            </div>
            <div className="text-white text-lg mt-1">PLANET: {planetName}</div>
            <div className="text-slate-400">G-FORCE: {gravity} m/s²</div>
         </div>
      </div>
      <canvas 
        ref={canvasRef}
        className="w-full h-full cursor-grab active:cursor-grabbing touch-none"
        onPointerDown={handlePointerDown}
        onPointerMove={handlePointerMove}
        onPointerUp={handlePointerUp}
        onPointerLeave={handlePointerUp}
      />
    </div>
  );
};

export default function GravityLab() {
  const [userWeight, setUserWeight] = useState<number | string>(60);
  const [planets, setPlanets] = useState<PlanetBody[]>([]);
  const [loading, setLoading] = useState(true);
  const [selectedPlanet, setSelectedPlanet] = useState<PlanetBody | null>(null);
  const [useFallback, setUseFallback] = useState(false);
  const [viewMode, setViewMode] = useState<'calculator' | 'simulation'>('calculator'); // 新增模式切換

  useEffect(() => {
    const fetchPlanets = async () => {
      setLoading(true);
      try {
        const response = await fetch('https://api.le-systeme-solaire.net/rest/bodies?data=id,englishName,gravity,meanRadius,avgTemp,density,moons');
        if (!response.ok) throw new Error(`API Error: ${response.status}`);
        const data = await response.json();
        processData(data.bodies);
        setUseFallback(false);
      } catch (error) {
        console.warn("Using offline database.", error);
        processData(FALLBACK_DATA);
        setUseFallback(true);
      } finally {
        setLoading(false);
      }
    };
    fetchPlanets();
  }, []);

  const processData = (rawData: any[]) => {
    const targetPlanets = ['mercury', 'venus', 'earth', 'mars', 'jupiter', 'saturn', 'uranus', 'neptune', 'pluto', 'moon'];
    const filtered = rawData.filter((b: any) => targetPlanets.includes(b.englishName.toLowerCase()));
    const orderMap: Record<string, number> = {
        'mercury': 1, 'venus': 2, 'earth': 3, 'moon': 3.5, 'mars': 4, 
        'jupiter': 5, 'saturn': 6, 'uranus': 7, 'neptune': 8, 'pluto': 9
    };
    const sorted = filtered.sort((a: any, b: any) => (orderMap[a.englishName.toLowerCase()] || 10) - (orderMap[b.englishName.toLowerCase()] || 10));
    setPlanets(sorted);
    const mars = sorted.find((p: any) => p.englishName.toLowerCase() === 'mars');
    if (mars && !selectedPlanet) setSelectedPlanet(mars);
  };

  const calculateWeight = (gravity: number) => {
    const weightNum = Number(userWeight);
    if (!weightNum) return 0;
    return (weightNum * (gravity / 9.8)).toFixed(1);
  };

  const getPlanetStyle = (name: string) => {
    const styles: Record<string, string> = {
      Mercury: "bg-stone-400", Venus: "bg-orange-300", Earth: "bg-blue-500", Moon: "bg-gray-300",
      Mars: "bg-red-500", Jupiter: "bg-orange-200", Saturn: "bg-yellow-200", Uranus: "bg-cyan-300",
      Neptune: "bg-blue-600", Pluto: "bg-slate-300",
    };
    return styles[name] || "bg-slate-500";
  };

  return (
    <div className="w-full min-h-screen bg-slate-950 text-slate-200 p-4 md:p-8 font-sans selection:bg-indigo-500 selection:text-white pb-20">
      <div className="max-w-6xl mx-auto">
        
        {/* Header */}
        <header className="mb-8 flex flex-col md:flex-row justify-between items-center gap-6">
          <div className="text-center md:text-left">
             <div className="inline-flex items-center gap-2 text-indigo-400 font-bold tracking-widest text-xs mb-2 bg-indigo-500/10 px-3 py-1 rounded-full border border-indigo-500/20">
                <Rocket size={14} /> SOLAR SYSTEM LAB
             </div>
             <h1 className="text-3xl md:text-4xl font-bold text-white">Planetary Gravity</h1>
          </div>

          {/* 模式切換按鈕 (Tab Switcher) */}
          <div className="bg-slate-900 p-1 rounded-xl border border-slate-800 flex shadow-lg">
             <button 
                onClick={() => setViewMode('calculator')}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg text-sm font-bold transition-all ${viewMode === 'calculator' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
             >
                <Calculator size={18} /> Weight Analysis
             </button>
             <button 
                onClick={() => setViewMode('simulation')}
                className={`flex items-center gap-2 px-6 py-3 rounded-lg text-sm font-bold transition-all ${viewMode === 'simulation' ? 'bg-indigo-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
             >
                <Play size={18} /> Physics Sim
             </button>
          </div>
        </header>

        {loading ? (
          <div className="text-center text-indigo-400 animate-pulse py-20">Scanning Solar System...</div>
        ) : (
          <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            {/* 左側：行星導航 (Sidebar) */}
            <div className="lg:col-span-3 space-y-2 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar">
               {planets.map(planet => (
                  <button
                    key={planet.id}
                    onClick={() => setSelectedPlanet(planet)}
                    className={`w-full flex items-center gap-3 p-3 rounded-xl border transition-all duration-200 group ${
                      selectedPlanet?.id === planet.id 
                      ? 'bg-slate-800 border-indigo-500 shadow-lg scale-[1.02]' 
                      : 'bg-slate-900/40 border-slate-800 hover:bg-slate-800 hover:border-slate-700'
                    }`}
                  >
                    <div className={`w-8 h-8 rounded-full ${getPlanetStyle(planet.englishName)} shadow-inner shrink-0`} />
                    <div className="text-left flex-1 min-w-0">
                      <div className={`font-bold truncate ${selectedPlanet?.id === planet.id ? 'text-white' : 'text-slate-300'}`}>
                        {planet.englishName}
                      </div>
                      <div className="text-xs text-slate-500 font-mono">
                        {planet.gravity} m/s²
                      </div>
                    </div>
                  </button>
                ))}
            </div>

            {/* 右側：主要顯示區 (根據模式切換) */}
            <div className="lg:col-span-9">
              {selectedPlanet && (
                <div className="h-full flex flex-col gap-6 animate-in fade-in zoom-in-95 duration-300">
                  
                  {viewMode === 'calculator' ? (
                    /* --- 模式一：計算器視圖 --- */
                    <div className="bg-slate-900 border border-slate-800 rounded-3xl p-8 relative overflow-hidden shadow-2xl">
                      {/* 背景光暈 */}
                      <div className={`absolute -top-32 -right-32 w-96 h-96 rounded-full blur-[120px] opacity-20 ${getPlanetStyle(selectedPlanet.englishName)}`} />
                      
                      <div className="relative z-10">
                        <div className="flex flex-col md:flex-row gap-8 items-start md:items-center justify-between mb-12">
                           <div>
                              <h2 className="text-5xl font-bold text-white mb-2">{selectedPlanet.englishName}</h2>
                              <div className="text-slate-400">Surface Gravity Analysis</div>
                           </div>
                           {/* 體重輸入 */}
                           <div className="bg-slate-950/50 p-4 rounded-2xl border border-slate-800 flex flex-col items-center">
                              <label className="text-xs text-slate-500 font-bold mb-2 uppercase">Input Earth Weight</label>
                              <div className="flex items-center gap-2">
                                <input 
                                  type="number" 
                                  value={userWeight}
                                  onChange={(e) => setUserWeight(e.target.value)}
                                  className="w-24 bg-transparent text-3xl font-bold text-center text-white focus:outline-none border-b-2 border-slate-700 focus:border-indigo-500 transition-colors"
                                />
                                <span className="text-slate-500 font-bold mt-2">kg</span>
                              </div>
                           </div>
                        </div>

                        {/* 結果展示 */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                           <div className="bg-gradient-to-br from-indigo-500/10 to-purple-500/10 border border-indigo-500/20 rounded-2xl p-6 flex flex-col justify-center items-center text-center">
                              <div className="text-slate-400 font-medium mb-1">Weight on {selectedPlanet.englishName}</div>
                              <div className="text-7xl font-bold text-white tracking-tighter drop-shadow-lg">
                                 {calculateWeight(selectedPlanet.gravity)}
                              </div>
                              <div className="text-indigo-400 font-bold mt-2">kilograms</div>
                           </div>
                           
                           <div className="grid grid-cols-2 gap-3">
                              <InfoCard icon={<Weight className="text-blue-400" />} label="Gravity" value={`${selectedPlanet.gravity} m/s²`} sub="Acceleration" />
                              <InfoCard icon={<Thermometer className="text-red-400" />} label="Temp" value={`${(selectedPlanet.avgTemp - 273.15).toFixed(0)}°C`} sub="Average" />
                              <InfoCard icon={<Ruler className="text-green-400" />} label="Radius" value={`${(selectedPlanet.meanRadius).toLocaleString()} km`} sub="Mean Radius" />
                              <InfoCard icon={<Info className="text-purple-400" />} label="Moons" value={selectedPlanet.moons ? selectedPlanet.moons.length : 0} sub="Satellites" />
                           </div>
                        </div>
                      </div>
                    </div>
                  ) : (
                    /* --- 模式二：物理模擬視圖 --- */
                    <div className="h-[500px] lg:h-[600px] flex flex-col gap-4">
                       <div className="bg-slate-800/50 border border-slate-700/50 rounded-xl p-4 flex items-center justify-between">
                          <div className="flex items-center gap-3">
                             <div className="p-2 bg-indigo-500 rounded-lg text-white">
                                <Move size={20} />
                             </div>
                             <div>
                                <h3 className="font-bold text-white">Interactive Chamber</h3>
                                <p className="text-xs text-slate-400">Drag & Throw the box to test gravity</p>
                             </div>
                          </div>
                          <div className="text-right hidden sm:block">
                             <div className="text-2xl font-bold text-indigo-400">{selectedPlanet.gravity} <span className="text-sm text-slate-500">m/s²</span></div>
                             <div className="text-xs text-slate-500">Current Gravity</div>
                          </div>
                       </div>
                       
                       {/* 物理畫布 */}
                       <GravityPlayground gravity={selectedPlanet.gravity} planetName={selectedPlanet.englishName} />
                       
                       <div className="flex gap-4 text-xs text-slate-500 justify-center">
                          <span className="flex items-center gap-1"><MousePointer2 size={12} /> Click & Drag to grab object</span>
                          <span className="flex items-center gap-1"><Move size={12} /> Release while moving to throw</span>
                       </div>
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// 小元件：資訊卡
const InfoCard = ({ icon, label, value, sub }: any) => (
  <div className="bg-slate-900/50 p-4 rounded-xl border border-slate-800 flex flex-col justify-center">
    <div className="flex items-center gap-2 mb-2">
      {icon}
      <span className="text-xs text-slate-500 font-bold uppercase">{label}</span>
    </div>
    <div className="text-xl font-bold text-slate-200">{value}</div>
    <div className="text-xs text-slate-600">{sub}</div>
  </div>
);
```

---
### app\routes\outerspace\index.tsx
```tsx
import { Link } from "react-router";

const EXPERIMENTS = [
  {
    title: "OuterSpace Senter",
    description: "全螢幕 3D 軌道監控介面，Three.js 地球、遙測曲線與可拖曳的返回按鈕。",
    path: "/outerspace/OuterSpaceSenter",
    meta: "視覺實驗 / Three.js",
    points: ["地球視覺 + 玻璃質感 UI", "即時遙測與警示", "全螢幕獨立場景"],
  },
  {
    title: "XENO-DB",
    description: "PokeAPI 生物資料庫介面，雷達圖、資料表與叫聲播放都在一個卡片中。",
    path: "/outerspace/PokeAPIcreatures",
    meta: "資料串接 / PokeAPI",
    points: ["API 取數並整理指標", "雷達圖視覺化", "支援音效與翻轉卡"],
  },
  {
    title: "Gravity Lab",
    description: "行星重力與拖曳模擬，切換行星即可感受不同 g 值與軌跡衰減。",
    path: "/outerspace/Gravity",
    meta: "物理模擬 / Canvas",
    points: ["即時重力計算", "拖曳與拋擲互動", "行星資料快速切換"],
  },
] as const;

export function meta() {
  return [
    { title: "OuterSpace 實驗索引" },
    { name: "description", content: "集中各種實驗性頁面的索引，主題不限太空。" },
  ];
}

export default function OuterSpaceIndexPage() {
  return (
    <main className="mx-auto max-w-5xl px-4 py-12 space-y-10">
      <header className="space-y-4">
        <p className="eyebrow text-neutral-600">OuterSpace</p>
        <h1 className="text-3xl md:text-4xl font-bold text-neutral-900">實驗索引</h1>
        <p className="text-neutral-700 max-w-3xl leading-relaxed">
          OuterSpace 是用來放各種實驗性頁面的區域，不限定太空主題。從這裡挑一個卡片進入，看到的就是實際頁面（其中有些會進入全螢幕模式並附上返回按鈕）。
        </p>
        <div className="flex flex-wrap gap-3">
          <Link to="/" className="link-soft">
            回首頁
          </Link>
          <Link to="/blog" className="link-soft">
            Blog
          </Link>
          <Link to="/changelog" className="link-soft">
            更新日誌
          </Link>
        </div>
      </header>

      <section className="grid gap-5 md:grid-cols-2">
        {EXPERIMENTS.map((item) => (
          <article key={item.path} className="card hover-raise h-full flex flex-col gap-3">
            <div className="text-xs uppercase tracking-[0.24em] text-neutral-500">{item.meta}</div>
            <h2 className="text-xl font-semibold text-neutral-900">{item.title}</h2>
            <p className="text-sm text-neutral-700 leading-relaxed">{item.description}</p>
            <ul className="mt-1 list-disc pl-5 text-sm text-neutral-700 space-y-1">
              {item.points.map((point) => (
                <li key={point}>{point}</li>
              ))}
            </ul>
            <Link to={item.path} className="btn-ghost w-fit mt-auto">
              進入實驗 →
            </Link>
          </article>
        ))}
      </section>
    </main>
  );
}

```

---
### app\routes\outerspace\OuterSpaceSenter.tsx
```tsx
import React, { useState, useEffect, useRef } from 'react';
import * as THREE from 'three';
import { Activity, Zap, Wind, Navigation, AlertTriangle, Clock, ArrowLeft } from 'lucide-react';
import { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import { useNavigate } from 'react-router';
import type { Route } from "./+types/dashboard"; // 支援 React Router v7 的型別 (可選)

// --- META 設定 (設定網頁標題) ---
export function meta({}: Route.MetaArgs) {
  return [
    { title: "ORION-7 // 軌道監控系統" },
    { name: "description", content: "即時 3D 太空站監控儀表板" },
  ];
}

// --- 子組件：Three.js 地球視圖 ---
const EarthView = ({ speed }: { speed: number }) => {
  const mountRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const container = mountRef.current;
    if (!container) return;

    // 1. 初始化
    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x020617, 0.035);

    const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    
    renderer.setSize(container.clientWidth, container.clientHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);

    // 2. 幾何體
    const geometry = new THREE.IcosahedronGeometry(2.5, 10);
    const material = new THREE.MeshPhongMaterial({ 
      color: 0x0f172a, 
      emissive: 0x1e3a8a,
      emissiveIntensity: 0.2,
      shininess: 50,
      flatShading: true
    });
    
    const wireframeMaterial = new THREE.MeshBasicMaterial({
       color: 0x06b6d4,
       wireframe: true,
       transparent: true,
       opacity: 0.15
    });

    const earth = new THREE.Mesh(geometry, material);
    const wireframe = new THREE.Mesh(geometry, wireframeMaterial);
    wireframe.scale.setScalar(1.001);
    earth.add(wireframe);
    scene.add(earth);

    // 光暈
    const glowGeo = new THREE.IcosahedronGeometry(2.8, 8);
    const glowMat = new THREE.MeshBasicMaterial({
        color: 0x3b82f6,
        transparent: true,
        opacity: 0.05,
        side: THREE.BackSide
    });
    const glow = new THREE.Mesh(glowGeo, glowMat);
    scene.add(glow);

    // 3. 燈光
    const ambientLight = new THREE.AmbientLight(0x404040, 2);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 2);
    directionalLight.position.set(5, 3, 5);
    scene.add(directionalLight);
    const pointLight = new THREE.PointLight(0x06b6d4, 1, 100);
    pointLight.position.set(-5, 2, 5);
    scene.add(pointLight);

    camera.position.z = 6;

    // 4. 動畫
    let animationFrameId: number;
    const animate = () => {
      animationFrameId = requestAnimationFrame(animate);
      
      const rotationSpeed = 0.001 + (speed - 27000) * 0.000005;
      earth.rotation.y += rotationSpeed;
      glow.rotation.y += rotationSpeed * 0.8;
      
      const time = Date.now() * 0.001;
      earth.position.y = Math.sin(time) * 0.1;

      renderer.render(scene, camera);
    };
    animate();

    // 5. Resize 處理
    const handleResize = () => {
      if (!container) return;
      const width = container.clientWidth;
      const height = container.clientHeight;
      renderer.setSize(width, height);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    };
    window.addEventListener('resize', handleResize);

    // 6. 清理
    return () => {
      window.removeEventListener('resize', handleResize);
      cancelAnimationFrame(animationFrameId);
      if (container && renderer.domElement) {
        container.removeChild(renderer.domElement);
      }
      geometry.dispose();
      material.dispose();
      renderer.dispose();
    };
  }, []); 

  return <div ref={mountRef} className="w-full h-full min-h-[400px]" />;
};

// --- 子組件：統計卡片 ---
const StatCard = ({ title, value, icon, trend, color }: any) => {
  const colorClasses: any = {
    blue: "from-blue-500/10 to-blue-600/5 border-blue-500/30 text-blue-400",
    yellow: "from-yellow-500/10 to-yellow-600/5 border-yellow-500/30 text-yellow-400",
    purple: "from-purple-500/10 to-purple-600/5 border-purple-500/30 text-purple-400",
  };

  return (
    <div className={`p-4 rounded-lg border bg-gradient-to-br backdrop-blur-sm ${colorClasses[color] || colorClasses.blue}`}>
      <div className="flex justify-between items-start mb-2">
        <h4 className="text-xs font-bold tracking-wider text-slate-400">{title}</h4>
        {icon}
      </div>
      <div className="flex items-end gap-2">
        <span className="text-2xl font-bold text-slate-100">{value}</span>
        <span className={`text-xs mb-1 ${trend === 'decreasing' ? 'text-red-400' : 'text-green-400'}`}>
           {trend === 'stable' ? '● STABLE' : '▼ DRAINING'}
        </span>
      </div>
      <div className="w-full h-1 bg-slate-700 mt-3 rounded-full overflow-hidden">
        <div className={`h-full w-2/3 animate-pulse bg-current opacity-50`}></div>
      </div>
    </div>
  );
};

const FloatingBackButton = () => {
  const navigate = useNavigate();
  const [position, setPosition] = useState({ x: 24, y: 24 });
  const dragRef = useRef<{ offsetX: number; offsetY: number; pointerId: number | null }>({
    offsetX: 0,
    offsetY: 0,
    pointerId: null,
  });

  useEffect(() => {
    if (typeof window === 'undefined') return;
    setPosition({
      x: window.innerWidth - 156,
      y: window.innerHeight - 96,
    });
  }, []);

  const clamp = (value: number, min: number, max: number) => Math.max(min, Math.min(max, value));

  const handlePointerDown = (event: React.PointerEvent<HTMLButtonElement>) => {
    dragRef.current = {
      offsetX: event.clientX - position.x,
      offsetY: event.clientY - position.y,
      pointerId: event.pointerId,
    };
    event.currentTarget.setPointerCapture(event.pointerId);
  };

  const handlePointerMove = (event: React.PointerEvent<HTMLButtonElement>) => {
    if (dragRef.current.pointerId !== event.pointerId) return;
    const maxX = typeof window === 'undefined' ? position.x : window.innerWidth - 112;
    const maxY = typeof window === 'undefined' ? position.y : window.innerHeight - 72;
    setPosition({
      x: clamp(event.clientX - dragRef.current.offsetX, 12, maxX),
      y: clamp(event.clientY - dragRef.current.offsetY, 12, maxY),
    });
  };

  const handlePointerUp = (event: React.PointerEvent<HTMLButtonElement>) => {
    if (dragRef.current.pointerId !== event.pointerId) return;
    dragRef.current.pointerId = null;
    event.currentTarget.releasePointerCapture(event.pointerId);
  };

  const handleBack = () => {
    if (window.history.length > 1) {
      navigate(-1);
    } else {
      navigate('/');
    }
  };

  return (
    <button
      type="button"
      onClick={handleBack}
      onPointerDown={handlePointerDown}
      onPointerMove={handlePointerMove}
      onPointerUp={handlePointerUp}
      className="fixed z-[10000] flex items-center gap-2 rounded-full bg-cyan-400 px-4 py-3 text-slate-900 font-semibold shadow-[0_10px_35px_rgba(6,182,212,0.35)] border border-white/60 active:scale-95 transition"
      style={{ left: position.x, top: position.y }}
    >
      <ArrowLeft size={18} />
      返回上一頁
    </button>
  );
};

// --- 主組件 ---
export default function SpaceStationDashboard() {
  const [metrics, setMetrics] = useState({
    oxygen: 98,
    fuel: 85,
    speed: 27500,
    temperature: 22,
    integrity: 100
  });

  const [dataHistory, setDataHistory] = useState<any[]>([]);
  const [systemTime, setSystemTime] = useState("00:00:00");
  const [alert, setAlert] = useState<any>(null);

  // 解決 Hydration Mismatch: 確保只在客戶端渲染時間
  useEffect(() => {
    setSystemTime(new Date().toLocaleTimeString());
  }, []);

  useEffect(() => {
    const interval = setInterval(() => {
      setSystemTime(new Date().toLocaleTimeString());
      setMetrics(prev => {
        const newOxygen = Math.max(90, Math.min(100, prev.oxygen + (Math.random() - 0.4) * 0.5));
        const newFuel = Math.max(0, prev.fuel - 0.05);
        const newSpeed = Math.max(27000, Math.min(28000, prev.speed + (Math.random() - 0.5) * 50));
        const newTemp = Math.max(18, Math.min(26, prev.temperature + (Math.random() - 0.5) * 0.2));
        
        if (Math.random() > 0.98) {
          setAlert({ type: 'warning', message: '檢測到微隕石撞擊風險' });
          setTimeout(() => setAlert(null), 3000);
        }

        const newEntry = {
          time: new Date().toLocaleTimeString(),
          oxygen: newOxygen.toFixed(1),
          speed: newSpeed.toFixed(0),
          fuel: newFuel.toFixed(1),
          temp: newTemp.toFixed(1)
        };

        setDataHistory(current => {
          const newHistory = [...current, newEntry];
          if (newHistory.length > 20) newHistory.shift();
          return newHistory;
        });

        return { oxygen: newOxygen, fuel: newFuel, speed: newSpeed, temperature: newTemp, integrity: prev.integrity };
      });
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  return (
    // 使用 fixed inset-0 z-[9999] 確保覆蓋全螢幕且蓋過原有的 Layout
    <div className="fixed inset-0 z-[9999] flex flex-col w-full h-full bg-slate-950 text-slate-100 overflow-hidden font-mono selection:bg-cyan-500 selection:text-black">
      <FloatingBackButton />
      {/* 頂部導航欄 */}
      <header className="flex justify-between items-center p-4 border-b border-slate-800 bg-slate-900/50 backdrop-blur-md z-10 shrink-0">
        <div className="flex items-center gap-3">
          <div className="w-3 h-3 rounded-full bg-cyan-500 animate-pulse shadow-[0_0_10px_#06b6d4]"></div>
          <h1 className="text-xl font-bold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-blue-500">
            ORION-7 // 軌道監控系統
          </h1>
        </div>
        <div className="flex items-center gap-6 text-sm text-slate-400">
          <div className="flex items-center gap-2">
            <Clock size={16} />
            <span>UTC {systemTime}</span>
          </div>
          <div className="px-3 py-1 rounded border border-green-500/30 bg-green-500/10 text-green-400 text-xs">
            SYSTEM ONLINE
          </div>
        </div>
      </header>

      {/* 主要內容網格 */}
      <main className="flex-1 grid grid-cols-1 lg:grid-cols-3 gap-0 lg:gap-px bg-slate-800 overflow-hidden">
        
        {/* 左側：3D 視覺化區域 */}
        <div className="lg:col-span-1 bg-slate-950 relative border-r border-slate-800">
          <div className="absolute top-4 left-4 z-10 bg-slate-900/80 p-2 rounded border border-slate-700 backdrop-blur text-xs">
            <div className="text-slate-400 mb-1">VISUAL FEED</div>
            <div className="text-cyan-400">LIVE // CAM-01</div>
          </div>
          
          <EarthView speed={metrics.speed} />
          
          <div className="absolute bottom-6 left-6 right-6 grid grid-cols-2 gap-4">
             <div className="bg-slate-900/80 backdrop-blur p-3 rounded border border-slate-700 border-l-4 border-l-cyan-500">
                <div className="text-xs text-slate-400">LATITUDE</div>
                <div className="text-lg font-bold">28.57 N</div>
             </div>
             <div className="bg-slate-900/80 backdrop-blur p-3 rounded border border-slate-700 border-l-4 border-l-cyan-500">
                <div className="text-xs text-slate-400">LONGITUDE</div>
                <div className="text-lg font-bold">80.64 W</div>
             </div>
          </div>
        </div>

        {/* 右側：儀表板數據區域 */}
        <div className="lg:col-span-2 bg-slate-950 p-6 flex flex-col gap-6 overflow-y-auto">
          {alert && (
            <div className="w-full bg-red-500/20 border border-red-500 text-red-100 p-3 rounded flex items-center gap-3 animate-bounce shrink-0">
              <AlertTriangle />
              <span className="font-bold">WARNING: {alert.message}</span>
            </div>
          )}

          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 shrink-0">
            <StatCard 
              title="OXYGEN LEVEL" 
              value={`${metrics.oxygen.toFixed(1)}%`} 
              icon={<Wind className="text-blue-400" />}
              trend="stable"
              color="blue"
            />
            <StatCard 
              title="FUEL RESERVES" 
              value={`${metrics.fuel.toFixed(1)}%`} 
              icon={<Zap className="text-yellow-400" />}
              trend="decreasing"
              color="yellow"
            />
            <StatCard 
              title="ORBITAL VELOCITY" 
              value={`${(metrics.speed/1000).toFixed(2)} km/s`} 
              icon={<Navigation className="text-purple-400" />}
              trend="stable"
              color="purple"
            />
          </div>

          <div className="grid grid-cols-1 gap-6 flex-1 min-h-[300px]">
            <div className="bg-slate-900/50 rounded-lg p-4 border border-slate-800 shadow-xl backdrop-blur-sm flex flex-col">
              <div className="flex justify-between items-center mb-4 shrink-0">
                <h3 className="text-sm font-bold text-slate-300 flex items-center gap-2">
                  <Activity size={16} className="text-cyan-500" />
                  即時遙測數據 (REAL-TIME TELEMETRY)
                </h3>
                <div className="flex gap-2">
                   <span className="w-2 h-2 rounded-full bg-cyan-500 mt-1"></span>
                   <span className="text-xs text-slate-500">VELOCITY</span>
                   <span className="w-2 h-2 rounded-full bg-pink-500 mt-1 ml-2"></span>
                   <span className="text-xs text-slate-500">TEMP</span>
                </div>
              </div>
              
              <div className="flex-1 w-full min-h-0">
                <ResponsiveContainer width="100%" height="100%">
                  <AreaChart data={dataHistory}>
                    <defs>
                      <linearGradient id="colorSpeed" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="5%" stopColor="#06b6d4" stopOpacity={0.3}/>
                        <stop offset="95%" stopColor="#06b6d4" stopOpacity={0}/>
                      </linearGradient>
                      <linearGradient id="colorTemp" x1="0" y1="0" x2="0" y2="1">
                         <stop offset="5%" stopColor="#ec4899" stopOpacity={0.3}/>
                         <stop offset="95%" stopColor="#ec4899" stopOpacity={0}/>
                      </linearGradient>
                    </defs>
                    <CartesianGrid strokeDasharray="3 3" stroke="#1e293b" />
                    <XAxis dataKey="time" stroke="#475569" tick={{fontSize: 10}} tickMargin={10} />
                    <YAxis yAxisId="left" stroke="#475569" domain={['dataMin - 100', 'dataMax + 100']} tick={{fontSize: 10}} />
                    <YAxis yAxisId="right" orientation="right" stroke="#475569" domain={[15, 30]} tick={{fontSize: 10}} />
                    <Tooltip 
                      contentStyle={{ backgroundColor: '#0f172a', borderColor: '#334155', color: '#f1f5f9' }}
                      itemStyle={{ fontSize: '12px' }}
                    />
                    <Area 
                      yAxisId="left" type="monotone" dataKey="speed" stroke="#06b6d4" strokeWidth={2}
                      fillOpacity={1} fill="url(#colorSpeed)" isAnimationActive={false}
                    />
                    <Area 
                       yAxisId="right" type="monotone" dataKey="temp" stroke="#ec4899" strokeWidth={2}
                       fillOpacity={1} fill="url(#colorTemp)" isAnimationActive={false}
                    />
                  </AreaChart>
                </ResponsiveContainer>
              </div>
            </div>

            <div className="bg-slate-900/50 rounded-lg p-4 border border-slate-800 shadow-xl h-48 flex flex-col shrink-0">
               <h3 className="text-sm font-bold text-slate-300 mb-2">SYSTEM LOGS</h3>
               <div className="flex-1 overflow-y-auto text-xs font-mono space-y-1 pr-2 custom-scrollbar">
                  <div className="text-slate-500">[{systemTime}] Syncing visual modules... OK</div>
                  <div className="text-slate-500">[{systemTime}] Checking hull integrity... 100%</div>
                  <div className="text-slate-400">[{systemTime}] Telemetry stream active.</div>
                  <div className="text-cyan-500">[{systemTime}] Connected to ORION-7 Mainframe.</div>
                  {alert && <div className="text-red-400 font-bold">[{systemTime}] !ALERT! {alert.message}</div>}
               </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  );
}

```

---
### app\routes\outerspace\PokeAPIcreatures.tsx
```tsx
import React, { useState, useEffect, useRef } from 'react';
import { Search, RefreshCw, Volume2, Activity, Zap, Shield, Swords, Ghost, Database } from 'lucide-react';
import { ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, Tooltip } from 'recharts';
import type { Route } from "./+types/creatures";

// 設定 Meta 標籤
export function meta({}: Route.MetaArgs) {
  return [
    { title: "XENO-DB // 異星生物資料庫" },
    { name: "description", content: "跨星系生物體分析系統" },
  ];
}

// --- 類型定義 ---
interface PokemonStats {
  hp: number;
  attack: number;
  defense: number;
  specialAttack: number;
  specialDefense: number;
  speed: number;
}

interface CreatureData {
  id: number;
  name: string;
  types: string[];
  height: number;
  weight: number;
  sprite: string;
  shinySprite: string;
  cry: string;
  stats: PokemonStats;
  chartData: any[];
}

export default function CreatureDatabase() {
  const [searchTerm, setSearchTerm] = useState('lucario');
  const [creature, setCreature] = useState<CreatureData | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [isShiny, setIsShiny] = useState(false);
  const [isFlipped, setIsFlipped] = useState(false);
  const audioRef = useRef<HTMLAudioElement | null>(null);

  // --- 核心功能：從 PokeAPI 獲取資料 ---
  const fetchCreature = async (query: string | number) => {
    setLoading(true);
    setError('');
    setIsFlipped(false); // 重置卡片翻轉
    
    try {
      const response = await fetch(`https://pokeapi.co/api/v2/pokemon/${query.toString().toLowerCase()}`);
      if (!response.ok) throw new Error('Target not found in database.');
      
      const data = await response.json();
      
      // 整理數據格式以符合我們的 UI 需求
      const stats = {
        hp: data.stats[0].base_stat,
        attack: data.stats[1].base_stat,
        defense: data.stats[2].base_stat,
        specialAttack: data.stats[3].base_stat,
        specialDefense: data.stats[4].base_stat,
        speed: data.stats[5].base_stat,
      };

      const chartData = [
        { subject: 'HP', A: stats.hp, fullMark: 150 },
        { subject: 'ATK', A: stats.attack, fullMark: 150 },
        { subject: 'DEF', A: stats.defense, fullMark: 150 },
        { subject: 'SPD', A: stats.speed, fullMark: 150 },
        { subject: 'S-DEF', A: stats.specialDefense, fullMark: 150 },
        { subject: 'S-ATK', A: stats.specialAttack, fullMark: 150 },
      ];

      setCreature({
        id: data.id,
        name: data.name,
        types: data.types.map((t: any) => t.type.name),
        height: data.height / 10, // 轉為公尺
        weight: data.weight / 10, // 轉為公斤
        sprite: data.sprites.other['official-artwork'].front_default || data.sprites.front_default,
        shinySprite: data.sprites.other['official-artwork'].front_shiny || data.sprites.front_shiny,
        cry: data.cries.latest,
        stats,
        chartData
      });

    } catch (err) {
      setError('SCAN FAILED: Target signal lost or invalid.');
      setCreature(null);
    } finally {
      setLoading(false);
    }
  };

  // 初始載入
  useEffect(() => {
    fetchCreature(Math.floor(Math.random() * 150) + 1); // 隨機載入一隻
  }, []);

  // 播放叫聲
  const playCry = () => {
    if (creature?.cry) {
      const audio = new Audio(creature.cry);
      audio.volume = 0.3;
      audio.play();
    }
  };

  // 隨機搜尋
  const handleRandom = () => {
    const randomId = Math.floor(Math.random() * 1000) + 1;
    fetchCreature(randomId);
  };

  // 處理搜尋提交
  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    if(searchTerm.trim()) fetchCreature(searchTerm);
  };

  return (
    // --- 容器層：使用 min-h-screen 確保佔滿但不覆蓋 Layout ---
    <div className="w-full min-h-screen bg-slate-950 text-slate-200 p-4 md:p-8 font-mono relative overflow-hidden">
      
      {/* 背景裝飾網格 */}
      <div className="absolute inset-0 bg-[linear-gradient(to_right,#1e293b_1px,transparent_1px),linear-gradient(to_bottom,#1e293b_1px,transparent_1px)] bg-[size:4rem_4rem] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_100%)] pointer-events-none" />

      <div className="max-w-6xl mx-auto relative z-10">
        
        {/* 標題區 */}
        <header className="mb-8 border-b border-slate-800 pb-4 flex flex-col md:flex-row justify-between items-center gap-4">
          <div className="flex items-center gap-3">
            <Database className="text-emerald-400" />
            <h1 className="text-2xl md:text-3xl font-bold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-500">
              XENO-BIOLOGY DB
            </h1>
          </div>
          
          {/* 搜尋與控制列 */}
          <div className="flex gap-2 w-full md:w-auto">
            <form onSubmit={handleSearch} className="flex-1 flex gap-2">
              <div className="relative flex-1 md:w-64">
                <input 
                  type="text" 
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  placeholder="Enter ID or Name..."
                  className="w-full bg-slate-900/80 border border-slate-700 rounded px-4 py-2 pl-10 focus:outline-none focus:border-emerald-500 text-emerald-100 placeholder:text-slate-600"
                />
                <Search className="absolute left-3 top-2.5 w-4 h-4 text-slate-500" />
              </div>
              <button type="submit" className="bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded transition-colors">
                SCAN
              </button>
            </form>
            <button onClick={handleRandom} className="bg-slate-800 hover:bg-slate-700 border border-slate-700 text-slate-300 px-3 py-2 rounded transition-colors group" title="Random Scan">
              <RefreshCw className="w-5 h-5 group-hover:rotate-180 transition-transform duration-500" />
            </button>
          </div>
        </header>

        {/* 內容顯示區 */}
        {loading ? (
          <div className="h-96 flex flex-col items-center justify-center text-emerald-500 animate-pulse">
            <Activity className="w-16 h-16 mb-4" />
            <div className="text-xl tracking-widest">ANALYZING DNA SEQUENCE...</div>
          </div>
        ) : error ? (
          <div className="h-96 flex flex-col items-center justify-center text-red-500 bg-red-950/20 border border-red-900/50 rounded-xl">
            <Shield className="w-16 h-16 mb-4" />
            <div className="text-xl tracking-widest">{error}</div>
          </div>
        ) : creature && (
          <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 lg:gap-12">
            
            {/* 左側：生物視覺化 (3D 卡片效果) */}
            <div className="lg:col-span-5 flex flex-col gap-6">
              <div className="relative group perspective-1000 w-full aspect-square">
                <div className="relative w-full h-full transition-all duration-500 transform-style-3d bg-slate-900/50 rounded-2xl border border-slate-700 overflow-hidden flex items-center justify-center backdrop-blur-sm hover:border-emerald-500/50 hover:shadow-[0_0_30px_rgba(16,185,129,0.2)]">
                  
                  {/* 背景全息圖效果 */}
                  <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,rgba(16,185,129,0.1),transparent_70%)]" />
                  
                  {/* 生物影像 */}
                  <img 
                    src={isShiny ? creature.shinySprite : creature.sprite} 
                    alt={creature.name}
                    className="relative z-10 w-3/4 h-3/4 object-contain drop-shadow-[0_0_15px_rgba(0,0,0,0.8)] transition-transform duration-300 hover:scale-110 cursor-pointer"
                    onClick={playCry}
                  />

                  {/* 覆蓋 UI */}
                  <div className="absolute top-4 right-4 flex flex-col gap-2 z-20">
                    <button 
                      onClick={() => setIsShiny(!isShiny)}
                      className={`p-2 rounded-full border backdrop-blur-md transition-colors ${isShiny ? 'bg-yellow-500/20 border-yellow-500 text-yellow-400' : 'bg-slate-800/50 border-slate-600 text-slate-400 hover:text-white'}`}
                    >
                      <Zap className="w-5 h-5" />
                    </button>
                    <button 
                      onClick={playCry}
                      className="p-2 rounded-full bg-slate-800/50 border border-slate-600 text-slate-400 hover:text-emerald-400 hover:border-emerald-500 backdrop-blur-md transition-colors"
                    >
                      <Volume2 className="w-5 h-5" />
                    </button>
                  </div>

                  <div className="absolute bottom-4 left-4 bg-slate-950/80 px-3 py-1 rounded border border-slate-700 text-xs text-emerald-500 font-bold">
                    ID: #{creature.id.toString().padStart(4, '0')}
                  </div>
                </div>
              </div>

              {/* 屬性標籤 */}
              <div className="flex gap-3 justify-center">
                {creature.types.map(t => (
                  <span key={t} className="px-6 py-2 rounded bg-slate-800 border border-slate-600 text-slate-200 uppercase tracking-wider font-bold text-sm shadow-lg">
                    {t}
                  </span>
                ))}
              </div>
            </div>

            {/* 右側：數據分析儀表板 */}
            <div className="lg:col-span-7 space-y-6">
              
              {/* 頂部資訊 */}
              <div className="space-y-2 border-l-4 border-emerald-500 pl-6">
                <h2 className="text-5xl font-bold text-white uppercase tracking-tighter">{creature.name}</h2>
                <div className="flex gap-8 text-slate-400 text-sm">
                  <span>HEIGHT: <strong className="text-emerald-400">{creature.height}m</strong></span>
                  <span>WEIGHT: <strong className="text-emerald-400">{creature.weight}kg</strong></span>
                </div>
              </div>

              {/* 雷達圖分析 */}
              <div className="bg-slate-900/50 rounded-xl border border-slate-800 p-4 relative h-80">
                 <h3 className="absolute top-4 left-4 text-xs font-bold text-slate-500 flex items-center gap-2">
                   <Activity className="w-4 h-4" />
                   STATS MATRIX
                 </h3>
                 <ResponsiveContainer width="100%" height="100%">
                    <RadarChart cx="50%" cy="50%" outerRadius="70%" data={creature.chartData}>
                      <PolarGrid stroke="#334155" />
                      <PolarAngleAxis dataKey="subject" tick={{ fill: '#94a3b8', fontSize: 12 }} />
                      <PolarRadiusAxis angle={30} domain={[0, 150]} tick={false} axisLine={false} />
                      <Radar
                        name={creature.name}
                        dataKey="A"
                        stroke="#10b981"
                        strokeWidth={3}
                        fill="#10b981"
                        fillOpacity={0.3}
                      />
                      <Tooltip 
                        contentStyle={{ backgroundColor: '#020617', borderColor: '#1e293b', color: '#f1f5f9' }}
                        itemStyle={{ color: '#10b981' }}
                      />
                    </RadarChart>
                 </ResponsiveContainer>
              </div>

              {/* 戰鬥能力評估 */}
              <div className="grid grid-cols-2 gap-4">
                  <div className="bg-slate-900/50 p-4 rounded-lg border border-slate-800 hover:border-red-500/50 transition-colors group">
                    <div className="flex items-center gap-2 text-red-400 mb-2">
                      <Swords className="w-5 h-5 group-hover:animate-pulse" />
                      <span className="text-sm font-bold">OFFENSIVE</span>
                    </div>
                    <div className="text-2xl font-bold text-slate-200">
                      {creature.stats.attack + creature.stats.specialAttack}
                    </div>
                    <div className="text-xs text-slate-500 mt-1">Combined Combat Power</div>
                  </div>

                  <div className="bg-slate-900/50 p-4 rounded-lg border border-slate-800 hover:border-blue-500/50 transition-colors group">
                    <div className="flex items-center gap-2 text-blue-400 mb-2">
                      <Shield className="w-5 h-5 group-hover:animate-pulse" />
                      <span className="text-sm font-bold">DEFENSIVE</span>
                    </div>
                    <div className="text-2xl font-bold text-slate-200">
                      {creature.stats.defense + creature.stats.specialDefense + creature.stats.hp}
                    </div>
                    <div className="text-xs text-slate-500 mt-1">Total Resilience Index</div>
                  </div>
              </div>

            </div>
          </div>
        )}
      </div>
    </div>
  );
}
```

---
Generated with UTF-8 to avoid mojibake.
