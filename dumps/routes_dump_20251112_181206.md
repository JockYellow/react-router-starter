## Routes Dump (20251112_181206)
專案根目錄：D:\CloudflarePage\react-router-starter\

## Root: D:\CloudflarePage\react-router-starter\app
### 檔案清單（相對 D:\CloudflarePage\react-router-starter\）
app\app.css
app\components\DevMenu.tsx
app\content\changelog\2025-11-12-update.json
app\entry.server.tsx
app\root.tsx
app\routes.ts
app\routes\_index.tsx
app\routes\about.tsx
app\routes\changelog.tsx

---
### app\app.css
```css
/* app/app.css */
@import "tailwindcss" source(".");

/* === Design Tokens === */
@theme {
  --font-sans:
    "Inter", ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
    "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";

  /* brand colors */
  --color-brand-50:  #FFF7E1;
  --color-brand-100: #FBEFC8;
  --color-brand-200: #F1E2A4;
  --color-brand-300: #E8C872; /* 主黃 */
  --color-brand-400: #D9B45A;
  --color-brand-500: #B9923E;

  --color-accent-50:  #F8F5FF;
  --color-accent-100: #EDE8FE;
  --color-accent-200: #DAD3FA;
  --color-accent-300: #BFB4EE;
  --color-accent-400: #7A6AAE; /* 主紫 */
  --color-accent-500: #6B5CA0;

  --color-warm-0:   #FFFFFF;
  --color-warm-25:  #FDFCFB;
  --color-warm-50:  #F6F5F2; /* 背景暖白 */
  --color-warm-100: #EEECE6;

  /* radii / shadow */
  --radius-card: 1rem;     /* 16px */
  --shadow-soft: 0 6px 18px rgba(20, 10, 0, 0.06);
  --shadow-hover: 0 10px 26px rgba(20, 10, 0, 0.08);
}

/* === Base === */
html, body {
  @apply bg-[--color-warm-50] text-neutral-900;
  font-family: var(--font-sans);
  @media (prefers-color-scheme: dark) {
    color-scheme: dark;
  }
}
html { scroll-behavior: smooth; }

/* 區塊統一間距與標題 */
.section { @apply py-14 md:py-20; }
.section-title { @apply text-2xl md:text-3xl font-semibold mb-6 tracking-tight; }

/* === Components === */
@layer components {
  .card {
    border-radius: var(--radius-card);
    box-shadow: var(--shadow-soft);
    @apply bg-white border border-neutral-200 p-6 transition-shadow;
  }
  .card:hover { box-shadow: var(--shadow-hover); }

  .input {
    @apply w-full rounded-md border border-neutral-300 bg-white px-3 py-2 outline-none
           focus:ring-2 focus:ring-[--color-accent-200] focus:border-[--color-accent-400];
  }

  /* 移除 @apply btn，直接展開 utility（這樣 Tailwind 才不會報 unknown utility） */
  .btn-primary {
    @apply inline-flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition text-neutral-900;
    background: linear-gradient(180deg, var(--color-brand-200), var(--color-brand-300));
    box-shadow: 0 1px 0 rgba(255,255,255,.6) inset, 0 6px 16px rgba(185,146,62,.18);
  }
  .btn-primary:hover {
    background: linear-gradient(180deg, var(--color-brand-200), var(--color-brand-400));
  }

  .btn-ghost {
    @apply inline-flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition text-[--color-accent-500] bg-[color:transparent] hover:bg-[--color-accent-50];
    border: 1px solid var(--color-accent-200);
  }

  .link-soft {
    @apply text-[--color-accent-500] hover:text-[--color-accent-400] underline-offset-4 hover:underline;
  }

  .chip {
    @apply inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs;
    background: color-mix(in oklab, var(--color-accent-50) 70%, white);
    border: 1px solid var(--color-accent-200);
    color: var(--color-accent-500);
  }

  /* 細分隔線：比實線更柔和 */
  .divider {
    background: linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent);
    height: 1px;
  }

  .hover-raise { transform: translateY(0); transition: transform .2s ease, box-shadow .2s ease; }
  .hover-raise:hover { transform: translateY(-2px); box-shadow: var(--shadow-hover); }
}

```

---
### app\components\DevMenu.tsx
```tsx
import { useEffect, useState } from "react";

export default function DevMenu() {
  const [show, setShow] = useState(false);
  useEffect(() => {
    if (import.meta.env.DEV) setShow(true);
  }, []);
  if (!import.meta.env.DEV || !show) return null;

  return (
    <div className="fixed bottom-4 right-4 z-50">
      <a
        href="http://127.0.0.1:43210/admin/"
        target="_blank"
        rel="noreferrer"
        className="px-4 py-2 rounded-xl shadow-md bg-black/80 text-white text-sm hover:bg-black"
      >
        管理後台
      </a>
    </div>
  );
}

```

---
### app\content\changelog\2025-11-12-update.json
```json
{
  "date": "2025-11-12",
  "title": "增加地端管理選單",
  "tag": "add",
  "notes": [
    "- 新增管理模式",
    "- 新增管理UI功能",
    "- 新增管理後台"
  ]
}

```

---
### app\entry.server.tsx
```tsx
import type { AppLoadContext, EntryContext } from "react-router";
import { ServerRouter } from "react-router";
import { isbot } from "isbot";
import { renderToReadableStream } from "react-dom/server";

export default async function handleRequest(
  request: Request,
  responseStatusCode: number,
  responseHeaders: Headers,
  routerContext: EntryContext,
  _loadContext: AppLoadContext,
) {
  let shellRendered = false;
  const userAgent = request.headers.get("user-agent");

  const body = await renderToReadableStream(
    <ServerRouter context={routerContext} url={request.url} />,
    {
      onError(error: unknown) {
        responseStatusCode = 500;
        // Log streaming rendering errors from inside the shell.  Don't log
        // errors encountered during initial shell rendering since they'll
        // reject and get logged in handleDocumentRequest.
        if (shellRendered) {
          console.error(error);
        }
      },
    },
  );
  shellRendered = true;

  // Ensure requests from bots and SPA Mode renders wait for all content to load before responding
  // https://react.dev/reference/react-dom/server/renderToPipeableStream#waiting-for-all-content-to-load-for-crawlers-and-static-generation
  if ((userAgent && isbot(userAgent)) || routerContext.isSpaMode) {
    await body.allReady;
  }

  responseHeaders.set("Content-Type", "text/html; charset=utf-8");
  return new Response(body, {
    headers: responseHeaders,
    status: responseStatusCode,
  });
}

```

---
### app\root.tsx
```tsx
// app/root.tsx
import {
  Link,
  Links,
  Outlet,
  Scripts,
  useLocation,
} from "react-router";
import { useEffect, useRef, useState } from "react";
import "./app.css";

import DevMenu from "./components/DevMenu";



/** 自動隱藏 Header，向下捲動隱藏、向上顯示 */
function AutoHideHeader() {
  const [hidden, setHidden] = useState(false);
  const lastY = useRef(0);
  const ticking = useRef(false);

  useEffect(() => {
    function onScroll() {
      const y = window.scrollY || 0;
      if (!ticking.current) {
        window.requestAnimationFrame(() => {
          const goingDown = y > lastY.current;
          const delta = Math.abs(y - lastY.current);
          if (y < 24 || !goingDown || delta > 10) {
            setHidden(false);
          } else if (goingDown && y > 96) {
            setHidden(true);
          }
          lastY.current = y;
          ticking.current = false;
        });
        ticking.current = true;
      }
    }
    window.addEventListener("scroll", onScroll, { passive: true });
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  const tabs = [
    { id: "about", label: "關於我" },
    { id: "skills", label: "技能" },
    { id: "projects", label: "作品" },
    { id: "contact", label: "聯絡" },
  ];

  const [active, setActive] = useState("about");
  useEffect(() => {
    const sections = tabs.map(t => document.getElementById(t.id)).filter(Boolean) as HTMLElement[];
    const io = new IntersectionObserver(
      entries => {
        const visible = entries
          .filter(e => e.isIntersecting)
          .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];
        if (visible?.target?.id) setActive(visible.target.id);
      },
      { rootMargin: "-20% 0px -60% 0px", threshold: [0.25, 0.5, 0.75] }
    );
    sections.forEach(s => io.observe(s));
    return () => io.disconnect();
  }, []);

  return (
    <header
      className={`fixed inset-x-0 top-0 z-50 transition-transform duration-300 will-change-transform
      ${hidden ? "-translate-y-full" : "translate-y-0"}`}
    >
      <div className="backdrop-blur-md bg-[--color-warm-25]/80 border-b border-[--color-warm-100]">
        <div className="mx-auto max-w-6xl px-4 h-14 flex items-center justify-between">
          <Link to="/" className="font-semibold tracking-wide">個人網站</Link>
          <nav className="hidden md:flex items-center gap-6 text-sm">
            {tabs.map(t => (
              <a
                key={t.id}
                href={`/#${t.id}`}
                className={`py-1 border-b-2 -mb-[2px] transition-colors ${
                  active === t.id
                    ? "border-[--color-accent-400] text-neutral-900"
                    : "border-transparent text-neutral-600 hover:text-neutral-800 hover:border-[--color-accent-200]"
                }`}
              >
                {t.label}
              </a>
            ))}
          </nav>
          <Link to="/changelog" className="text-sm link-soft hidden md:inline">更新日誌</Link>
          <a href="#about" className="md:hidden text-sm text-neutral-600">目錄</a>
        </div>
      </div>
    </header>
  );
}

/** 頁面框架 */
function App() {
  const { pathname } = useLocation();
  useEffect(() => {
    window.scrollTo({ top: 0, behavior: "instant" as ScrollBehavior });
  }, [pathname]);

  return (
    <div className="min-h-screen bg-[--color-warm-50] text-neutral-900">
      <AutoHideHeader />
      <main className="pt-16">
        <Outlet />
      </main>
      <DevMenu />
      <footer className="mt-16 border-t">
        <div className="mx-auto max-w-6xl px-4 py-8 text-sm text-neutral-600">
          © {new Date().getFullYear()} 個人網站
        </div>
      </footer>
    </div>
  );
}

/** HTML 骨架 */
export function Layout() {
  return (
    <html lang="zh-Hant">
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>個人網站</title>
        <Links />
      </head>
      <body>
        <App />
        <Scripts />
      </body>
    </html>
  );
}

export default App;

```

---
### app\routes.ts
```ts
// app/routes.ts
import { type RouteConfig, index, route } from "@react-router/dev/routes";

export default [
  index("routes/_index.tsx"), 
  route("about", "routes/about.tsx"),
  route("changelog", "routes/changelog.tsx"),
] satisfies RouteConfig;
```

---
### app\routes\_index.tsx
```tsx
// app/routes/_index.tsx
export default function HomePage() {
  return (
    <div className="mx-auto max-w-6xl px-4">
      {/* Hero 區：淡漸層薄霧背景 */}
      <section className="py-14 md:py-20 relative">
        <div
          className="absolute inset-0 -z-10 opacity-[0.06]"
          style={{ background: "linear-gradient(180deg,#FFF7E1 0%,#F8F5FF 100%)" }}
        />
        <div className="grid md:grid-cols-[1.2fr_1fr] gap-8 items-center">
          <div>
            <h1 className="text-3xl md:text-5xl font-bold tracking-tight">
              前端開發者的個人網站
            </h1>
            <p className="mt-4 text-lg text-neutral-700">
              這裡是我的開發筆記與作品集。網站運行於 Cloudflare Workers，前端使用 React Router 與 Tailwind CSS，
              透過 Notion 與 D1 打通資料流。
            </p>
            <div className="mt-6 flex gap-3">
              <a href="#projects" className="btn-primary">查看作品</a>
              <a href="#contact" className="btn-ghost">聯絡我</a>
            </div>
          </div>
          <div className="card hover-raise p-6 md:p-8">
            <div className="text-sm text-neutral-500">目前進度</div>
            <ul className="mt-3 space-y-2 text-sm">
              <li>· 首頁與關於頁完成</li>
              <li>· 部落格架構與假資料完成</li>
              <li>· 正在串接 Notion 與留言板</li>
            </ul>
          </div>
        </div>
      </section>

      {/* 關於我 */}
      <section id="about" className="section bg-[--color-warm-25]">
        <h2 className="section-title">關於我</h2>
        <div className="prose max-w-none">
          <p>
            我專注於前端工程，喜歡把內容網站做得快速、可維護且能邊緣運行。這個網站是學習與實作並行的紀錄。
          </p>
        </div>
      </section>

      {/* 技能 */}
      <section id="skills" className="section">
        <h2 className="section-title">技能</h2>
        <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {[
            { title: "React / TypeScript", desc: "組件化、狀態管理、型別安全。" },
            { title: "React Router", desc: "檔案式路由、loader/action、SSR。" },
            { title: "Tailwind CSS", desc: "系統化設計與高可讀性樣式。" },
            { title: "Cloudflare Workers", desc: "邊緣運算與 Functions。" },
            { title: "D1 / Notion API", desc: "內容管理與資料庫整合。" },
            { title: "部署與監控", desc: "CI/CD、快取與效能優化。" },
          ].map((item) => (
            <article key={item.title} className="card hover-raise">
              <h3 className="font-semibold">{item.title}</h3>
              <p className="mt-1 text-sm text-neutral-700">{item.desc}</p>
            </article>
          ))}
        </div>
      </section>

      {/* 作品 */}
      <section id="projects" className="section bg-[--color-brand-50]/40">
        <h2 className="section-title">作品</h2>
        <div className="grid md:grid-cols-2 gap-6">
          <article className="card hover-raise transition">
            <h3 className="font-semibold">個人部落格系統</h3>
            <p className="mt-1 text-sm text-neutral-700">
              React Router + Workers + Notion，支援 SSR 與 RSS。
            </p>
            <a href="/blog" className="mt-3 inline-block text-sm link-soft">
              前往部落格
            </a>
          </article>
          <article className="card hover-raise transition">
            <h3 className="font-semibold">留言板</h3>
            <p className="mt-1 text-sm text-neutral-700">
              Cloudflare D1 寫入與查詢，具備表單驗證與錯誤處理。
            </p>
            <a href="/guestbook" className="mt-3 inline-block text-sm link-soft">
              前往留言板
            </a>
          </article>
        </div>
      </section>

      {/* 聯絡 */}
      <section id="contact" className="section">
        <h2 className="section-title">聯絡</h2>
        <div className="card">
          <form
            onSubmit={(e) => e.preventDefault()}
            className="grid sm:grid-cols-[1fr_auto] gap-3"
          >
            <input
              type="email"
              required
              placeholder="你的 Email"
              className="input"
            />
            <button className="btn-primary">送出</button>
          </form>
          <p className="mt-3 text-sm text-neutral-600">
            也可以在關於頁查看專案說明與目前進度。
          </p>
        </div>
      </section>
    </div>
  );
}

```

---
### app\routes\about.tsx
```tsx
// app/routes/about.tsx
// app/routes/about.tsx
export default function AboutPage() {
  return (
    <main className="max-w-3xl mx-auto px-4 py-12 leading-relaxed">
      <h1 className="text-3xl font-bold mb-6">關於這個專案</h1>

      <p className="mb-4">
        這是一個以 React Router Framework 為基礎、部署在 Cloudflare Workers 上的部落格專案。
        主要目標是從零開始，透過實作學習現代前端架構，並體驗「前後端在同一份程式碼中」的開發模式。
      </p>

      <p className="mb-4">
        網站的資料來源使用 Notion 作為 CMS，留言資料存放於 Cloudflare D1。
        所有頁面都由 Workers 在邊緣節點進行伺服端渲染（SSR），使內容能快速且安全地傳遞到世界各地的使用者。
      </p>

      <h2 className="text-2xl font-semibold mt-8 mb-3">主要功能規劃</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>首頁與關於頁</li>
        <li>部落格列表與文章頁</li>
        <li>留言板（D1 資料庫）</li>
        <li>RSS Feed</li>
        <li>互動圖表頁（未來示範資料視覺化）</li>
        <li>密碼保護頁（中介層驗證）</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">目前進度</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>已完成：基本架構、首頁、關於頁、部落格假資料、樣式設定</li>
        <li>進行中：Notion API 串接與留言板互動</li>
        <li>待完成：RSS、D1 實作、密碼頁、圖表</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">技術架構</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>React Router v7（檔案式路由、loader/action）</li>
        <li>Cloudflare Workers（邊緣運算與伺服端渲染）</li>
        <li>Cloudflare D1（留言資料庫）</li>
        <li>Notion API（文章內容來源）</li>
        <li>Tailwind CSS（樣式）</li>
        <li>TypeScript + Vite（開發環境）</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">開發理念</h2>
      <p className="mb-4">
        專案採取「邊學邊做」的方式推進。每一週聚焦於不同面向：第一週完成網站骨架，
        第二週整合外部資料與互動功能，第三週優化效能與擴充應用。
      </p>

      <p className="mb-4">
        最終希望這個網站不只是作品展示，也是一份可持續擴充的個人開發框架，
        未來能作為更多 Cloudflare Edge App 的基礎。
      </p>

      <footer className="mt-12 text-sm text-gray-500">
        © {new Date().getFullYear()} 個人專案開發筆記
      </footer>
    </main>
  );
}

```

---
### app\routes\changelog.tsx
```tsx
// app/routes/changelog.tsx
import type { LoaderFunctionArgs } from "react-router";
import { useLoaderData, Link } from "react-router";

type Item = {
  date: string;
  title: string;
  notes?: string[];
  tag?: "add" | "fix" | "change" | "docs";
  filename?: string; // 方便你除錯
};

export async function loader({ request }: LoaderFunctionArgs) {
  if (import.meta.env.DEV) {
    const fs = await import("node:fs/promises");
    const path = await import("node:path");
    const { fileURLToPath } = await import("node:url");

    // 取得當前檔案的實體路徑（Windows 友善）
    const __filename = fileURLToPath(import.meta.url);
    const __dirname = path.dirname(__filename);

    // 兩個候選資料夾：1) 相對於本檔案 2) 專案根目錄
    const candidates = [
      path.resolve(__dirname, "../content/changelog"),
      path.resolve(process.cwd(), "app/content/changelog"),
    ];

    let contentDir: string | null = null;
    for (const p of candidates) {
      try {
        const stat = await fs.stat(p);
        if (stat.isDirectory()) { contentDir = p; break; }
      } catch {}
    }

    if (!contentDir) {
      // 找不到資料夾就回空
      return [] as Item[];
    }

    const NAME_RE = /^\d{4}-\d{2}-\d{2}-[a-z0-9\-]+\.json$/i;
    const files = (await fs.readdir(contentDir)).filter(f => NAME_RE.test(f));

    const items: Item[] = [];
    for (const f of files) {
      try {
        const raw = await fs.readFile(path.join(contentDir, f), "utf8");
        const data = JSON.parse(raw) as Item;
        items.push({ ...data, filename: f });
      } catch {
        // 忽略壞檔
      }
    }
    items.sort((a, b) => (a.date < b.date ? 1 : -1));
    return items;
  }

  // 下面是原本的 PROD 版 glob，不用改
  const modules = import.meta.glob("../content/changelog/*.json", { eager: true });
  const items: Item[] = Object.entries(modules).map(([p, m]: any) => {
    const data = m.default ?? m;
    const filename = p.split("/").pop();
    return { ...data, filename };
  });
  items.sort((a, b) => (a.date < b.date ? 1 : -1));
  return items;
}


function Tag({ t }: { t?: Item["tag"] }) {
  const map = { add: "新增", fix: "修正", change: "變更", docs: "文件" } as const;
  return t ? <span className="chip">{map[t]}</span> : null;
}

export default function ChangelogPage() {
  const items = useLoaderData() as Item[];
  return (
    <main className="mx-auto max-w-3xl px-4 py-12">
      <header className="mb-8">
        <h1 className="text-3xl font-bold">更新日誌</h1>
        {import.meta.env.DEV ? (
          <p className="mt-2 text-neutral-600">
            開發模式即時讀取檔案（app/content/changelog/）
          </p>
        ) : (
          <p className="mt-2 text-neutral-600">靜態內容（build 時打包）</p>
        )}
        <p className="mt-2"><Link to="/" className="link-soft">回首頁</Link></p>
      </header>

      <div className="space-y-4">
        {items.map((log, i) => (
          <article key={(log.filename ?? "") + i} className="card hover-raise">
            <div className="flex items-center gap-3 text-sm text-neutral-600">
              <time dateTime={log.date} className="font-medium text-neutral-800">{log.date}</time>
              <Tag t={log.tag} />
            </div>
            <h2 className="mt-2 text-lg font-semibold">{log.title}</h2>
            {log.notes?.length ? (
              <ul className="mt-2 list-disc pl-5 text-sm text-neutral-700 space-y-1">
                {log.notes.map((n, j) => <li key={j}>{n}</li>)}
              </ul>
            ) : null}
            {import.meta.env.DEV && log.filename ? (
              <p className="mt-2 text-xs text-neutral-400">{log.filename}</p>
            ) : null}
          </article>
        ))}
        {!items.length && (
          <p className="text-neutral-500">目前沒有日誌。到後台新增一筆試試。</p>
        )}
      </div>
    </main>
  );
}

```
## Root: D:\CloudflarePage\react-router-starter\toolbelt
### 檔案清單（相對 D:\CloudflarePage\react-router-starter\）
toolbelt\admin\admin.css
toolbelt\admin\admin.js
toolbelt\index.ts

---
### toolbelt\admin\admin.css
```css
:root{--bg:#faf8f6;--fg:#111;--muted:#666;--line:#e5e5e5}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;line-height:1.5;margin:0;background:var(--bg);color:var(--fg)}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:12px 16px}
.wrap{max-width:960px;margin:0 auto;padding:16px}
nav{display:flex;gap:8px;flex-wrap:wrap}
a.btn,button.btn{padding:8px 12px;border-radius:10px;border:1px solid #111;background:#111;color:#fff;text-decoration:none;cursor:pointer}
.btn.ghost{background:#fff;color:#111}
.card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
label span{display:block;font-size:12px;color:#555;margin-bottom:4px}
input,select,textarea{width:100%;padding:8px;border:1px solid var(--line);border-radius:8px;background:#fff}
.list .item{display:flex;justify-content:space-between;gap:12px;padding:12px 0;border-bottom:1px dashed var(--line)}
.muted{color:var(--muted);font-size:12px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}

```

---
### toolbelt\admin\admin.js
```js
// toolbelt/admin/admin.js
window.Admin = (function () {
  const state = { key: "" };

  async function initKey() {
    if (state.key) return state.key;
    const res = await fetch("/key");
    if (!res.ok) throw new Error("no key");
    const { key } = await res.json();
    state.key = key;
    return key;
  }

  async function api(path, opt = {}) {
    await initKey();
    const res = await fetch(path, {
      method: opt.method || "GET",
      headers: {
        "content-type": "application/json",
        "x-toolbelt-key": state.key,
      },
      body: opt.body ? JSON.stringify(opt.body) : undefined,
    });
    if (!res.ok) throw new Error(await res.text());
    const ct = res.headers.get("content-type") || "";
    return ct.includes("application/json") ? res.json() : res.text();
  }

  function today() {
    return new Date().toISOString().slice(0, 10);
  }
  function slugify(s) {
    return (s || "")
      .trim()
      .toLowerCase()
      .replace(/[\s_]+/g, "-")
      .replace(/[^a-z0-9\-]+/g, "")
      .replace(/-+/g, "-")
      .replace(/^-+|-+$/g, "");
  }

  return { api, today, slugify };
})();


```

---
### toolbelt\index.ts
```ts
// toolbelt/index.ts
import express from "express";
import { join, dirname, resolve } from "node:path";
import { fileURLToPath } from "node:url";
import { existsSync, mkdirSync, writeFileSync, readFileSync, readdirSync, rmSync } from "node:fs";

const app = express();
const PORT = 43210;
const HOST = "127.0.0.1";
const TOOLBELT_KEY = Math.random().toString(36).slice(2);

app.use(express.json({ limit: "2mb" }));

// CORS（本機開發）
app.use((req, res, next) => {
  res.setHeader("Access-Control-Allow-Origin", "*");
  res.setHeader("Access-Control-Allow-Headers", "content-type, x-toolbelt-key");
  res.setHeader("Access-Control-Allow-Methods", "GET,POST,PUT,DELETE,OPTIONS");
  if (req.method === "OPTIONS") return res.sendStatus(204);
  next();
});

const __dirname = dirname(fileURLToPath(import.meta.url));
const REPO = resolve(__dirname, "..");
const CHANGELOG_DIR = resolve(REPO, "app/content/changelog");

// 基礎
app.get("/", (_req, res) => res.json({ ok: true, message: "Toolbelt is running!" }));
app.get("/key", (_req, res) => res.json({ key: TOOLBELT_KEY }));

// Admin 靜態站（本機後台）
app.use("/admin", express.static(join(__dirname, "admin"), { extensions: ["html"] }));
app.use((req, res, next) => { res.setHeader("X-Frame-Options", "DENY"); res.setHeader("Referrer-Policy", "no-referrer"); next(); });

// 授權保護（/admin 與 /key 除外）
app.use((req, res, next) => {
  if (req.path.startsWith("/admin") || req.path === "/key" || req.path === "/") return next();
  if (req.headers["x-toolbelt-key"] !== TOOLBELT_KEY) return res.status(401).send("Unauthorized");
  next();
});

// ── Changelog 檔案式 CRUD ──
const NAME_RE = /^[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-z0-9\-]+\.json$/i;
function ensureDir() { if (!existsSync(CHANGELOG_DIR)) mkdirSync(CHANGELOG_DIR, { recursive: true }); }
function filePath(name: string) {
  if (!NAME_RE.test(name)) throw new Error("Invalid filename");
  const full = resolve(CHANGELOG_DIR, name);
  if (!full.startsWith(CHANGELOG_DIR)) throw new Error("Path traversal");
  return full;
}
function validateData(d: any) {
  if (!d || typeof d !== "object") throw new Error("Invalid body");
  if (typeof d.date !== "string" || !/^\d{4}-\d{2}-\d{2}$/.test(d.date)) throw new Error("date must be YYYY-MM-DD");
  if (typeof d.title !== "string" || !d.title.trim()) throw new Error("title required");
  if (d.notes && (!Array.isArray(d.notes) || !d.notes.every((s: any) => typeof s === "string"))) throw new Error("notes must be string[]");
  if (d.tag && !["add","fix","change","docs"].includes(d.tag)) throw new Error("tag invalid");
}

app.get("/fs/changelog/list", (_req, res) => {
  ensureDir();
  const files = readdirSync(CHANGELOG_DIR).filter(f => NAME_RE.test(f)).sort((a,b)=>a<b?1:-1);
  const items = files.map(f => { const raw = readFileSync(join(CHANGELOG_DIR, f), "utf8"); return { filename: f, ...JSON.parse(raw) }; });
  res.json(items);
});

app.post("/fs/changelog/create", (req, res) => {
  ensureDir();
  try {
    const { data, slug } = req.body as { data: any; slug?: string };
    validateData(data);
    const s = (slug || data.title || "update").toString().trim().toLowerCase()
      .replace(/[\s_]+/g,"-").replace(/[^a-z0-9\-]+/g,"").replace(/\-+/g,"-").replace(/^\-+|\-+$/g,"");
    const name = `${data.date}-${s || "update"}.json`;
    writeFileSync(filePath(name), JSON.stringify(data, null, 2) + "\n", "utf8");
    res.json({ ok: true, filename: name });
  } catch (e: any) { res.status(400).send(e.message || String(e)); }
});

app.put("/fs/changelog/update", (req, res) => {
  ensureDir();
  try {
    const { filename, data } = req.body as { filename: string; data: any };
    if (!filename) throw new Error("filename required");
    validateData(data);
    const full = filePath(filename);
    if (!existsSync(full)) return res.status(404).send("file not found");
    writeFileSync(full, JSON.stringify(data, null, 2) + "\n", "utf8");
    res.json({ ok: true, filename });
  } catch (e: any) { res.status(400).send(e.message || String(e)); }
});

app.delete("/fs/changelog/delete", (req, res) => {
  ensureDir();
  try {
    const { filename } = req.body as { filename: string };
    if (!filename) throw new Error("filename required");
    const full = filePath(filename);
    if (!existsSync(full)) return res.status(404).send("file not found");
    rmSync(full);
    res.json({ ok: true, filename });
  } catch (e: any) { res.status(400).send(e.message || String(e)); }
});

app.listen(PORT, HOST, () => {
  console.log(`[toolbelt] http://${HOST}:${PORT}`);
  console.log(`[toolbelt] key: ${TOOLBELT_KEY}`);
  console.log(`[toolbelt] repo: ${REPO}`);
});
```

---
Generated with UTF-8 to avoid mojibake.
