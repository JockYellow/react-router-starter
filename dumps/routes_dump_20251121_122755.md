## Routes Dump (20251121_122755)
專案根目錄：D:\CloudflarePage\react-router-starter\

## Root: D:\CloudflarePage\react-router-starter\app
### 檔案清單（相對 D:\CloudflarePage\react-router-starter\）
app\app.css
app\components\DevMenu.tsx
app\content\blog\categories.json
app\content\blog\posts\2025-02-05-color-palette.json
app\content\blog\posts\2025-02-10-workers-routing.json
app\content\blog\posts\2025-11-18-post-mi4alit2-u8dbwy.json
app\content\blog\posts\2025-11-18-post-mi4f16ip-egcwkp.json
app\content\blog\posts\2025-11-20-post-mi7a5anc.json
app\content\blog\posts\2025-11-20-post-mi7a9fyv.json
app\content\changelog\2025-11-12-update.json
app\content\changelog\2025-11-13-update.json
app\content\changelog\2025-11-14-update.json
app\content\changelog\2025-11-18-blog.json
app\content\changelog\2025-11-20-blog.json
app\entry.server.tsx
app\lib\admin-auth.server.ts
app\lib\blog.d1.server.ts
app\lib\blog.server.ts
app\lib\blog.types.ts
app\lib\changelog.server.ts
app\lib\d1.server.ts
app\root.tsx
app\routes.ts
app\routes\_index.tsx
app\routes\about.tsx
app\routes\admin.blog-edit.tsx
app\routes\admin.login.tsx
app\routes\admin.tsx
app\routes\api.blog-post.tsx
app\routes\blog.tsx
app\routes\changelog.tsx

---
### app\app.css
```css
/* app/app.css */
@import "tailwindcss" source(".");

/* === Design Tokens === */
@theme {
  --font-sans:
    "Inter", ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji",
    "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";

  /* brand colors */
  --color-brand-50:  #FFF7E1;
  --color-brand-100: #FBEFC8;
  --color-brand-200: #F1E2A4;
  --color-brand-300: #E8C872; /* 主黃 */
  --color-brand-400: #D9B45A;
  --color-brand-500: #B9923E;
  --color-brand-600: #8B6C26;

  --color-accent-50:  #F8F5FF;
  --color-accent-100: #EDE8FE;
  --color-accent-200: #DAD3FA;
  --color-accent-300: #BFB4EE;
  --color-accent-400: #7A6AAE; /* 主紫 */
  --color-accent-500: #6B5CA0;
  --color-accent-600: #4C3D81;

  --color-module-hero:     #FFEAC5;
  --color-module-about:    #F6DFFF;
  --color-module-skills:   #DDEBFF;
  --color-module-projects: #DDF8EF;
  --color-module-contact:  #FFE0D9;

  --color-warm-0:   #FFFFFF;
  --color-warm-25:  #FDFCFB;
  --color-warm-50:  #F6F5F2; /* 背景暖白 */
  --color-warm-100: #EEECE6;

  /* radii / shadow */
  --radius-card: 1rem;     /* 16px */
  --shadow-soft: 0 6px 18px rgba(20, 10, 0, 0.06);
  --shadow-hover: 0 10px 26px rgba(20, 10, 0, 0.08);
}

/* === Base === */
html, body {
  color: #1E1B16;
  background:
    radial-gradient(circle at top left, rgba(255, 244, 209, 0.8), rgba(255, 244, 209, 0) 55%),
    radial-gradient(circle at 80% 20%, rgba(219, 208, 253, 0.7), rgba(219, 208, 253, 0) 60%),
    var(--color-warm-50);
  font-family: var(--font-sans);
  @media (prefers-color-scheme: dark) {
    color-scheme: dark;
  }
}
html { scroll-behavior: smooth; }

/* 區塊統一間距與標題 */
.section { @apply py-14 md:py-20; }
.section-title {
  @apply text-2xl md:text-3xl font-semibold tracking-tight text-neutral-900 flex items-center gap-3;
}
.section-title::before {
  content: "";
  width: 40px;
  height: 4px;
  border-radius: 999px;
  background: linear-gradient(90deg, var(--color-accent-500), var(--color-brand-400));
  display: inline-block;
}
.eyebrow {
  letter-spacing: 0.24em;
  text-transform: uppercase;
  font-size: 0.7rem;
  font-weight: 600;
  color: var(--color-accent-600);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}
.eyebrow::before {
  content: "";
  width: 18px;
  height: 1px;
  background: currentColor;
  opacity: 0.6;
}

.module-panel {
  --module-color: var(--color-warm-0);
  position: relative;
  border-radius: 1.75rem;
  padding: clamp(1.75rem, 4vw, 3rem);
  background: color-mix(in oklab, var(--module-color) 85%, white);
  border: 1px solid color-mix(in oklab, var(--module-color) 50%, #6B5CA0 8%);
  box-shadow: 0 30px 70px rgba(17, 12, 5, 0.08);
  overflow: hidden;
}
.module-panel::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(circle at 80% 0%, rgba(255,255,255,0.9), transparent 45%);
  mix-blend-mode: screen;
  opacity: 0.4;
}
.module-panel > * { position: relative; z-index: 1; }
.module-hero { --module-color: var(--color-module-hero); }
.module-about { --module-color: var(--color-module-about); }
.module-skills { --module-color: var(--color-module-skills); }
.module-projects { --module-color: var(--color-module-projects); }
.module-contact { --module-color: var(--color-module-contact); }
.module-meta {
  @apply text-sm text-neutral-600;
  opacity: 0.9;
}

/* === Components === */
@layer components {
  .card {
    border-radius: calc(var(--radius-card) * 1.1);
    box-shadow: 0 18px 38px rgba(26, 19, 6, 0.08);
    @apply bg-white/95 border border-[color:rgba(0,0,0,0.08)] p-6 transition-shadow;
  }
  .card:hover { box-shadow: var(--shadow-hover); }

  .input {
    @apply w-full rounded-md border border-neutral-300 bg-white px-3 py-2 outline-none
           focus:ring-2 focus:ring-[--color-accent-200] focus:border-[--color-accent-400];
  }

  /* 移除 @apply btn，直接展開 utility（這樣 Tailwind 才不會報 unknown utility） */
  .btn-primary {
    @apply inline-flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition text-neutral-900;
    background: linear-gradient(180deg, var(--color-brand-200), var(--color-brand-300));
    box-shadow: 0 1px 0 rgba(255,255,255,.6) inset, 0 6px 16px rgba(185,146,62,.18);
  }
  .btn-primary:hover {
    background: linear-gradient(180deg, var(--color-brand-200), var(--color-brand-400));
  }

  .btn-ghost {
    @apply inline-flex items-center justify-center px-4 py-2 rounded-md text-sm font-medium transition text-[--color-accent-500] bg-[color:transparent] hover:bg-[--color-accent-50];
    border: 1px solid var(--color-accent-200);
  }

  .link-soft {
    @apply text-[--color-accent-500] hover:text-[--color-accent-400] underline-offset-4 hover:underline;
  }

  .chip {
    @apply inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs;
    background: color-mix(in oklab, var(--color-accent-50) 70%, white);
    border: 1px solid var(--color-accent-200);
    color: var(--color-accent-500);
  }

  /* 細分隔線：比實線更柔和 */
  .divider {
    background: linear-gradient(90deg, transparent, rgba(0,0,0,.08), transparent);
    height: 1px;
  }

  .stat-pill {
    @apply inline-flex flex-col rounded-2xl px-4 py-3 text-xs uppercase tracking-[0.25em] font-semibold text-neutral-800;
    border: 1px solid rgba(0,0,0,0.08);
    background: rgba(255,255,255,0.45);
    backdrop-filter: blur(6px);
  }

  .skill-card {
    border-radius: 1.25rem;
    padding: 1.5rem;
    background: rgba(255,255,255,0.7);
    border: 1px solid rgba(123,106,174,0.15);
    box-shadow: 0 10px 25px rgba(17, 14, 12, 0.08);
    transition: transform .2s ease, box-shadow .2s ease;
  }
  .skill-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 18px 38px rgba(17, 14, 12, 0.12);
  }

  .hover-raise { transform: translateY(0); transition: transform .2s ease, box-shadow .2s ease; }
  .hover-raise:hover { transform: translateY(-2px); box-shadow: var(--shadow-hover); }
}

```

---
### app\components\DevMenu.tsx
```tsx
import { useEffect, useRef, useState } from "react";

/**
 * 隱藏的管理入口：
 * - 本機 DEV 自動顯示（加速開發）
 * - 非 DEV：在右下角隱藏熱區「連點 5 下」→ 跳出密碼 prompt →
 *   密碼正確即解鎖並記錄於 localStorage，之後同瀏覽器都會顯示。
 *
 * 注意：這不是嚴格安全機制，僅用於避免一般訪客看到入口。
 * 建議將密碼設在環境變數 `VITE_ADMIN_PASS`（或預設 "letmein"）。
 */
export default function DevMenu() {
  const [show, setShow] = useState(false);
  const [isLocal, setIsLocal] = useState(false);
  const tapCount = useRef(0);
  const tapTimer = useRef<number | null>(null);

  const handleSecretTap = () => {
    tapCount.current += 1;
    if (tapTimer.current) {
      window.clearTimeout(tapTimer.current);
    }
    tapTimer.current = window.setTimeout(() => {
      tapCount.current = 0;
    }, 1600);

    if (tapCount.current >= 5) {
      tapCount.current = 0;
      localStorage.setItem("showAdminMenu", "1");
      setShow(true);
    }
  };

  useEffect(() => {
    const stored = localStorage.getItem("showAdminMenu") === "1";
    const host = window.location.hostname;
    const isLocalHost =
      host === "localhost" ||
      host === "127.0.0.1" ||
      host.startsWith("192.168.") ||
      host.startsWith("10.");

    setIsLocal(import.meta.env.DEV || isLocalHost);

    if (import.meta.env.DEV || isLocalHost || stored) {
      setShow(true);
    }
    return () => {
      if (tapTimer.current) window.clearTimeout(tapTimer.current);
    };
  }, []);

  return (
    <>
      {/* 右下角隱藏熱區：點擊 5 下觸發密碼驗證 */}
      <button
        type="button"
        aria-label="Admin unlock area"
        onClick={handleSecretTap}
        className="fixed bottom-4 right-4 h-10 w-10 opacity-0"
        style={{ zIndex: 40 }}
      />

      {show && (
        <div className="fixed bottom-4 right-4 z-50">
          {isLocal ? (
            <a
              href="http://127.0.0.1:43210/admin/"
              className="px-4 py-2 rounded-xl shadow-md bg-black/80 text-white text-sm hover:bg-black"
            >
              管理後台
            </a>
          ) : (
            <a
              href="/admin"
              title="Blog 管理"
              className="flex h-10 w-10 items-center justify-center rounded-full bg-black/80 text-white text-lg shadow-md hover:bg-black"
            >
              ✎
            </a>
          )}
        </div>
      )}
    </>
  );
}

```

---
### app\content\blog\categories.json
```json
{
  "categories": [
    {
      "id": "edge",
      "title": "Edge 筆記",
      "description": "Workers 與邊緣部署心得。",
      "children": [
        {
          "id": "edge-routing",
          "title": "Routing"
        },
        {
          "id": "edge-observability",
          "title": "Observability"
        }
      ]
    },
    {
      "id": "design",
      "title": "Design System",
      "description": "色彩、Token 與 UI 演進。",
      "children": [
        {
          "id": "design-color",
          "title": "Color"
        },
        {
          "id": "design-system",
          "title": "System"
        }
      ]
    },
    {
      "id": "cat-mi4akefj-9chrlz",
      "title": "旅行",
      "description": "想成為興趣 但現實不允",
      "children": [
        {
          "id": "2024",
          "title": "2024美國行"
        }
      ]
    },
    {
      "id": "cat-mi4f0f4z-urks8l",
      "title": "日記",
      "description": "純純的文字欲",
      "children": [
        {
          "id": "subcat-mi4f100p-htiheo",
          "title": "樹洞"
        },
        {
          "id": "subcat-mi7a8xcl-hlv5sb",
          "title": "還在內耗",
          "description": "總在反省的時候"
        }
      ]
    },
    {
      "id": "cat-mi7a5z88-81296v",
      "title": "短思還在想",
      "description": "我想到聽到什麼一句話",
      "children": [
        {
          "id": "subcat-mi7a6mc2-gyhglj",
          "title": "野生銘誌"
        }
      ]
    }
  ]
}

```

---
### app\content\blog\posts\2025-02-05-color-palette.json
```json
{
  "title": "Token 化的色彩混合",
  "body": "將 UI token 與 CSS variables 調校成兩組色盤，\n在深色背景也能維持柔和節奏。\n同步記錄了 Figma plugin 的測試心得。\n以上都是假的 並沒有",
  "categoryId": "design",
  "subcategoryId": "design-color",
  "publishedAt": "2025-02-05T06:00:00.000Z",
  "slug": "color-palette"
}

```

---
### app\content\blog\posts\2025-02-10-workers-routing.json
```json
{
  "title": "Workers x React Router Routing 策略",
  "body": "這次把 React Router v7 loader 與 Workers KV 快取重新整理，\n從 Route Manifest 到 Edge 服務端渲染都記錄下來。\n也練習在 DevTools 觀察 WSS streaming 的效能。",
  "categoryId": "edge",
  "subcategoryId": "edge-routing",
  "publishedAt": "2025-02-09T19:00:00.000Z",
  "slug": "workers-routing"
}

```

---
### app\content\blog\posts\2025-11-18-post-mi4alit2-u8dbwy.json
```json
{
  "title": "出發前的逃避是最危險的距離",
  "body": "回顧我的旅行。\n\n很久沒有出國了，而且還是去往美國，一個總在電視上遙望的國度。\n\n只少，到了現場才驚覺，這個世界比想像中的還近。\n\n熟悉而陌生的文化、一目目不該習以為常的景色，映照在眼裡，勾起記憶中的片片文化。\n\n要從哪裡細數? 從小的”卡通”，偶而瞥見的美劇，廢寢忘食的美式情景喜劇，還有一部部如數家珍的電影。\n\n雖然那時，所謂版權意識只存在片頭的警告中，後續就會被詭異的、跑到鏡頭前的黑影給遮住了。看著所謂先行版、高清版、超清版、韓語無字版等等，可疑的讓人忘記自己在看電影，彷彿縮於一禺的再看一些糟糕的東西。(當然，現在知道那些糟糕並無差異。)\n\n扯遠了，對於美國的追憶我想接下來還有好大的段落可以不斷穿插，拉回來說這次的旅遊預備。必須說，我所投注的心力真的蠻少的，事前幾乎沒有什麼進行行程規劃，唯一出的意見－\"優勝美地\"。過去的成本又高的離譜，要翻山越嶺才有辦法。 以我對於旅程的掌控程度來說，這一次的可以說是”零”。 至於為什麼會造成這樣的怠惰，回顧一下我自己在旅遊的時候，確實，只要是有旅伴的，我幾乎都懶得安排，也不是沒有毛起來當導遊過，但....就感覺蠻累的，而且與其嘗試搜盡資訊來與自己的期待碰撞，我想，我內心有著潛意識告訴自己，那不如不帶預期的去體驗吧！當然，也不否認，就是我懶罷。\n\n我這次，真的已經很早就報備父母了，但鄰近時地提及，自然還是帶給他們”驚喜”。但我想，最大的驚喜，還是留給了我的另一個家－教會。\n\n很難忘記，前一周大家緊鑼密鼓的排演，準備盛大的迎來又一次的農會表演。回顧這個活動，我從不認為自己是重要主角，但也確實，再次次的活動中，被慢慢賦予了一些定位，兒主之友、收線特派員、搬運弟兄組等等。這些不起眼卻又實實在在貢獻的角色，尤其看著其他無名肢體的默默付出，一種感動與使命讓我也產生了捨我其誰的錯覺。\n\n我在排定這場旅遊時，我有沒有想到呢 ? 肯定沒有！　但是隨著時間臨近，大概是兩到三個月的時候，我發現怎麼算、好像都沒辦法避開，那復活的節日。天啊，這下到底該怎麼辦？\n\n逃避雖然沒用，但是可以騙過自己，看著日子漸漸地近了，手機拿起來滑開了主德哥的訊息位置，但也依然沒有勇氣坦承。＂下一次見面、下一周、回家後就用訊息＂，一次次的拖延，將石頭漸漸推上高峰。走在逃避的路線中，終究會遇上盡頭。而盡頭，是最溫暖、最洞悉人的師母，我想，這就上帝他的仁慈，用最溫柔的鋼索，漸漸嵌入我的皮膚之中。\n\n＂下周也要麻煩您支援兒主囉！，所以請你也要記得來參加早崇拜。＂隨著師母的詢問，顯然這路已經到了盡頭，隱瞞的控訴已經是最高的罪行，我不可能讓更多的謊言建築在我的家中。\n\n＂我下周要出去玩＂，我說的很輕描淡寫，而隨著師母笑著問話，才發現這一切案情並不單純，眼前這小子不只是知情未報，甚至逃避的讓人吃驚了！整整快兩周的行程，竟壓到最後一刻才要鬆口。\n\n＂要我幫你跟主德哥說嗎？＂我當時依然故作堅強的說＂不用＂。再被叮嚀著要好好聚會後，我竟帶著微微的舒坦離開，就好像我自己已經努力過了、做了什麼似的。並沒有！\n\n我還是高估了我自己的堅決，或說低估自己的無能。直到在機場的一通電話，我的罪惡感才爆發。",
  "categoryId": "cat-mi4akefj-9chrlz",
  "subcategoryId": "2024",
  "publishedAt": "2025-11-17T17:00:00.000Z",
  "slug": "post-mi4alit2-u8dbwy"
}

```

---
### app\content\blog\posts\2025-11-18-post-mi4f16ip-egcwkp.json
```json
{
  "title": "面對錯誤/訊息嗎",
  "body": "手機又留有好幾則未回的訊息\n\n統編忘記檢查、新窗口還沒連繫、錯誤訊息還沒說明、新的會議還沒約….\n\n好想要無視阿!!!\n\n每個提問都有可能是隱藏的缺失，一隻隻箭在朝我射來的路上，我還要打開來被刺成刺蝟嗎?\n\n說我不愛回訊息，但其實我話超多的，根本不怕跟別人溝通。\n\n所謂的不回，是物理上的無視與心理上的不適。\n\n無視、無謂、無法\n\n慢慢將他放到過期，然後就…\n\n“哎呀 我忘記了”\n\n但怎麼可能忘記呢? 最後還是從小本本上被更多代辦事項壓到最底下而已\n\n緊急的狀態等級已經到極限了，驚嘆號再多不夠分類，或者說再多也無法鞭策我進行下一步動作\n\n事件的重要跟緊急又總是只有第一象限了。\n\n就像現在我還有些東西，要做、要看。但我還是在這裡跟自己發牢騷。\n\n訊息真的好煩阿!! \n\n但我為什麼怎麼不喜歡面對錯誤呢? 我從未立過完美人設，因為我要用迷糊跟不記得來逃避一些既來的控訴。但我依然對於種種指責採取無視政策，逃避，又是我唯一對自己的慢性毒藥。",
  "categoryId": "cat-mi4f0f4z-urks8l",
  "subcategoryId": "subcat-mi4f100p-htiheo",
  "publishedAt": "2025-11-18T02:00:00.000Z",
  "slug": "post-mi4f16ip-egcwkp"
}

```

---
### app\content\blog\posts\2025-11-20-post-mi7a5anc.json
```json
{
  "title": "生命的長度，在於你記得什麼、做過什麼，而不在於時間過了多久",
  "body": "阿阿阿！感覺我的人生總有些時候不小心按到skip",
  "categoryId": "cat-mi7a5z88-81296v",
  "subcategoryId": "subcat-mi7a6mc2-gyhglj",
  "publishedAt": "2025-11-20T10:19:43.000Z",
  "slug": "post-mi7a5anc",
  "createdAt": "2025-11-20T10:22:07.137Z",
  "updatedAt": "2025-11-20T10:22:07.137Z"
}

```

---
### app\content\blog\posts\2025-11-20-post-mi7a9fyv.json
```json
{
  "title": "我想要聽演唱會(?",
  "body": "時間一年一年的過\n\n總在努力尋找些什麼、證明自己存在過\n\n但又不知道什麼是自己真正想要的、什麼是自己期待遇見的\n\n什麼是自己內心渴望的\n\n這一年 算是演唱會元年\n\n我用大大小小的演出畫出我生活個隔間\n\n每場的感動不盡相同、想要留下些什麼，才發現過了一年自己還在盲目的刷卡，而少有將生命的長度延續。\n\n接下來是連續三天的演唱會，幸福之餘，難免開始懷疑自己：這是我想要的豐富嗎？我的寂寞與渴望，是否有在一陣陣的歌聲及樂器中滿足？\n\n真心懷疑……\n\n前面又看了藍色巨星，對於爵士也燃起了一些興趣，但又害怕這所謂的＂興趣＂，也只是一時興起的激情，等到求知慾、熱度退卻，我又回到地面上繼續撰寫內耗般的文章。\n\n說也沮喪（？　對於自身的自嘲文章下筆如有神助，但是對於一篇篇自己實際期待的旅遊文章、心得文章，其實一丁點也沒有。\n\n感覺是腦裡的片片記憶，當落地之時，猶如雪花，其實沒有想像中繽紛、有趣、充滿靈性與豐富的思緒。\n\n只有水而已。",
  "categoryId": "cat-mi4f0f4z-urks8l",
  "subcategoryId": "subcat-mi7a8xcl-hlv5sb",
  "publishedAt": "2025-11-20T10:22:07.000Z",
  "slug": "post-mi7a9fyv",
  "createdAt": "2025-11-20T10:23:30.237Z",
  "updatedAt": "2025-11-20T10:23:30.237Z"
}

```

---
### app\content\changelog\2025-11-12-update.json
```json
{
  "date": "2025-11-12",
  "title": "增加地端管理選單",
  "tag": "add",
  "notes": [
    "新增管理UI功能",
    "新增管理後台",
    "把Changelog Page 的更新方式放到後台裡面"
  ]
}

```

---
### app\content\changelog\2025-11-13-update.json
```json
{
  "date": "2025-11-13",
  "title": "更新選單功能 UI進行更新",
  "tag": "add",
  "notes": [
    "新增Git add & push",
    "寫更完整的 Git 紀錄",
    "確認可以一鍵到布署"
  ]
}

```

---
### app\content\changelog\2025-11-14-update.json
```json
{
  "date": "2025-11-14",
  "title": "首頁改版",
  "tag": "add",
  "notes": [
    "模組切換建在頁面頂部直接切換文案、點擊平滑捲動。",
    "樣式同步調整；Hero 配色和字色更新以維持足夠對比。"
  ]
}

```

---
### app\content\changelog\2025-11-18-blog.json
```json
{
  "date": "2025-11-18",
  "title": "新增BLOG 功能",
  "tag": "add",
  "notes": [
    "有兩層階的項目管理",
    "目前可以貼純文字",
    "編輯更新篩選等基本功能都上去了"
  ]
}

```

---
### app\content\changelog\2025-11-20-blog.json
```json
{
  "date": "2025-11-20",
  "title": "BLOG 編輯功能線上版(研究中)",
  "tag": "add",
  "notes": [
    "將文章完全轉移進了DB",
    "預計讓blog可以線上編輯、使用帳密登入"
  ]
}

```

---
### app\entry.server.tsx
```tsx
import type { AppLoadContext, EntryContext } from "react-router";
import { ServerRouter } from "react-router";
import { isbot } from "isbot";
import { renderToReadableStream } from "react-dom/server";

export default async function handleRequest(
  request: Request,
  responseStatusCode: number,
  responseHeaders: Headers,
  routerContext: EntryContext,
  _loadContext: AppLoadContext,
) {
  let shellRendered = false;
  const userAgent = request.headers.get("user-agent");

  const body = await renderToReadableStream(
    <ServerRouter context={routerContext} url={request.url} />,
    {
      onError(error: unknown) {
        responseStatusCode = 500;
        // Log streaming rendering errors from inside the shell.  Don't log
        // errors encountered during initial shell rendering since they'll
        // reject and get logged in handleDocumentRequest.
        if (shellRendered) {
          console.error(error);
        }
      },
    },
  );
  shellRendered = true;

  // Ensure requests from bots and SPA Mode renders wait for all content to load before responding
  // https://react.dev/reference/react-dom/server/renderToPipeableStream#waiting-for-all-content-to-load-for-crawlers-and-static-generation
  if ((userAgent && isbot(userAgent)) || routerContext.isSpaMode) {
    await body.allReady;
  }

  responseHeaders.set("Content-Type", "text/html; charset=utf-8");
  return new Response(body, {
    headers: responseHeaders,
    status: responseStatusCode,
  });
}

```

---
### app\lib\admin-auth.server.ts
```ts
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

type Context = LoaderFunctionArgs["context"] | ActionFunctionArgs["context"];

const COOKIE_NAME = "admin_session";
const COOKIE_MAX_AGE = 30 * 24 * 60 * 60; // 30 days

function parseCookies(request: Request) {
  const header = request.headers.get("cookie") ?? "";
  return Object.fromEntries(
    header
      .split(";")
      .map((c) => c.trim())
      .filter(Boolean)
      .map((c) => {
        const [k, ...rest] = c.split("=");
        return [k, rest.join("=")];
      }),
  );
}

export function getAdminPassword(context: Context): string | null {
  const ctx = context as any;
  return (
    ctx?.cloudflare?.env?.ADMIN_PASS ??
    ctx?.env?.ADMIN_PASS ??
    ctx?.ADMIN_PASS ??
    process.env.ADMIN_PASS ??
    "letmein"
  );
}

export function isAdmin(request: Request) {
  const cookies = parseCookies(request);
  return cookies[COOKIE_NAME] === "1";
}

export function requireAdmin(request: Request, context: Context) {
  if (isAdmin(request)) return;
  const url = new URL("/admin/login", request.url);
  throw new Response(null, {
    status: 302,
    headers: {
      Location: url.toString(),
    },
  });
}

export function createAdminSessionCookie() {
  return [
    `${COOKIE_NAME}=1`,
    "Path=/",
    "HttpOnly",
    "SameSite=Lax",
    `Max-Age=${COOKIE_MAX_AGE}`,
  ].join("; ");
}

export function clearAdminSessionCookie() {
  return [`${COOKIE_NAME}=; Path=/`, "HttpOnly", "SameSite=Lax", "Max-Age=0"].join("; ");
}

```

---
### app\lib\blog.d1.server.ts
```ts
import type { BlogPost } from "./blog.types";

function parseTags(raw: string | null | undefined) {
  if (!raw) return [] as string[];
  try {
    const parsed = JSON.parse(raw);
    if (Array.isArray(parsed)) {
      return parsed.map((tag) => tag.toString());
    }
  } catch {
    // ignore broken JSON and fall back to empty array
  }
  return [];
}

function mapRowToPost(row: Record<string, any>): BlogPost {
  return {
    slug: row.slug,
    title: row.title,
    summary: row.summary ?? "",
    body: row.body ?? "",
    tags: parseTags(row.tags),
    categoryId: row.category_id ?? undefined,
    subcategoryId: row.subcategory_id ?? undefined,
    publishedAt: row.published_at,
    createdAt: row.created_at,
    updatedAt: row.updated_at,
  };
}

export async function getAllBlogPosts(db: D1Database): Promise<BlogPost[]> {
  const statement = db.prepare(
    `SELECT slug, title, summary, body, tags, category_id, subcategory_id, published_at, created_at, updated_at
     FROM blog_posts
     ORDER BY datetime(published_at) DESC, id DESC`,
  );
  const { results } = await statement.all<Record<string, any>>();
  return results.map(mapRowToPost);
}

export async function getBlogPostBySlug(db: D1Database, slug: string): Promise<BlogPost | null> {
  const statement = db.prepare(
    `SELECT slug, title, summary, body, tags, category_id, subcategory_id, published_at, created_at, updated_at
     FROM blog_posts WHERE slug = ? LIMIT 1`,
  );
  const row = await statement.bind(slug).first<Record<string, any>>();
  return row ? mapRowToPost(row) : null;
}

```

---
### app\lib\blog.server.ts
```ts
import type { BlogCategory, BlogPost } from "./blog.types";
export type { BlogCategory, BlogSubcategory, BlogPost } from "./blog.types";

const BLOG_POST_RE = /^[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-z0-9\-]+\.json$/i;

export async function loadBlogCategories() {
  if (import.meta.env.DEV) {
    try {
      const fs = await import("node:fs/promises");
      const path = await import("node:path");
      const { fileURLToPath } = await import("node:url");
      const __filename = fileURLToPath(import.meta.url);
      const __dirname = path.dirname(__filename);
      const candidates = [
        path.resolve(__dirname, "../content/blog/categories.json"),
        path.resolve(process.cwd(), "app/content/blog/categories.json"),
      ];
      for (const candidate of candidates) {
        try {
          const raw = await fs.readFile(candidate, "utf8");
          const data = JSON.parse(raw) as { categories: BlogCategory[] };
          return data.categories || [];
        } catch {
          continue;
        }
      }
    } catch {
      // ignore
    }
  }
  const mod: any = await import("../content/blog/categories.json");
  const data = mod.default ?? mod;
  return (data.categories || []) as BlogCategory[];
}

function deriveSummary(body: string) {
  const firstParagraph =
    body
      ?.split(/\n+/)
      .map((line) => line.trim())
      .filter(Boolean)[0] ?? "";
  if (!firstParagraph) return "";
  return firstParagraph.length > 200 ? `${firstParagraph.slice(0, 197)}…` : firstParagraph;
}

export async function loadBlogPosts() {
  const posts: BlogPost[] = [];
  if (import.meta.env.DEV) {
    try {
      const fs = await import("node:fs/promises");
      const path = await import("node:path");
      const { fileURLToPath } = await import("node:url");
      const __filename = fileURLToPath(import.meta.url);
      const __dirname = path.dirname(__filename);
      const candidates = [
        path.resolve(__dirname, "../content/blog/posts"),
        path.resolve(process.cwd(), "app/content/blog/posts"),
      ];
      let dir: string | null = null;
      for (const candidate of candidates) {
        try {
          const stat = await fs.stat(candidate);
          if (stat.isDirectory()) {
            dir = candidate;
            break;
          }
        } catch {
          continue;
        }
      }
      if (dir) {
        const files = (await fs.readdir(dir)).filter((f) => BLOG_POST_RE.test(f));
        for (const file of files) {
          try {
            const raw = await fs.readFile(path.join(dir, file), "utf8");
            posts.push({ ...(JSON.parse(raw) as BlogPost), filename: file });
          } catch {
            // ignore malformed file
          }
        }
      }
    } catch {
      // ignore
    }
  }
  if (!posts.length) {
    const modules = import.meta.glob("../content/blog/posts/*.json", { eager: true });
    for (const [p, mod] of Object.entries(modules)) {
      const data = (mod as any).default ?? (mod as any);
      const filename = p.split("/").pop();
      posts.push({ ...(data as BlogPost), filename });
    }
  }
  const normalized = posts.map((post) => {
    const body = typeof post.body === "string" ? post.body : "";
    const createdAt = post.createdAt ?? post.publishedAt ?? new Date().toISOString();
    const updatedAt = post.updatedAt ?? createdAt;
    const summary = post.summary ?? deriveSummary(body);
    const tags = Array.isArray(post.tags) ? post.tags.map((tag) => tag.toString()) : [];
    return {
      ...post,
      body,
      summary,
      tags,
      createdAt,
      updatedAt,
      slug: post.slug ?? (post as any).filename?.replace(/^\d{4}-\d{2}-\d{2}-/, "").replace(/\.json$/, ""),
    };
  });
  normalized.sort((a, b) => (a.publishedAt < b.publishedAt ? 1 : -1));
  return normalized;
}

```

---
### app\lib\blog.types.ts
```ts
export type BlogSubcategory = {
  id: string;
  title: string;
  description?: string;
};

export type BlogCategory = {
  id: string;
  title: string;
  description?: string;
  children: BlogSubcategory[];
};

export type BlogPost = {
  slug: string;
  title: string;
  summary: string;
  body: string;
  tags: string[];
  publishedAt: string; // ISO string
  createdAt: string;
  updatedAt: string;
  categoryId?: string | null;
  subcategoryId?: string | null;
  filename?: string;
};

```

---
### app\lib\changelog.server.ts
```ts
import type { LoaderFunctionArgs } from "react-router";

export type ChangelogItem = {
  date: string;
  title: string;
  notes?: string[];
  tag?: "add" | "fix" | "change" | "docs";
  filename?: string;
};

/**
 * Shared loader utility so both首頁和 changelog 頁都能讀取相同來源。
 */
export async function loadChangelogItems(_args?: LoaderFunctionArgs) {
  if (import.meta.env.DEV) {
    try {
      const fs = await import("node:fs/promises");
      const path = await import("node:path");
      const { fileURLToPath } = await import("node:url");

      const __filename = fileURLToPath(import.meta.url);
      const __dirname = path.dirname(__filename);
      const candidates = [
        path.resolve(__dirname, "../content/changelog"),
        path.resolve(process.cwd(), "app/content/changelog"),
      ];

      let contentDir: string | null = null;
      for (const candidate of candidates) {
        try {
          const stat = await fs.stat(candidate);
          if (stat.isDirectory()) {
            contentDir = candidate;
            break;
          }
        } catch {
          // ignore
        }
      }

      if (contentDir) {
        const NAME_RE = /^\d{4}-\d{2}-\d{2}-[a-z0-9\-]+\.json$/i;
        const files = (await fs.readdir(contentDir)).filter((f) => NAME_RE.test(f));
        const items: ChangelogItem[] = [];
        for (const file of files) {
          try {
            const raw = await fs.readFile(path.join(contentDir, file), "utf8");
            const data = JSON.parse(raw) as ChangelogItem;
            items.push({ ...data, filename: file });
          } catch {
            // ignore broken file
          }
        }
        items.sort((a, b) => (a.date < b.date ? 1 : -1));
        return items;
      }
    } catch {
      // dev file read failed, fall back to Vite glob
    }
  }

  const modules = import.meta.glob("../content/changelog/*.json", { eager: true });
  const items: ChangelogItem[] = Object.entries(modules).map(([p, m]: any) => {
    const data = m.default ?? m;
    const filename = p.split("/").pop();
    return { ...data, filename } as ChangelogItem;
  });
  items.sort((a, b) => (a.date < b.date ? 1 : -1));
  return items;
}

```

---
### app\lib\d1.server.ts
```ts
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

type Context = LoaderFunctionArgs["context"] | ActionFunctionArgs["context"];

export function requireBlogDb(context: Context) {
  const ctx = context as any;
  const db =
    ctx?.cloudflare?.env?.BLOG_DB ??
    ctx?.cloudflare?.env?.blog_db ??
    ctx?.env?.BLOG_DB ??
    ctx?.env?.blog_db ??
    ctx?.BLOG_DB ??
    ctx?.blog_db;
  if (!db) {
    throw new Response("BLOG_DB binding is missing", { status: 500 });
  }
  return db as D1Database;
}

```

---
### app\root.tsx
```tsx
// app/root.tsx
import {
  Link,
  Links,
  Outlet,
  Scripts,
  useLocation,
} from "react-router";
import { useEffect, useRef, useState } from "react";
import "./app.css";

import DevMenu from "./components/DevMenu";



/** 自動隱藏 Header，向下捲動隱藏、向上顯示 */
function AutoHideHeader() {
  const [hidden, setHidden] = useState(false);
  const lastY = useRef(0);
  const ticking = useRef(false);

  useEffect(() => {
    function onScroll() {
      const y = window.scrollY || 0;
      if (!ticking.current) {
        window.requestAnimationFrame(() => {
          const goingDown = y > lastY.current;
          const delta = Math.abs(y - lastY.current);
          if (y < 24 || !goingDown || delta > 10) {
            setHidden(false);
          } else if (goingDown && y > 96) {
            setHidden(true);
          }
          lastY.current = y;
          ticking.current = false;
        });
        ticking.current = true;
      }
    }
    window.addEventListener("scroll", onScroll, { passive: true });
    return () => window.removeEventListener("scroll", onScroll);
  }, []);

  const tabs = [
    { id: "blog", label: "Blog" },
    { id: "guestbook", label: "Guestbook" },
    { id: "changelog", label: "Changelog" },
    { id: "lab", label: "Lab" },
  ];

  const [active, setActive] = useState("blog");
  useEffect(() => {
    const sections = tabs.map(t => document.getElementById(t.id)).filter(Boolean) as HTMLElement[];
    const io = new IntersectionObserver(
      entries => {
        const visible = entries
          .filter(e => e.isIntersecting)
          .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];
        if (visible?.target?.id) setActive(visible.target.id);
      },
      { rootMargin: "-20% 0px -60% 0px", threshold: [0.25, 0.5, 0.75] }
    );
    sections.forEach(s => io.observe(s));
    return () => io.disconnect();
  }, []);

  return (
    <header
      className={`fixed inset-x-0 top-0 z-50 transition-transform duration-300 will-change-transform
      ${hidden ? "-translate-y-full" : "translate-y-0"}`}
    >
      <div className="backdrop-blur-md bg-[--color-warm-25]/80 border-b border-[--color-warm-100]">
        <div className="mx-auto max-w-6xl px-4 h-14 flex items-center justify-between">
          <Link to="/" className="font-semibold tracking-wide">個人網站</Link>
          <nav className="hidden md:flex items-center gap-6 text-sm">
            {tabs.map(t => (
              <a
                key={t.id}
                href={`/#${t.id}`}
                className={`py-1 border-b-2 -mb-[2px] transition-colors ${
                  active === t.id
                    ? "border-[--color-accent-400] text-neutral-900"
                    : "border-transparent text-neutral-600 hover:text-neutral-800 hover:border-[--color-accent-200]"
                }`}
              >
                {t.label}
              </a>
            ))}
          </nav>
          <Link to="/changelog" className="text-sm link-soft hidden md:inline">更新日誌</Link>
          <a href="#blog" className="md:hidden text-sm text-neutral-600">目錄</a>
        </div>
      </div>
    </header>
  );
}

/** 頁面框架 */
function App() {
  const { pathname } = useLocation();
  useEffect(() => {
    window.scrollTo({ top: 0, behavior: "instant" as ScrollBehavior });
  }, [pathname]);

  return (
    <div className="min-h-screen bg-[--color-warm-50] text-neutral-900">
      <AutoHideHeader />
      <main className="pt-16">
        <Outlet />
      </main>
      <DevMenu />
      <footer className="mt-16 border-t">
        <div className="mx-auto max-w-6xl px-4 py-8 text-sm text-neutral-600">
          © {new Date().getFullYear()} 個人網站
        </div>
      </footer>
    </div>
  );
}

/** HTML 骨架 */
export function Layout() {
  return (
    <html lang="zh-Hant">
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>個人網站</title>
        <Links />
      </head>
      <body>
        <App />
        <Scripts />
      </body>
    </html>
  );
}

export default App;

```

---
### app\routes.ts
```ts
// app/routes.ts
import { type RouteConfig, index, route } from "@react-router/dev/routes";

export default [
  index("routes/_index.tsx"), 
  route("about", "routes/about.tsx"),
  route("blog", "routes/blog.tsx"),
  route("changelog", "routes/changelog.tsx"),
  route("admin/login", "routes/admin.login.tsx"),
  route("admin", "routes/admin.tsx"),
] satisfies RouteConfig;

```

---
### app\routes\_index.tsx
```tsx
import { useState } from "react";
import type { CSSProperties } from "react";
import { useLoaderData } from "react-router";
import type { LoaderFunctionArgs } from "react-router";

import { loadChangelogItems, type ChangelogItem } from "../lib/changelog.server";
import { loadBlogCategories } from "../lib/blog.server";
import type { BlogPost, BlogCategory } from "../lib/blog.types";
import { getAllBlogPosts } from "../lib/blog.d1.server";
import { requireBlogDb } from "../lib/d1.server";

const SECTION_DATA = {
  blog: {
    label: "Blog",
    hero: {
      eyebrow: "Blog 模組",
      title: "個人網站 · 實驗室的文章焦點",
      description:
        "Workers、React Router 與 Cloudflare 架構的實戰心得會先在 Blog 模組整理，再同步至 Notion 與 RSS。",
      background: "linear-gradient(130deg, #fff5e3 0%, #f5e8ff 55%, #f0f8ff 100%)",
      borderColor: "rgba(233, 200, 155, 0.7)",
      metrics: [
        { label: "最新文章", value: "03", hint: "Workers 實作" },
        { label: "草稿排程", value: "08", hint: "Notion 同步" },
        { label: "Stack", value: "RRv7 · D1", hint: "Edge first" },
      ],
      preview: [
        {
          category: "焦點",
          title: "Workers + React Router",
          detail: "路由串接、快取策略與混合渲染記錄。",
        },
        {
          category: "設計",
          title: "Design Token 實作",
          detail: "以 tokens 與 CSS variables 讓文章與實驗保持一致。",
        },
      ],
      ctaLabel: "閱讀文章",
    },
    section: {
      eyebrow: "Blog",
      title: "文章列表",
      intro:
        "聚焦雲邊緣、React Router 與 UI 系統，文章以模組化格式記錄，方便快速擴充。",
      tint: "#FFF4E5",
      articles: [
        {
          title: "Workers + React Router 的混合渲染紀錄",
          excerpt: "整理 loader/action、快取、變更通知與 SSR 組合方式。",
          meta: "技術筆記 · 8 min",
          tags: ["Streaming", "Caching", "Routes"],
        },
        {
          title: "Design Token 驅動的 UI 調色流程",
          excerpt: "以 tokens 與 CSS variables 讓多模組維持一致光感。",
          meta: "設計系統 · 6 min",
          tags: ["Token", "UI Kit", "Tailwind"],
        },
        {
          title: "從 CLI 到 Cloudflare Pages 的部署腳本",
          excerpt: "整理 CI、Workers 與 Pages 的自動化部署步驟。",
          meta: "部署 · 5 min",
          tags: ["CLI", "Pages", "DX"],
        },
      ],
    },
  },
  guestbook: {
    label: "Guestbook",
    hero: {
      eyebrow: "Guestbook 模組",
      title: "留言板：把聲音留在邊緣節點",
      description:
        "留言使用 Cloudflare D1 + Durable Objects 進行即時紀錄，並透過 Turnstile 驗證阻擋垃圾訊息。",
      background: "linear-gradient(120deg, #f8ecff 0%, #e5f1ff 70%, #fef6ff 100%)",
      borderColor: "rgba(164, 138, 208, 0.6)",
      metrics: [
        { label: "互動紀錄", value: "48", hint: "最近 30 天" },
        { label: "表單驗證", value: "Turnstile", hint: "Edge action" },
        { label: "資料庫", value: "D1", hint: "雙寫入" },
      ],
      preview: [
        {
          category: "流程",
          title: "Edge Validation",
          detail: "使用 Remix action 結合 Turnstile 與節流策略減少 spam。",
        },
        {
          category: "同步",
          title: "Notion / D1 雙向",
          detail: "留言會推送至 Notion，排程整理後回寫邊緣節點。",
        },
      ],
      ctaLabel: "開啟留言板",
    },
    section: {
      eyebrow: "Guestbook",
      title: "留言板",
      intro: "只要動態表單驗證通過，就能在邊緣留言並即時同步到資料庫。",
      tint: "#F1E9FF",
      messages: [
        {
          name: "Sharon",
          role: "UI 設計師",
          message: "Tokens 色彩很穩，下一版一起把 Figma library 串進來。",
          time: "2 小時前",
          mood: "UI 夥伴",
        },
        {
          name: "Leo",
          role: "DX 工程師",
          message: "Workers action 寫得很乾淨，等你開源 CLI。",
          time: "昨天",
          mood: "DX 建議",
        },
        {
          name: "訪客 A",
          role: "讀者",
          message: "留言體驗順暢，Turnstile 幾乎感覺不到。",
          time: "本週",
          mood: "Feedback",
        },
      ],
    },
  },
  changelog: {
    label: "Changelog",
    hero: {
      eyebrow: "Changelog 模組",
      title: "更新日誌：版本節奏透明",
      description:
        "記錄頁面改版、部署與資料串接節點。追蹤模組狀態方便回溯決策。",
      background: "linear-gradient(120deg, #fef5e6 0%, #e9fff5 60%, #f3f9ff 100%)",
      borderColor: "rgba(190, 214, 189, 0.7)",
      metrics: [
        { label: "本月 PR", value: "12", hint: "包含 UI" },
        { label: "Deploy", value: "Pages", hint: "Auto" },
        { label: "監控", value: "Logpush", hint: "Edge" },
      ],
      preview: [
        {
          category: "版本",
          title: "Hero 動態切換",
          detail: "新首頁 hero 可即時預覽 Blog / Guestbook / Lab。",
        },
        {
          category: "Infra",
          title: "CI/CD",
          detail: "使用 Wrangler + GitHub Actions 部署到 Workers。",
        },
      ],
      ctaLabel: "查看日誌",
    },
    section: {
      eyebrow: "Changelog",
      title: "更新日誌",
      intro: "透過節點式記錄了解每週調整重點，搭配 Git tag 與 Pages Deploy ID。",
      tint: "#ECF9F1",
    },
  },
  lab: {
    label: "Lab",
    hero: {
      eyebrow: "Lab 模組",
      title: "互動實驗室：資料即時可視化",
      description:
        "Lab 模組會展示圖表、動態焦點卡與 Workers side project，為下一波文章鋪路。",
      background: "linear-gradient(120deg, #eef7ff 0%, #e4fffb 65%, #f7f0ff 100%)",
      borderColor: "rgba(148, 197, 219, 0.7)",
      metrics: [
        { label: "Prototype", value: "04", hint: "進行中" },
        { label: "Live Demo", value: "02", hint: "Charts" },
        { label: "Stack", value: "Canvas", hint: "Edge data" },
      ],
      preview: [
        {
          category: "動態",
          title: "焦點圖層",
          detail: "使用 requestAnimationFrame 做滾動感應與暈光。",
        },
        {
          category: "資料",
          title: "Workers Streaming",
          detail: "即時拉取分析資料並渲染圖表。",
        },
      ],
      ctaLabel: "前往實驗室",
    },
    section: {
      eyebrow: "Lab",
      title: "互動實驗",
      intro: "邊緣上的資料視覺化與互動效果都會先在 Lab 試驗，穩定後再搬進正式頁。",
      tint: "#E9F5FF",
      experiments: [
        {
          title: "動態焦點圖",
          description: "以 IntersectionObserver 驅動的 spotlight，會根據滑鼠與捲動做光暈。",
          status: "進行中",
          stack: ["Canvas", "IO", "Token"],
        },
        {
          title: "Live Metrics",
          description: "串流 Workers logpush，將請求量 / 錯誤率轉成即時折線圖。",
          status: "Prototype",
          stack: ["Logpush", "Chart", "Workers"],
        },
        {
          title: "色彩混合器",
          description: "測試色票混合演算法，讓模塊背景在暗色系也能保持層次。",
          status: "概念",
          stack: ["Color", "Shader"],
        },
      ],
    },
  },
} as const;

type SectionKey = keyof typeof SECTION_DATA;
const SECTION_KEYS: SectionKey[] = ["blog", "guestbook", "changelog", "lab"];

const TAG_LABELS = { add: "新增", fix: "修正", change: "變更", docs: "文件" } as const;

function TagBadge({ tag }: { tag?: ChangelogItem["tag"] }) {
  if (!tag) return null;
  return <span className="chip">{TAG_LABELS[tag]}</span>;
}

function formatDate(date: string) {
  try {
    return new Intl.DateTimeFormat("zh-Hant", {
      year: "numeric",
      month: "short",
      day: "numeric",
    }).format(new Date(date));
  } catch {
    return date;
  }
}

function renderSectionBody(
  sectionKey: SectionKey,
  options: { changelogItems: ChangelogItem[]; blogPosts: BlogPost[]; blogCategories: BlogCategory[] },
) {
  switch (sectionKey) {
    case "blog": {
      const posts = options.blogPosts.slice(0, 3);
      const categories = options.blogCategories;
      const categoryLabel = (post: BlogPost) => {
        const cat = categories.find((c) => c.id === post.categoryId);
        if (!cat) return "";
        const sub = cat.children.find((child) => child.id === post.subcategoryId);
        return sub ? `${cat.title} · ${sub.title}` : cat.title;
      };

      if (!posts.length) {
        return <p className="text-sm text-neutral-600">目前還沒有文章，從後台新增第一篇吧。</p>;
      }

      const excerpt = (body: string) => {
        const firstParagraph = body.split(/\n+/).map((line) => line.trim()).filter(Boolean)[0];
        if (!firstParagraph) return body.slice(0, 120);
        return firstParagraph.length > 180 ? `${firstParagraph.slice(0, 177)}…` : firstParagraph;
      };

      return (
        <div className="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
          {posts.map((post) => (
            <article
              key={(post.filename ?? post.slug ?? post.title) + post.publishedAt}
              className="card hover-raise h-full bg-white/90 flex flex-col"
            >
              <p className="text-xs uppercase tracking-[0.25em] text-neutral-500">
                {formatDate(post.publishedAt)}
              </p>
              <h3 className="mt-3 text-lg font-semibold text-neutral-900">{post.title}</h3>
              {categoryLabel(post) ? (
                <p className="text-xs text-neutral-500 mt-1">{categoryLabel(post)}</p>
              ) : null}
              <p className="mt-3 text-sm text-neutral-700 leading-relaxed flex-1">{excerpt(post.body)}</p>
              <div className="flex items-center justify-between pt-4 text-sm text-[--color-accent-600]">
                <span className="font-medium">純文字筆記</span>
                <a href="/blog" className="link-soft">
                  查看全部
                </a>
              </div>
            </article>
          ))}
        </div>
      );
    }
    case "guestbook": {
      const { messages } = SECTION_DATA.guestbook.section;
      return (
        <div className="grid gap-4 md:grid-cols-2">
          {messages.map((msg) => (
            <article
              key={msg.name}
              className="rounded-2xl border border-white/70 bg-white/85 p-5 shadow-sm"
            >
              <div className="flex items-center justify-between gap-3">
                <div>
                  <p className="font-semibold text-neutral-900">{msg.name}</p>
                  <p className="text-xs uppercase tracking-[0.25em] text-neutral-500">
                    {msg.role}
                  </p>
                </div>
                <span className="text-xs rounded-full bg-[color:rgba(255,255,255,0.7)] px-3 py-1 text-neutral-600 border border-white/60">
                  {msg.time}
                </span>
              </div>
              <p className="mt-3 text-sm text-neutral-800 leading-relaxed">{msg.message}</p>
              <p className="mt-3 text-xs uppercase tracking-[0.2em] text-[--color-accent-500]">
                {msg.mood}
              </p>
            </article>
          ))}
        </div>
      );
    }
    case "changelog": {
      const timeline = options.changelogItems;
      return (
        <div className="space-y-5">
          {timeline.length ? (
            timeline.map((log, index) => (
              <article
                key={(log.filename ?? log.date) + index}
                className="rounded-2xl border border-white/70 bg-white/85 p-5 shadow-sm"
              >
                <div className="flex flex-wrap items-center gap-3 text-sm text-neutral-600">
                  <time dateTime={log.date} className="font-semibold text-neutral-900">
                    {log.date}
                  </time>
                  <TagBadge tag={log.tag} />
                </div>
                <h3 className="mt-2 text-lg font-semibold text-neutral-900">{log.title}</h3>
                {log.notes?.length ? (
                  <ul className="mt-2 list-disc pl-5 text-sm text-neutral-700 space-y-1">
                    {log.notes.map((note, i) => (
                      <li key={i}>{note}</li>
                    ))}
                  </ul>
                ) : null}
              </article>
            ))
          ) : (
            <p className="text-sm text-neutral-500">目前沒有更新日誌，稍後再回來看看。</p>
          )}
        </div>
      );
    }
    case "lab": {
      const { experiments } = SECTION_DATA.lab.section;
      return (
        <div className="grid gap-5 md:grid-cols-2">
          {experiments.map((exp) => (
            <article
              key={exp.title}
              className="card hover-raise h-full bg-white/90 flex flex-col"
            >
              <div className="flex items-center justify-between gap-3">
                <h3 className="text-lg font-semibold text-neutral-900">{exp.title}</h3>
                <span className="text-xs rounded-full bg-[color:rgba(236,248,255,0.9)] px-3 py-1 text-neutral-600 border border-white/60">
                  {exp.status}
                </span>
              </div>
              <p className="mt-3 text-sm text-neutral-700 leading-relaxed flex-1">{exp.description}</p>
              <div className="flex flex-wrap gap-2 mt-4">
                {exp.stack.map((tag) => (
                  <span key={tag} className="chip">
                    {tag}
                  </span>
                ))}
              </div>
            </article>
          ))}
        </div>
      );
    }
    default:
      return null;
  }
}

type ModuleButtonsProps = {
  activeSection: SectionKey;
  onHover: (section: SectionKey) => void;
  onSelect: (section: SectionKey) => void;
  className?: string;
};

export async function loader(args: LoaderFunctionArgs) {
  const [changelog, blogCategories] = await Promise.all([
    loadChangelogItems(args),
    loadBlogCategories(),
  ]);
  const db = requireBlogDb(args.context);
  const blogPosts: BlogPost[] = await getAllBlogPosts(db);
  return { changelog, blogPosts, blogCategories };
}

type LoaderData = Awaited<ReturnType<typeof loader>>;

function ModuleButtons({ activeSection, onHover, onSelect, className }: ModuleButtonsProps) {
  return (
    <div className={`flex flex-wrap gap-2 ${className ?? ""}`}>
      {SECTION_KEYS.map((section) => {
        const isActive = activeSection === section;
        return (
          <button
            key={section}
            type="button"
            onMouseEnter={() => onHover(section)}
            onFocus={() => onHover(section)}
            onClick={() => onSelect(section)}
            aria-pressed={isActive}
            className={`rounded-2xl border px-4 py-3 text-sm font-semibold transition focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[--color-accent-300]
            ${
              isActive
                ? "bg-neutral-900 text-white border-neutral-900 shadow-lg"
                : "bg-white/75 text-neutral-600 border-white/60 hover:text-neutral-900"
            }`}
          >
            {SECTION_DATA[section].label}
          </button>
        );
      })}
    </div>
  );
}

export default function HomePage() {
  const [activeSection, setActiveSection] = useState<SectionKey>("blog");
  const { changelog, blogPosts, blogCategories } = useLoaderData() as LoaderData;
  const changelogItems = changelog.slice(0, 4);
  const heroModule = SECTION_DATA[activeSection].hero;

  const scrollToSection = (section: SectionKey) => {
    if (typeof document === "undefined") return;
    const target = document.getElementById(section);
    target?.scrollIntoView({ behavior: "smooth", block: "start" });
  };

  const handleHover = (section: SectionKey) => {
    if (section !== activeSection) {
      setActiveSection(section);
    }
  };

  const handleSelect = (section: SectionKey) => {
    setActiveSection(section);
    scrollToSection(section);
  };

  return (
    <div className="mx-auto max-w-6xl px-4">
      <div className="pt-16 pb-6 space-y-3">
        <p className="eyebrow text-neutral-600">模組切換</p>
        <ModuleButtons
          activeSection={activeSection}
          onHover={handleHover}
          onSelect={handleSelect}
        />
      </div>

      <section className="section pt-0">
        <div
          className="module-panel module-hero space-y-8"
          style={{ background: heroModule.background, borderColor: heroModule.borderColor }}
        >
          <div className="space-y-8">
            <div className="space-y-4 max-w-3xl">
              <p className="eyebrow">{heroModule.eyebrow}</p>
              <h1 className="text-3xl md:text-5xl font-bold leading-tight text-neutral-900">
                {heroModule.title}
              </h1>
              <p className="text-lg text-neutral-800/90 leading-relaxed">
                {heroModule.description}
              </p>
            </div>
            <div className="grid gap-6 md:grid-cols-[1.1fr_0.9fr]">
              <div className="space-y-6">
                <div className="grid grid-cols-2 sm:grid-cols-3 gap-4">
                  {heroModule.metrics.map((metric) => (
                    <div
                      key={metric.label}
                      className="rounded-2xl border border-white/60 bg-white/80 px-5 py-4 shadow-sm"
                    >
                      <p className="text-xs uppercase tracking-[0.25em] text-neutral-500">
                        {metric.label}
                      </p>
                      <p className="text-2xl font-semibold text-neutral-900 mt-1">{metric.value}</p>
                      <p className="text-xs text-neutral-600">{metric.hint}</p>
                    </div>
                  ))}
                </div>
                <div className="flex flex-wrap gap-3">
                  <button type="button" className="btn-primary" onClick={() => handleSelect(activeSection)}>
                    {heroModule.ctaLabel}
                  </button>
                  <a href="#lab" className="btn-ghost">
                    看互動實驗
                  </a>
                </div>
              </div>
              <div className="grid gap-4 sm:grid-cols-2">
                {heroModule.preview.map((item) => (
                  <article key={item.title} className="card bg-white/85">
                    <p className="text-xs uppercase tracking-[0.25em] text-neutral-500">
                      {item.category}
                    </p>
                    <h3 className="mt-2 text-lg font-semibold text-neutral-900">
                      {item.title}
                    </h3>
                    <p className="mt-2 text-sm text-neutral-700 leading-relaxed">{item.detail}</p>
                  </article>
                ))}
              </div>
            </div>
          </div>
        </div>
      </section>

      {SECTION_KEYS.map((sectionKey) => {
        const section = SECTION_DATA[sectionKey].section;
        return (
          <section key={sectionKey} id={sectionKey} className="section">
            <div className="module-panel" style={{ "--module-color": section.tint } as CSSProperties}>
              <div className="space-y-6">
                <div className="space-y-2">
                  <p className="eyebrow">{section.eyebrow}</p>
                  <h2 className="section-title">{section.title}</h2>
                </div>
                <p className="text-lg text-neutral-700 leading-relaxed max-w-3xl">
                  {section.intro}
                </p>
                {renderSectionBody(sectionKey, { changelogItems, blogPosts, blogCategories })}
              </div>
            </div>
          </section>
        );
      })}
    </div>
  );
}

```

---
### app\routes\about.tsx
```tsx
// app/routes/about.tsx
// app/routes/about.tsx
export default function AboutPage() {
  return (
    <main className="max-w-3xl mx-auto px-4 py-12 leading-relaxed">
      <h1 className="text-3xl font-bold mb-6">關於這個專案</h1>

      <p className="mb-4">
        這是一個以 React Router Framework 為基礎、部署在 Cloudflare Workers 上的部落格專案。
        主要目標是從零開始，透過實作學習現代前端架構，並體驗「前後端在同一份程式碼中」的開發模式。
      </p>

      <p className="mb-4">
        網站的資料來源使用 Notion 作為 CMS，留言資料存放於 Cloudflare D1。
        所有頁面都由 Workers 在邊緣節點進行伺服端渲染（SSR），使內容能快速且安全地傳遞到世界各地的使用者。
      </p>

      <h2 className="text-2xl font-semibold mt-8 mb-3">主要功能規劃</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>首頁與關於頁</li>
        <li>部落格列表與文章頁</li>
        <li>留言板（D1 資料庫）</li>
        <li>RSS Feed</li>
        <li>互動圖表頁（未來示範資料視覺化）</li>
        <li>密碼保護頁（中介層驗證）</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">目前進度</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>已完成：基本架構、首頁、關於頁、部落格假資料、樣式設定</li>
        <li>進行中：Notion API 串接與留言板互動</li>
        <li>待完成：RSS、D1 實作、密碼頁、圖表</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">技術架構</h2>
      <ul className="list-disc pl-6 space-y-1">
        <li>React Router v7（檔案式路由、loader/action）</li>
        <li>Cloudflare Workers（邊緣運算與伺服端渲染）</li>
        <li>Cloudflare D1（留言資料庫）</li>
        <li>Notion API（文章內容來源）</li>
        <li>Tailwind CSS（樣式）</li>
        <li>TypeScript + Vite（開發環境）</li>
      </ul>

      <h2 className="text-2xl font-semibold mt-8 mb-3">開發理念</h2>
      <p className="mb-4">
        專案採取「邊學邊做」的方式推進。每一週聚焦於不同面向：第一週完成網站骨架，
        第二週整合外部資料與互動功能，第三週優化效能與擴充應用。
      </p>

      <p className="mb-4">
        最終希望這個網站不只是作品展示，也是一份可持續擴充的個人開發框架，
        未來能作為更多 Cloudflare Edge App 的基礎。
      </p>

      <footer className="mt-12 text-sm text-gray-500">
        © {new Date().getFullYear()} 個人專案開發筆記
      </footer>
    </main>
  );
}

```

---
### app\routes\admin.blog-edit.tsx
```tsx
import { useEffect, useMemo, useState } from "react";
import { useLoaderData, json } from "react-router";
import type { LoaderFunctionArgs } from "react-router";
import { loadBlogCategories } from "../lib/blog.server";
import type { BlogCategory, BlogPost } from "../lib/blog.types";
import { requireAdmin } from "../lib/admin-auth.server";

type LoaderData = Awaited<ReturnType<typeof loader>>;

export async function loader({ request, context }: LoaderFunctionArgs) {
  requireAdmin(request, context);
  const url = new URL(request.url);
  const slug = url.searchParams.get("slug") ?? "";
  const categories = await loadBlogCategories();
  return json({ slug, categories });
}

type FormState = {
  slug: string;
  title: string;
  summary: string;
  body: string;
  tagsInput: string;
  categoryId: string;
  subcategoryId: string;
  publishedAtInput: string;
  updatedAtBase: string;
  isExisting: boolean;
};

function defaultFormState(initialSlug: string): FormState {
  return {
    slug: initialSlug,
    title: "",
    summary: "",
    body: "",
    tagsInput: "",
    categoryId: "",
    subcategoryId: "",
    publishedAtInput: formatDatetimeLocal(new Date().toISOString()),
    updatedAtBase: "",
    isExisting: false,
  };
}

function formatDatetimeLocal(iso?: string | null) {
  if (!iso) return "";
  const date = new Date(iso);
  if (Number.isNaN(date.valueOf())) return "";
  const pad = (value: number) => value.toString().padStart(2, "0");
  return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(
    date.getHours(),
  )}:${pad(date.getMinutes())}`;
}

function parseTags(input: string) {
  return input
    .split(",")
    .map((tag) => tag.trim())
    .filter(Boolean);
}

export default function AdminBlogEditPage() {
  const { slug: initialSlug, categories } = useLoaderData() as LoaderData;
  const [formState, setFormState] = useState<FormState>(() => defaultFormState(initialSlug));
  const [isFetching, setIsFetching] = useState(false);
  const [isSaving, setIsSaving] = useState(false);
  const [message, setMessage] = useState<string | null>(null);
  const [error, setError] = useState<string | null>(null);

  const availableSubcategories = useMemo(() => {
    return categories.find((cat) => cat.id === formState.categoryId)?.children ?? [];
  }, [categories, formState.categoryId]);

  useEffect(() => {
    if (initialSlug) {
      void fetchPost(initialSlug);
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [initialSlug]);

  async function fetchPost(slug: string) {
    if (!slug) return;
    setIsFetching(true);
    setMessage(null);
    setError(null);
    try {
      const res = await fetch(`/api/blog-post?slug=${encodeURIComponent(slug)}`);
      if (!res.ok) {
        throw new Error(await res.text());
      }
      const post = (await res.json()) as BlogPost;
      setFormState((prev) => ({
        ...prev,
        slug: post.slug ?? slug,
        title: post.title ?? "",
        summary: post.summary ?? "",
        body: post.body ?? "",
        tagsInput: Array.isArray(post.tags) ? post.tags.join(", ") : "",
        categoryId: post.categoryId ?? "",
        subcategoryId: post.subcategoryId ?? "",
        publishedAtInput: formatDatetimeLocal(post.publishedAt),
        updatedAtBase: post.updatedAt ?? "",
        isExisting: true,
      }));
      setMessage("已載入最新內容");
    } catch (err: any) {
      setError(err.message || "載入文章失敗");
    } finally {
      setIsFetching(false);
    }
  }

  async function handleSave() {
    if (!formState.title || !formState.body) {
      setError("請至少填寫標題與內容");
      return;
    }
    if (formState.isExisting && !formState.slug) {
      setError("無法更新：缺少 slug");
      return;
    }

    setIsSaving(true);
    setError(null);
    setMessage(null);

    const payload: any = {
      title: formState.title,
      summary: formState.summary,
      body: formState.body,
      tags: parseTags(formState.tagsInput),
      categoryId: formState.categoryId || undefined,
      subcategoryId: formState.subcategoryId || undefined,
      publishedAt: formState.publishedAtInput ? new Date(formState.publishedAtInput).toISOString() : undefined,
    };

    let endpoint = "/api/blog-post";
    let method: "POST" | "PUT" = "POST";

    if (formState.isExisting) {
      method = "PUT";
      endpoint = `/api/blog-post?slug=${encodeURIComponent(formState.slug)}`;
      payload.updatedAtBase = formState.updatedAtBase;
    } else if (formState.slug) {
      payload.slug = formState.slug;
    }

    try {
      const res = await fetch(endpoint, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      if (res.status === 409) {
        setError("文章已在別處被更新或 slug 重複，請重新載入。");
        if (formState.slug) {
          await fetchPost(formState.slug);
        }
        return;
      }
      if (!res.ok) {
        throw new Error(await res.text());
      }

      const data = await res.json();
      if (method === "POST") {
        const nextSlug = data.slug as string;
        await fetchPost(nextSlug);
        setMessage("已建立文章");
      } else {
        const refreshed = data.post as any;
        setFormState((prev) => ({
          ...prev,
          updatedAtBase: refreshed?.updatedAt ?? prev.updatedAtBase,
        }));
        setMessage("已儲存最新內容");
      }
    } catch (err: any) {
      setError(err.message || "儲存失敗");
    } finally {
      setIsSaving(false);
    }
  }

  function handleInputChange<T extends keyof FormState>(key: T, value: FormState[T]) {
    setFormState((prev) => ({ ...prev, [key]: value }));
  }

  function handleCategoryChange(value: string) {
    setFormState((prev) => {
      const category = categories.find((cat) => cat.id === value);
      const subIsValid = category?.children.some((child) => child.id === prev.subcategoryId);
      return {
        ...prev,
        categoryId: value,
        subcategoryId: subIsValid ? prev.subcategoryId : "",
      };
    });
  }

  return (
    <div className="mx-auto max-w-3xl px-4 py-10 space-y-6">
      <header className="space-y-2">
        <p className="eyebrow text-neutral-500">Blog 編輯介面</p>
        <h1 className="text-3xl font-bold text-neutral-900">雲端文章管理</h1>
        <p className="text-sm text-neutral-600">
          透過 Cloudflare D1 直接讀寫文章，更新後網站即時同步，不需重新部署。
        </p>
      </header>

      <div className="space-y-4 rounded-2xl border border-neutral-200 bg-white/90 p-6 shadow-sm">
        <div className="grid gap-4 md:grid-cols-[1fr_auto]">
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            Slug
            <input
              type="text"
              value={formState.slug}
              onChange={(e) => handleInputChange("slug", e.target.value)}
              className="input"
              placeholder="color-palette"
              disabled={formState.isExisting}
            />
          </label>
          <button
            type="button"
            className="btn-ghost h-fit self-end"
            onClick={() => fetchPost(formState.slug)}
            disabled={!formState.slug || isFetching}
          >
            {isFetching ? "載入中..." : "重新載入"}
          </button>
        </div>

        <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
          標題
          <input
            type="text"
            value={formState.title}
            onChange={(e) => handleInputChange("title", e.target.value)}
            className="input"
            placeholder="Workers + React Router 的實測"
          />
        </label>

        <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
          摘要
          <textarea
            value={formState.summary}
            onChange={(e) => handleInputChange("summary", e.target.value)}
            className="textarea"
            rows={3}
            placeholder="文章簡短說明，會用於列表與 meta。"
          />
        </label>

        <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
          內文
          <textarea
            value={formState.body}
            onChange={(e) => handleInputChange("body", e.target.value)}
            className="textarea"
            rows={10}
            placeholder="這裡貼上 Markdown 或純文字內容"
          />
        </label>

        <div className="grid gap-4 md:grid-cols-2">
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            標籤（逗號分隔）
            <input
              type="text"
              value={formState.tagsInput}
              onChange={(e) => handleInputChange("tagsInput", e.target.value)}
              className="input"
              placeholder="Workers, React Router, D1"
            />
          </label>
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            發佈時間
            <input
              type="datetime-local"
              value={formState.publishedAtInput}
              onChange={(e) => handleInputChange("publishedAtInput", e.target.value)}
              className="input"
            />
          </label>
        </div>

        <div className="grid gap-4 md:grid-cols-2">
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            分類
            <select
              className="input"
              value={formState.categoryId}
              onChange={(e) => handleCategoryChange(e.target.value)}
            >
              <option value="">選擇分類</option>
              {categories.map((category) => (
                <option key={category.id} value={category.id}>
                  {category.title}
                </option>
              ))}
            </select>
          </label>
          <label className="flex flex-col gap-2 text-sm font-medium text-neutral-700">
            子分類
            <select
              className="input"
              value={formState.subcategoryId}
              onChange={(e) => handleInputChange("subcategoryId", e.target.value)}
              disabled={!availableSubcategories.length}
            >
              <option value="">選擇子分類</option>
              {availableSubcategories.map((subcategory) => (
                <option key={subcategory.id} value={subcategory.id}>
                  {subcategory.title}
                </option>
              ))}
            </select>
          </label>
        </div>

        <div className="flex flex-wrap items-center gap-3">
          <button
            type="button"
            className="btn-primary"
            onClick={handleSave}
            disabled={isSaving || isFetching}
          >
            {isSaving ? "儲存中..." : "儲存文章"}
          </button>
          {message ? <p className="text-sm text-green-600">{message}</p> : null}
          {error ? <p className="text-sm text-red-600">{error}</p> : null}
        </div>
      </div>
    </div>
  );
}

```

---
### app\routes\admin.login.tsx
```tsx
import { Form, useActionData } from "react-router";
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

import {
  createAdminSessionCookie,
  getAdminPassword,
  isAdmin,
} from "../lib/admin-auth.server";

export async function loader({ request }: LoaderFunctionArgs) {
  if (isAdmin(request)) {
    const url = new URL("/admin", request.url);
    return new Response(null, {
      status: 302,
      headers: { Location: url.toString() },
    });
  }
  return {}; // noop, renders form
}

export async function action({ request, context }: ActionFunctionArgs) {
  const formData = await request.formData();
  const password = (formData.get("password") ?? "").toString();
  const expected = getAdminPassword(context);

  if (!expected) {
    return { error: "未設定管理密碼 (ADMIN_PASS)" };
  }

  if (password !== expected) {
    return { error: "密碼錯誤" };
  }

  const url = new URL("/admin", request.url);
  return new Response(null, {
    status: 302,
    headers: {
      Location: url.toString(),
      "Set-Cookie": createAdminSessionCookie(),
    },
  });
}

export default function AdminLoginPage() {
  const actionData = useActionData<typeof action>();

  return (
    <div className="min-h-screen flex items-center justify-center bg-[--color-warm-50] px-4 py-12">
      <div className="w-full max-w-sm rounded-2xl border border-neutral-200 bg-white/90 p-6 shadow-lg space-y-4">
        <div className="space-y-1">
          <p className="eyebrow text-neutral-500">Admin</p>
          <h1 className="text-2xl font-semibold text-neutral-900">登入管理後台</h1>
          <p className="text-sm text-neutral-600">請輸入管理密碼繼續。</p>
        </div>

        <Form method="post" className="space-y-3">
          <input
            type="password"
            name="password"
            placeholder="Password"
            autoFocus
            required
            className="input"
          />
          {actionData && "error" in actionData ? (
            <p className="text-sm text-red-600">{(actionData as any).error}</p>
          ) : null}
          <button type="submit" className="btn-primary w-full">
            登入
          </button>
        </Form>
      </div>
    </div>
  );
}

```

---
### app\routes\admin.tsx
```tsx
import { useMemo, useState } from "react";
import { Form, Link, useLoaderData, useNavigation } from "react-router";
import type { ActionFunctionArgs, LoaderFunctionArgs } from "react-router";

import { requireAdmin } from "../lib/admin-auth.server";
import { requireBlogDb } from "../lib/d1.server";
import { getAllBlogPosts } from "../lib/blog.d1.server";
import type { BlogCategory, BlogPost } from "../lib/blog.types";
import { loadBlogCategories } from "../lib/blog.server";

type LoaderData = {
  posts: BlogPost[];
  categories: BlogCategory[];
  tags: string[];
};

type FormState = {
  slug: string;
  title: string;
  summary: string;
  body: string;
  publishedAt: string;
  tagsInput: string;
  categoryId: string;
  subcategoryId: string;
};

function deriveSummary(body: string) {
  const firstParagraph =
    body
      ?.split(/\n+/)
      .map((line) => line.trim())
      .filter(Boolean)[0] ?? "";
  if (!firstParagraph) return "";
  return firstParagraph.length > 200 ? `${firstParagraph.slice(0, 197)}…` : firstParagraph;
}

export async function loader({ request, context }: LoaderFunctionArgs) {
  requireAdmin(request, context);
  const db = requireBlogDb(context);
  const posts = await getAllBlogPosts(db);
  const categories = await loadBlogCategories();
  const tagSet = new Set<string>();
  for (const post of posts) {
    if (Array.isArray(post.tags)) {
      for (const tag of post.tags) {
        const value = (tag ?? "").toString().trim();
        if (value) tagSet.add(value);
      }
    }
  }
  const tags = Array.from(tagSet).sort((a, b) => a.localeCompare(b, "zh-Hant"));
  return { posts, categories, tags };
}

export async function action({ request, context }: ActionFunctionArgs) {
  requireAdmin(request, context);
  const formData = await request.formData();
  const intent = (formData.get("intent") ?? "").toString();
  const db = requireBlogDb(context);

  if (intent === "delete") {
    const slug = (formData.get("slug") ?? "").toString().trim();
    if (!slug) return { error: "slug 必填" };
    await db.prepare("DELETE FROM blog_posts WHERE slug = ?").bind(slug).run();
    const url = new URL("/admin", request.url);
    return new Response(null, {
      status: 302,
      headers: { Location: url.toString() },
    });
  }

  if (intent === "upsert") {
    const slug = (formData.get("slug") ?? "").toString().trim();
    const title = (formData.get("title") ?? "").toString().trim();
    const body = (formData.get("body") ?? "").toString();
    const publishedAt = (formData.get("publishedAt") ?? "").toString().trim();
    const summaryInput = (formData.get("summary") ?? "").toString().trim();
    const tagsInput = (formData.get("tags") ?? "").toString().trim();
    const selectedTags = formData
      .getAll("tag")
      .map((t) => t.toString().trim())
      .filter(Boolean);
    const categoryId = (formData.get("categoryId") ?? "").toString().trim() || null;
    const subcategoryId = (formData.get("subcategoryId") ?? "").toString().trim() || null;

    if (!slug || !title || !body) {
      return { error: "slug、title、body 必填" };
    }
    const now = new Date().toISOString();
    const summary = summaryInput || deriveSummary(body);
    const tagSet = new Set<string>();
    for (const tag of selectedTags) {
      tagSet.add(tag);
    }
    if (tagsInput) {
      for (const raw of tagsInput.split(",")) {
        const value = raw.trim();
        if (value) tagSet.add(value);
      }
    }
    const tags = Array.from(tagSet);
    const pub = publishedAt || now;

    await db
      .prepare(
        `INSERT INTO blog_posts (slug, title, summary, body, tags, category_id, subcategory_id, published_at, created_at, updated_at)
         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
         ON CONFLICT(slug) DO UPDATE SET
           title = excluded.title,
           summary = excluded.summary,
           body = excluded.body,
           tags = excluded.tags,
           category_id = excluded.category_id,
           subcategory_id = excluded.subcategory_id,
           published_at = excluded.published_at,
           updated_at = excluded.updated_at`,
      )
      .bind(
        slug,
        title,
        summary,
        body,
        JSON.stringify(tags),
        categoryId,
        subcategoryId,
        pub,
        now,
        now,
      )
      .run();

    const url = new URL("/admin", request.url);
    return new Response(null, {
      status: 302,
      headers: { Location: url.toString() },
    });
  }

  return { error: "未知 intent" };
}

function formatDate(date: string) {
  try {
    return new Intl.DateTimeFormat("zh-Hant", { dateStyle: "medium", timeStyle: "short" }).format(
      new Date(date),
    );
  } catch {
    return date;
  }
}

export default function AdminPage() {
  const { posts, categories, tags } = useLoaderData<typeof loader>() as LoaderData;
  const navigation = useNavigation();

  const isSubmitting = navigation.state === "submitting";

  const [formState, setFormState] = useState<FormState>(() => ({
    slug: "",
    title: "",
    summary: "",
    body: "",
    publishedAt: "",
    tagsInput: "",
    categoryId: "",
    subcategoryId: "",
  }));

  function handleFormChange<K extends keyof FormState>(key: K, value: FormState[K]) {
    setFormState((prev) => ({ ...prev, [key]: value }));
  }

  function resetForm() {
    setFormState({
      slug: "",
      title: "",
      summary: "",
      body: "",
      publishedAt: "",
      tagsInput: "",
      categoryId: "",
      subcategoryId: "",
    });
  }

  function handleLoadPost(post: BlogPost) {
    setFormState({
      slug: post.slug ?? "",
      title: post.title ?? "",
      summary: post.summary ?? "",
      body: post.body ?? "",
      publishedAt: post.publishedAt ?? "",
      tagsInput: Array.isArray(post.tags) ? post.tags.join(", ") : "",
      categoryId: (post.categoryId ?? "") || "",
      subcategoryId: (post.subcategoryId ?? "") || "",
    });
  }

  const availableSubcategories = useMemo(() => {
    const category = categories.find((cat) => cat.id === formState.categoryId);
    return category?.children ?? [];
  }, [categories, formState.categoryId]);

  return (
    <div className="mx-auto max-w-5xl px-4 py-10 space-y-8">
      <header className="flex items-center justify-between gap-4">
        <div>
          <p className="eyebrow text-neutral-500">Admin</p>
          <h1 className="text-3xl font-bold text-neutral-900">Blog 管理</h1>
          <p className="text-sm text-neutral-600">新增 / 更新 / 刪除部落格文章，直接寫入 D1。</p>
        </div>
        <Link to="/" className="btn-ghost">
          返回前台
        </Link>
      </header>

      <section className="grid gap-6 lg:grid-cols-[1.4fr_1fr]">
        <div className="card bg-white/95 space-y-4">
          <div>
            <p className="font-semibold text-neutral-900">新增或更新</p>
            <p className="text-xs text-neutral-500">同 slug 會覆蓋內容，空白欄位會沿用保存的值。</p>
          </div>
          <Form method="post" className="space-y-3">
            <input type="hidden" name="intent" value="upsert" />
            <div className="grid gap-3 md:grid-cols-2">
              <input
                name="slug"
                placeholder="slug (唯一)"
                required
                className="input"
                value={formState.slug}
                onChange={(e) => handleFormChange("slug", e.target.value)}
              />
              <input
                name="title"
                placeholder="標題"
                required
                className="input"
                value={formState.title}
                onChange={(e) => handleFormChange("title", e.target.value)}
              />
            </div>
            <div className="grid gap-3 md:grid-cols-2">
              <input
                name="publishedAt"
                placeholder="發布時間 ISO，可留空"
                className="input"
                value={formState.publishedAt}
                onChange={(e) => handleFormChange("publishedAt", e.target.value)}
              />
              <input
                name="summary"
                placeholder="摘要，可留空自動取第一段"
                className="input"
                value={formState.summary}
                onChange={(e) => handleFormChange("summary", e.target.value)}
              />
            </div>
            <div className="grid gap-3 md:grid-cols-2">
              <select
                name="categoryId"
                className="input"
                value={formState.categoryId}
                onChange={(e) => {
                  handleFormChange("categoryId", e.target.value);
                  handleFormChange("subcategoryId", "");
                }}
              >
                <option value="">未分類</option>
                {categories.map((category) => (
                  <option key={category.id} value={category.id}>
                    {category.title}
                  </option>
                ))}
              </select>
              <select
                name="subcategoryId"
                className="input"
                value={formState.subcategoryId}
                onChange={(e) => handleFormChange("subcategoryId", e.target.value)}
                disabled={!availableSubcategories.length}
              >
                <option value="">未分類</option>
                {availableSubcategories.map((subcategory) => (
                  <option key={subcategory.id} value={subcategory.id}>
                    {subcategory.title}
                  </option>
                ))}
              </select>
            </div>
            <div className="space-y-2">
              <input
                name="tags"
                placeholder="自訂標籤，以逗號分隔，可留空"
                className="input"
                value={formState.tagsInput}
                onChange={(e) => handleFormChange("tagsInput", e.target.value)}
              />
              {tags.length ? (
                <div className="space-y-1">
                  <p className="text-xs font-medium text-neutral-700">從現有標籤選擇：</p>
                  <div className="flex flex-wrap gap-2">
                    {tags.map((tag) => (
                      <label
                        key={tag}
                        className="inline-flex items-center gap-1 rounded-full border border-neutral-200 bg-neutral-50 px-2 py-1 text-xs text-neutral-700"
                      >
                        <input type="checkbox" name="tag" value={tag} className="h-3 w-3" />
                        <span>{tag}</span>
                      </label>
                    ))}
                  </div>
                </div>
              ) : null}
            </div>
            <textarea
              name="body"
              placeholder="文章內容（支援純文字換行）"
              rows={10}
              required
              className="input"
              value={formState.body}
              onChange={(e) => handleFormChange("body", e.target.value)}
            />
            <div className="flex flex-wrap items-center gap-3">
              <button type="submit" className="btn-primary" disabled={isSubmitting}>
                {isSubmitting ? "送出中..." : "儲存 / 更新"}
              </button>
              <button type="button" className="btn-ghost text-sm" onClick={resetForm}>
                清空表單（新增新文章）
              </button>
            </div>
          </Form>
        </div>

        <div className="card bg-white/95 space-y-4">
          <div>
            <p className="font-semibold text-neutral-900">現有文章</p>
            <p className="text-xs text-neutral-500">點擊載入可帶入表單，刪除會立即移除。</p>
          </div>
          <div className="space-y-3 max-h-[600px] overflow-auto">
            {posts.length === 0 ? (
              <p className="text-sm text-neutral-600">目前沒有文章。</p>
            ) : (
              posts.map((post) => (
                <div
                  key={post.slug + post.publishedAt}
                  className="flex items-start justify-between gap-3 rounded-xl border border-neutral-200/80 bg-white/80 px-4 py-3"
                >
                  <div className="space-y-1">
                    <p className="text-sm font-semibold text-neutral-900">{post.title}</p>
                    <p className="text-xs text-neutral-500">{post.slug}</p>
                    <p className="text-xs text-neutral-500">{formatDate(post.updatedAt ?? post.createdAt)}</p>
                  </div>
                  <div className="flex flex-col items-end gap-2">
                    <button
                      type="button"
                      className="text-xs text-blue-600 hover:underline"
                      onClick={() => handleLoadPost(post)}
                    >
                      載入到表單
                    </button>
                    <Form
                      method="post"
                      onSubmit={(e) => {
                        if (!window.confirm(`確定刪除「${post.title}」?`)) {
                          e.preventDefault();
                        }
                      }}
                    >
                      <input type="hidden" name="intent" value="delete" />
                      <input type="hidden" name="slug" value={post.slug} />
                      <button type="submit" className="text-xs text-red-600 hover:underline">
                        刪除
                      </button>
                    </Form>
                  </div>
                </div>
              ))
            )}
          </div>
        </div>
      </section>
    </div>
  );
}

```

---
### app\routes\api.blog-post.tsx
```tsx
import { json } from "react-router";
import type { LoaderFunctionArgs, ActionFunctionArgs } from "react-router";
import { requireBlogDb } from "../lib/d1.server";
import { getBlogPostBySlug } from "../lib/blog.d1.server";
import type { BlogPost } from "../lib/blog.types";
import { requireAdmin } from "../lib/admin-auth.server";

function slugify(value: string) {
  return value
    .toLowerCase()
    .trim()
    .normalize("NFKD")
    .replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9]+/g, "-")
    .replace(/^-+|-+$/g, "")
    .replace(/-{2,}/g, "-");
}

function parseTags(input: unknown) {
  if (!Array.isArray(input)) return [] as string[];
  return input.map((tag) => tag.toString()).filter(Boolean);
}

function normalizeIsoDate(value: unknown, fallback: string) {
  if (!value) return fallback;
  const parsed = new Date(value as string);
  if (Number.isNaN(parsed.valueOf())) return fallback;
  return parsed.toISOString();
}

export async function loader({ request, context }: LoaderFunctionArgs) {
  requireAdmin(request, context);
  const url = new URL(request.url);
  const slug = url.searchParams.get("slug");
  if (!slug) {
    throw json({ error: "slug is required" }, { status: 400 });
  }
  const db = requireBlogDb(context);
  const post = await getBlogPostBySlug(db, slug);
  if (!post) {
    throw json({ error: "Post not found" }, { status: 404 });
  }
  return json(post);
}

async function handlePost(request: Request, context: ActionFunctionArgs["context"]) {
  const payload = (await request.json()) as Partial<BlogPost & { categoryId?: string; subcategoryId?: string }>;
  const title = (payload.title ?? "").toString().trim();
  const body = (payload.body ?? "").toString();
  const summary = (payload.summary ?? "").toString();
  const categoryId = (payload.categoryId ?? "").toString().trim() || null;
  const subcategoryId = (payload.subcategoryId ?? "").toString().trim() || null;

  if (!title || !body) {
    throw json({ error: "title and body are required" }, { status: 400 });
  }
  const slugInput = (payload.slug ?? title).toString();
  const slug = slugify(slugInput) || slugify(`${title}-${Date.now()}`);
  const now = new Date().toISOString();
  const publishedAt = normalizeIsoDate(payload.publishedAt, now);
  const createdAt = payload.createdAt ?? now;
  const updatedAt = now;

  const db = requireBlogDb(context);
  const existing = await getBlogPostBySlug(db, slug);
  if (existing) {
    throw json({ error: "slug already exists" }, { status: 409 });
  }

  await db
    .prepare(
      `INSERT INTO blog_posts
        (slug, title, summary, body, tags, category_id, subcategory_id, published_at, created_at, updated_at)
       VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
    )
    .bind(
      slug,
      title,
      summary,
      body,
      JSON.stringify(parseTags(payload.tags)),
      categoryId,
      subcategoryId,
      publishedAt,
      createdAt,
      updatedAt,
    )
    .run();

  return json({ ok: true, slug });
}

async function handlePut(request: Request, context: ActionFunctionArgs["context"]) {
  const url = new URL(request.url);
  const slug = url.searchParams.get("slug");
  if (!slug) {
    throw json({ error: "slug is required" }, { status: 400 });
  }

  const payload = (await request.json()) as Partial<
    BlogPost & { updatedAtBase?: string; categoryId?: string; subcategoryId?: string }
  >;

  const db = requireBlogDb(context);
  const existing = await getBlogPostBySlug(db, slug);
  if (!existing) {
    throw json({ error: "Post not found" }, { status: 404 });
  }
  if (!payload.updatedAtBase) {
    throw json({ error: "updatedAtBase is required" }, { status: 400 });
  }
  if (existing.updatedAt !== payload.updatedAtBase) {
    throw json({ error: "Post was updated elsewhere" }, { status: 409 });
  }

  const title = (payload.title ?? existing.title).toString();
  const summary = (payload.summary ?? existing.summary ?? "").toString();
  const body = (payload.body ?? existing.body).toString();
  const tags = JSON.stringify(parseTags(payload.tags ?? existing.tags));
  const categoryId = (payload.categoryId ?? existing.categoryId ?? "").toString().trim() || null;
  const subcategoryId = (payload.subcategoryId ?? existing.subcategoryId ?? "").toString().trim() || null;
  const publishedAt = normalizeIsoDate(payload.publishedAt ?? existing.publishedAt, existing.publishedAt);
  const updatedAt = normalizeIsoDate(payload.updatedAt ?? new Date().toISOString(), new Date().toISOString());

  await db
    .prepare(
      `UPDATE blog_posts
       SET title = ?, summary = ?, body = ?, tags = ?, category_id = ?, subcategory_id = ?, published_at = ?, updated_at = ?
       WHERE slug = ?`,
    )
    .bind(title, summary, body, tags, categoryId, subcategoryId, publishedAt, updatedAt, slug)
    .run();

  const refreshed = await getBlogPostBySlug(db, slug);
  return json({ ok: true, post: refreshed });
}

export async function action({ request, context }: ActionFunctionArgs) {
  requireAdmin(request, context);
  switch (request.method.toUpperCase()) {
    case "POST":
      return handlePost(request, context);
    case "PUT":
      return handlePut(request, context);
    default:
      throw json({ error: "Method not allowed" }, { status: 405 });
  }
}

```

---
### app\routes\blog.tsx
```tsx
import { Link, useLoaderData } from "react-router";
import type { LoaderFunctionArgs } from "react-router";

import { loadBlogCategories } from "../lib/blog.server";
import type { BlogCategory, BlogPost } from "../lib/blog.types";
import { getAllBlogPosts } from "../lib/blog.d1.server";
import { requireBlogDb } from "../lib/d1.server";

function formatDate(date: string) {
  try {
    return new Intl.DateTimeFormat("zh-Hant", {
      year: "numeric",
      month: "short",
      day: "numeric",
    }).format(new Date(date));
  } catch {
    return date;
  }
}

function paragraphize(body: string) {
  return body
    .split(/\n+/)
    .map((line) => line.trim())
    .filter(Boolean);
}

function buildLink(categoryId?: string | null, subcategoryId?: string | null) {
  const params = new URLSearchParams();
  if (categoryId) params.set("category", categoryId);
  if (subcategoryId) params.set("subcategory", subcategoryId);
  const query = params.toString();
  return query ? `?${query}` : "";
}

export async function loader({ request, context }: LoaderFunctionArgs) {
  const url = new URL(request.url);
  const categoryId = url.searchParams.get("category");
  const subcategoryId = url.searchParams.get("subcategory");

  const categories = await loadBlogCategories();

  const db = requireBlogDb(context);
  const posts: BlogPost[] = await getAllBlogPosts(db);

  const selectedCategory = categories.find((cat) => cat.id === categoryId) ?? null;
  const selectedSubcategory = selectedCategory?.children.find((child) => child.id === subcategoryId) ?? null;

  const filteredPosts = posts.filter((post) => {
    if (selectedCategory && post.categoryId !== selectedCategory.id) return false;
    if (selectedSubcategory && post.subcategoryId !== selectedSubcategory.id) return false;
    return true;
  });

  return {
    categories,
    posts: filteredPosts,
    selectedCategoryId: selectedCategory?.id ?? null,
    selectedSubcategoryId: selectedSubcategory?.id ?? null,
  } satisfies {
    categories: BlogCategory[];
    posts: BlogPost[];
    selectedCategoryId: string | null;
    selectedSubcategoryId: string | null;
  };
}

export default function BlogPage() {
  const { categories, posts, selectedCategoryId, selectedSubcategoryId } = useLoaderData() as Awaited<
    ReturnType<typeof loader>
  >;

  return (
    <div className="mx-auto max-w-5xl px-4 py-12 space-y-12">
      <header className="space-y-4 text-center">
        <p className="eyebrow text-neutral-500">Blog</p>
        <h1 className="text-3xl md:text-4xl font-bold text-neutral-900">兩層分類的純文字筆記</h1>
        <p className="text-neutral-600 max-w-2xl mx-auto">
          從後台新增文章，這裡會根據分類即時顯示。先用文字與段落記錄想法，未來再補圖表與語法上色。
        </p>
      </header>

      <section className="grid gap-8 lg:grid-cols-[260px_1fr]">
        <aside className="space-y-4">
          <div className="card bg-white/90 p-5 space-y-4">
            <div>
              <p className="text-sm font-semibold text-neutral-800">分類</p>
              <p className="text-xs text-neutral-500">兩層架構，便於將文章歸檔。</p>
            </div>
            <div className="flex flex-wrap gap-2">
              <Link
                to={buildLink()}
                className={`chip ${!selectedCategoryId ? "bg-neutral-900 text-white" : ""}`.trim()}
              >
                全部文章
              </Link>
            </div>
            <div className="space-y-4">
              {categories.map((category) => (
                <div key={category.id} className="space-y-2">
                  <Link
                    to={buildLink(category.id)}
                    className={`flex items-center justify-between rounded-2xl border px-3 py-2 text-sm transition ${
                      selectedCategoryId === category.id
                        ? "bg-neutral-900 text-white border-neutral-900"
                        : "bg-white text-neutral-700 border-neutral-200"
                    }`}
                  >
                    <span>{category.title}</span>
                    <span className="text-xs text-neutral-500">{category.children.length} 子分類</span>
                  </Link>
                  {selectedCategoryId === category.id && category.children.length ? (
                    <div className="flex flex-wrap gap-2">
                      {category.children.map((child) => (
                        <Link
                          key={child.id}
                          to={buildLink(category.id, child.id)}
                          className={`chip ${
                            selectedSubcategoryId === child.id ? "bg-neutral-900 text-white" : ""
                          }`.trim()}
                        >
                          {child.title}
                        </Link>
                      ))}
                    </div>
                  ) : null}
                </div>
              ))}
            </div>
          </div>
        </aside>

        <div className="space-y-4">
          {posts.length ? (
            posts.map((post) => (
              <article key={(post.filename ?? post.slug ?? post.title) + post.publishedAt} className="card bg-white/95">
                <div className="text-xs uppercase tracking-[0.25em] text-neutral-500">
                  {formatDate(post.publishedAt)}
                </div>
                <h2 className="mt-2 text-2xl font-semibold text-neutral-900">{post.title}</h2>
                <div className="mt-2 text-xs text-neutral-500">
                  {(() => {
                    const category = categories.find((c) => c.id === post.categoryId);
                    const sub = category?.children.find((child) => child.id === post.subcategoryId);
                    if (category && sub) return `${category.title} / ${sub.title}`;
                    if (category) return category.title;
                    return "未分類";
                  })()}
                </div>
                <div className="mt-4 space-y-3 text-neutral-800 leading-relaxed">
                  {paragraphize(post.body).map((paragraph, index) => (
                    <p key={index}>{paragraph}</p>
                  ))}
                </div>
              </article>
            ))
          ) : (
            <p className="text-sm text-neutral-600">目前沒有符合條件的文章。</p>
          )}
        </div>
      </section>
    </div>
  );
}

```

---
### app\routes\changelog.tsx
```tsx
// app/routes/changelog.tsx
import type { LoaderFunctionArgs } from "react-router";
import { useLoaderData, Link } from "react-router";
import { loadChangelogItems, type ChangelogItem } from "../lib/changelog.server";

export async function loader(args: LoaderFunctionArgs) {
  return loadChangelogItems(args);
}


function Tag({ t }: { t?: ChangelogItem["tag"] }) {
  const map = { add: "新增", fix: "修正", change: "變更", docs: "文件" } as const;
  return t ? <span className="chip">{map[t]}</span> : null;
}

export default function ChangelogPage() {
  const items = useLoaderData() as ChangelogItem[];
  return (
    <main className="mx-auto max-w-3xl px-4 py-12">
      <header className="mb-8">
        <h1 className="text-3xl font-bold">更新日誌</h1>
        {import.meta.env.DEV ? (
          <p className="mt-2 text-neutral-600">
            開發模式即時讀取檔案（app/content/changelog/）
          </p>
        ) : (
          <p className="mt-2 text-neutral-600">靜態內容（build 時打包）</p>
        )}
        <p className="mt-2"><Link to="/" className="link-soft">回首頁</Link></p>
      </header>

      <div className="space-y-4">
        {items.map((log, i) => (
          <article key={(log.filename ?? "") + i} className="card hover-raise">
            <div className="flex items-center gap-3 text-sm text-neutral-600">
              <time dateTime={log.date} className="font-medium text-neutral-800">{log.date}</time>
              <Tag t={log.tag} />
            </div>
            <h2 className="mt-2 text-lg font-semibold">{log.title}</h2>
            {log.notes?.length ? (
              <ul className="mt-2 list-disc pl-5 text-sm text-neutral-700 space-y-1">
                {log.notes.map((n, j) => <li key={j}>{n}</li>)}
              </ul>
            ) : null}
            {import.meta.env.DEV && log.filename ? (
              <p className="mt-2 text-xs text-neutral-400">{log.filename}</p>
            ) : null}
          </article>
        ))}
        {!items.length && (
          <p className="text-neutral-500">目前沒有日誌。到後台新增一筆試試。</p>
        )}
      </div>
    </main>
  );
}

```
## Root: D:\CloudflarePage\react-router-starter\toolbelt
### 檔案清單（相對 D:\CloudflarePage\react-router-starter\）
toolbelt\admin\admin.css
toolbelt\admin\admin.js
toolbelt\index.ts

---
### toolbelt\admin\admin.css
```css
:root{--bg:#faf8f6;--fg:#111;--muted:#666;--line:#e5e5e5;--sidebar-width:280px}
*{box-sizing:border-box}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;line-height:1.5;margin:0;background:var(--bg);color:var(--fg)}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:12px 16px;z-index:10}
.wrap{max-width:1200px;margin:0 auto;padding:16px}
nav{display:flex;gap:8px;flex-wrap:wrap}
a.btn,button.btn{padding:8px 14px;border-radius:999px;border:1px solid #111;background:#111;color:#fff;text-decoration:none;cursor:pointer;transition:transform .15s,box-shadow .15s,font-size .15s}
.btn.ghost{background:#fff;color:#111;border-color:#ccc}
.btn.danger{background:#d92d20;border-color:#d92d20}
.btn.small{font-size:12px;padding:6px 12px}
.btn:active{transform:translateY(1px)}
.btn:focus-visible{outline:2px solid #111;outline-offset:2px}
.card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px}
.cms-layout{display:grid;grid-template-columns:var(--sidebar-width) minmax(0,1fr);gap:20px;align-items:start}
.sidebar{display:flex;flex-direction:column;gap:16px;position:sticky;top:80px;max-height:calc(100vh - 120px);overflow:auto}
.sidebar-section{display:flex;flex-direction:column;gap:12px}
.section-header{display:flex;align-items:center;justify-content:space-between;gap:8px}
label span{display:block;font-size:12px;color:#555;margin-bottom:4px}
input,select,textarea{width:100%;padding:8px;border:1px solid var(--line);border-radius:8px;background:#fff;font:inherit}
textarea{resize:vertical;min-height:120px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.muted{color:var(--muted);font-size:12px}
.category-tree{display:flex;flex-direction:column;gap:12px}
.category-group{border:1px solid var(--line);border-radius:10px;padding:10px}
.category-header{display:flex;align-items:flex-start;justify-content:space-between;gap:8px}
.category-actions{display:flex;flex-wrap:wrap;gap:6px;justify-content:flex-end}
.icon-btn{background:none;border:none;padding:0;color:#555;font-size:12px;cursor:pointer}
.icon-btn:hover{text-decoration:underline}
.category-pill,.subcategory-pill{border:1px solid transparent;background:transparent;padding:4px 10px;border-radius:999px;font-size:13px;cursor:pointer;color:#444}
.category-pill.active,.subcategory-pill.active{border-color:#111;background:#111;color:#fff}
.subcategory-list{margin-top:8px;display:flex;flex-direction:column;gap:6px;font-size:13px}
.subcategory-row{display:flex;align-items:center;gap:8px;justify-content:space-between}
.list-scroll{max-height:320px;overflow:auto;padding-right:4px}
.list .item{display:flex;justify-content:space-between;gap:12px;padding:10px 0;border-bottom:1px solid var(--line)}
.list-card .list-actions{display:flex;gap:6px;flex-shrink:0}
.list-title{font-weight:600;margin-bottom:2px}
.editor-panel{display:flex;flex-direction:column;gap:20px}
.editor-section{display:flex;flex-direction:column;gap:16px}
.editor-actions{display:flex;gap:10px;flex-wrap:wrap}
@media (max-width:1000px){.cms-layout{grid-template-columns:1fr} .sidebar{position:static;max-height:none} .row{grid-template-columns:1fr}}

```

---
### toolbelt\admin\admin.js
```js
// toolbelt/admin/admin.js
window.Admin = (function () {
  const state = { key: "" };

  async function initKey() {
    if (state.key) return state.key;
    const res = await fetch("/key");
    if (!res.ok) throw new Error("no key");
    const { key } = await res.json();
    state.key = key;
    return key;
  }

  async function api(path, opt = {}) {
    await initKey();
    const res = await fetch(path, {
      method: opt.method || "GET",
      headers: {
        "content-type": "application/json",
        "x-toolbelt-key": state.key,
      },
      body: opt.body ? JSON.stringify(opt.body) : undefined,
    });
    if (!res.ok) throw new Error(await res.text());
    const ct = res.headers.get("content-type") || "";
    return ct.includes("application/json") ? res.json() : res.text();
  }

  function today() {
    return new Date().toISOString().slice(0, 10);
  }
  function slugify(s) {
    return (s || "")
      .trim()
      .toLowerCase()
      .replace(/[\s_]+/g, "-")
      .replace(/[^a-z0-9\-]+/g, "")
      .replace(/-+/g, "-")
      .replace(/^-+|-+$/g, "");
  }

  return { api, today, slugify };
})();


```

---
### toolbelt\index.ts
```ts
// toolbelt/index.ts
import express from "express";
import { join, dirname, resolve } from "node:path";
import { fileURLToPath } from "node:url";
import { existsSync, mkdirSync, writeFileSync, readFileSync, readdirSync, rmSync } from "node:fs";
import { spawnSync } from "node:child_process"; // for git use

const app = express();
const PORT = 43210;
const HOST = "127.0.0.1";
const TOOLBELT_KEY = Math.random().toString(36).slice(2);

function runCmd(cmd: string, args: string[] = []) {
  const result = spawnSync(cmd, args, {
    cwd: REPO,
    shell: false,          // for git use
    encoding: "utf8",
  });
  return {
    code: result.status,
    stdout: result.stdout,
    stderr: result.stderr,
  };
}

function slugify(value: string, fallbackPrefix = "item") {
  const base = (value || "")
    .toString()
    .trim()
    .normalize("NFKD")
    .replace(/[\u0300-\u036f]/g, "")
    .toLowerCase()
    .replace(/[\s_]+/g, "-")
    .replace(/[^a-z0-9\-]+/g, "")
    .replace(/-+/g, "-")
    .replace(/^-+|-+$/g, "");
  if (base) return base;
  const rand = Math.random().toString(36).slice(2, 8);
  return `${fallbackPrefix}-${Date.now().toString(36)}-${rand}`;
}



app.use(express.json({ limit: "2mb" }));

// CORS（本機開發）
app.use((req, res, next) => {
  res.setHeader("Access-Control-Allow-Origin", "*");
  res.setHeader("Access-Control-Allow-Headers", "content-type, x-toolbelt-key");
  res.setHeader("Access-Control-Allow-Methods", "GET,POST,PUT,DELETE,OPTIONS");
  if (req.method === "OPTIONS") return res.sendStatus(204);
  next();
});

const __dirname = dirname(fileURLToPath(import.meta.url));
const REPO = resolve(__dirname, "..");
const CHANGELOG_DIR = resolve(REPO, "app/content/changelog");
const BLOG_DIR = resolve(REPO, "app/content/blog");
const BLOG_CATEGORIES_FILE = resolve(BLOG_DIR, "categories.json");
const BLOG_POSTS_DIR = resolve(BLOG_DIR, "posts");
const BLOG_POST_NAME_RE = /^[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-z0-9\-]+\.json$/i;

// 基礎
app.get("/", (_req, res) => res.json({ ok: true, message: "Toolbelt is running!" }));
app.get("/key", (_req, res) => res.json({ key: TOOLBELT_KEY }));

// Admin 靜態站（本機後台）
app.use("/admin", express.static(join(__dirname, "admin"), { extensions: ["html"] }));
app.use((req, res, next) => { res.setHeader("X-Frame-Options", "DENY"); res.setHeader("Referrer-Policy", "no-referrer"); next(); });

// 授權保護（/admin 與 /key 除外）
app.use((req, res, next) => {
  if (req.path.startsWith("/admin") || req.path === "/key" || req.path === "/") return next();
  if (req.headers["x-toolbelt-key"] !== TOOLBELT_KEY) return res.status(401).send("Unauthorized");
  next();
});
// ── Git 操作 API ──
app.post("/ops/git/commit-push", (req, res) => {
  const { message } = req.body as { message?: string };

  if (!message || !message.trim()) {
    return res.status(400).json({ ok: false, error: "commit message 必填" });
  }

  // 先記錄現在狀態（純資訊用）
  const statusBefore = runCmd("git", ["status", "--short"]);

  // 1) git add -A
  const add = runCmd("git", ["add", "-A"]);
  if (add.code !== 0) {
    return res.status(500).json({
      ok: false,
      step: "add",
      stdout: add.stdout,
      stderr: add.stderr,
    });
  }

  // 2) git commit -m "<message>"
  const commit = runCmd("git", ["commit", "-m", message]);
  const commitOut = (commit.stdout || "") + (commit.stderr || "");
  const nothingToCommit = /nothing to commit/i.test(commitOut);

  // 如果真的「完全沒東西可以 commit」，這不是錯誤，可以照樣回 ok:true
  // 只是之後 push 多半也沒東西
  let pushResult: { code: number; stdout: string; stderr: string } | null = null;
  let pushed = false;

  if (!nothingToCommit) {
    // 有東西要 commit，結果 code 不是 0 → 真正錯誤，直接回
    if (commit.code !== 0) {
      return res.status(500).json({
        ok: false,
        step: "commit",
        stdout: commit.stdout,
        stderr: commit.stderr,
      });
    }

    // 3) git push（只有在有新 commit 的時候才推）
    const push = runCmd("git", ["push"]);
    pushResult = push;

    if (push.code !== 0) {
      return res.status(500).json({
        ok: false,
        step: "push",
        stdout: push.stdout,
        stderr: push.stderr,
      });
    }

    pushed = true;
  }

  const statusAfter = runCmd("git", ["status", "--short"]);

  return res.json({
    ok: true,
    nothingToCommit,
    pushed,
    statusBefore: statusBefore.stdout,
    statusAfter: statusAfter.stdout,
    commit: {
      code: commit.code,
      stdout: commit.stdout,
      stderr: commit.stderr,
    },
    push: pushResult && {
      code: pushResult.code,
      stdout: pushResult.stdout,
      stderr: pushResult.stderr,
    },
  });
});


// ── Changelog 檔案式 CRUD ──
const NAME_RE = /^[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-z0-9\-]+\.json$/i;
function ensureDir() { if (!existsSync(CHANGELOG_DIR)) mkdirSync(CHANGELOG_DIR, { recursive: true }); }
function filePath(name: string) {
  if (!NAME_RE.test(name)) throw new Error("Invalid filename");
  const full = resolve(CHANGELOG_DIR, name);
  if (!full.startsWith(CHANGELOG_DIR)) throw new Error("Path traversal");
  return full;
}
function validateData(d: any) {
  if (!d || typeof d !== "object") throw new Error("Invalid body");
  if (typeof d.date !== "string" || !/^\d{4}-\d{2}-\d{2}$/.test(d.date)) throw new Error("date must be YYYY-MM-DD");
  if (typeof d.title !== "string" || !d.title.trim()) throw new Error("title required");
  if (d.notes && (!Array.isArray(d.notes) || !d.notes.every((s: any) => typeof s === "string"))) throw new Error("notes must be string[]");
  if (d.tag && !["add","fix","change","docs"].includes(d.tag)) throw new Error("tag invalid");
}

function ensureBlogStructure() {
  if (!existsSync(BLOG_DIR)) mkdirSync(BLOG_DIR, { recursive: true });
  if (!existsSync(BLOG_POSTS_DIR)) mkdirSync(BLOG_POSTS_DIR, { recursive: true });
  if (!existsSync(BLOG_CATEGORIES_FILE)) {
    writeFileSync(BLOG_CATEGORIES_FILE, JSON.stringify({ categories: [] }, null, 2) + "\n", "utf8");
  }
}

function readBlogCategoriesFile() {
  ensureBlogStructure();
  try {
    const raw = readFileSync(BLOG_CATEGORIES_FILE, "utf8");
    const data = JSON.parse(raw);
    if (Array.isArray(data?.categories)) {
      return data.categories.map((cat: any) => ({
        id: cat.id,
        title: cat.title,
        description: cat.description,
        children: Array.isArray(cat.children) ? cat.children : [],
      }));
    }
  } catch {
    // ignore broken file
  }
  return [];
}

function writeBlogCategoriesFile(categories: any[]) {
  ensureBlogStructure();
  writeFileSync(BLOG_CATEGORIES_FILE, JSON.stringify({ categories }, null, 2) + "\n", "utf8");
}

function blogPostFullPath(name: string) {
  if (!BLOG_POST_NAME_RE.test(name)) throw new Error("invalid filename");
  const full = resolve(BLOG_POSTS_DIR, name);
  if (!full.startsWith(BLOG_POSTS_DIR)) throw new Error("path traversal");
  return full;
}

function readBlogPostsFile() {
  ensureBlogStructure();
  const items: any[] = [];
  if (!existsSync(BLOG_POSTS_DIR)) return items;
  const files = readdirSync(BLOG_POSTS_DIR).filter((f) => BLOG_POST_NAME_RE.test(f));
  for (const file of files) {
    try {
      const raw = readFileSync(resolve(BLOG_POSTS_DIR, file), "utf8");
      items.push({ ...(JSON.parse(raw) ?? {}), filename: file });
    } catch {
      // ignore broken file
    }
  }
  items.sort((a, b) => (a.publishedAt < b.publishedAt ? 1 : -1));
  return items;
}

function normalizeBlogPostInput(input: any, categories: any[], existing?: any) {
  if (!input || typeof input !== "object") throw new Error("invalid post");
  const title = (input.title ?? "").toString().trim();
  const body = (input.body ?? "").toString().trim();
  const categoryId = (input.categoryId ?? "").toString().trim();
  const subcategoryId = (input.subcategoryId ?? "").toString().trim();
  const publishedAtInput = input.publishedAt ?? new Date().toISOString();
  if (!title) throw new Error("title required");
  if (!body) throw new Error("body required");
  if (!categoryId) throw new Error("categoryId required");
  const category = categories.find((c) => c.id === categoryId);
  if (!category) throw new Error("找不到分類");
  let validatedSub: string | undefined;
  if (subcategoryId) {
    const subcat = category.children?.find((c: any) => c.id === subcategoryId);
    if (!subcat) throw new Error("子分類不存在");
    validatedSub = subcat.id;
  }
  const publishedAt = new Date(publishedAtInput);
  if (Number.isNaN(publishedAt.valueOf())) throw new Error("publishedAt invalid");
  const slugSource = (input.slug ?? title).toString();
  const slug = slugify(slugSource, "post");
  const now = new Date().toISOString();
  const createdAt = existing?.createdAt || input.createdAt || now;
  const updatedAt = now;
  return {
    title,
    body,
    categoryId: category.id,
    subcategoryId: validatedSub,
    publishedAt: publishedAt.toISOString(),
    slug,
    createdAt,
    updatedAt,
  };
}

app.get("/fs/changelog/list", (_req, res) => {
  ensureDir();
  const files = readdirSync(CHANGELOG_DIR).filter(f => NAME_RE.test(f)).sort((a,b)=>a<b?1:-1);
  const items = files.map(f => { const raw = readFileSync(join(CHANGELOG_DIR, f), "utf8"); return { filename: f, ...JSON.parse(raw) }; });
  res.json(items);
});

app.post("/fs/changelog/create", (req, res) => {
  ensureDir();
  try {
    const { data, slug } = req.body as { data: any; slug?: string };
    validateData(data);
    const s = (slug || data.title || "update").toString().trim().toLowerCase()
      .replace(/[\s_]+/g,"-").replace(/[^a-z0-9\-]+/g,"").replace(/\-+/g,"-").replace(/^\-+|\-+$/g,"");
    const name = `${data.date}-${s || "update"}.json`;
    writeFileSync(filePath(name), JSON.stringify(data, null, 2) + "\n", "utf8");
    res.json({ ok: true, filename: name });
  } catch (e: any) { res.status(400).send(e.message || String(e)); }
});

app.put("/fs/changelog/update", (req, res) => {
  ensureDir();
  try {
    const { filename, data } = req.body as { filename: string; data: any };
    if (!filename) throw new Error("filename required");
    validateData(data);
    const full = filePath(filename);
    if (!existsSync(full)) return res.status(404).send("file not found");
    writeFileSync(full, JSON.stringify(data, null, 2) + "\n", "utf8");
    res.json({ ok: true, filename });
  } catch (e: any) { res.status(400).send(e.message || String(e)); }
});

app.delete("/fs/changelog/delete", (req, res) => {
  ensureDir();
  try {
    const { filename } = req.body as { filename: string };
    if (!filename) throw new Error("filename required");
    const full = filePath(filename);
    if (!existsSync(full)) return res.status(404).send("file not found");
    rmSync(full);
    res.json({ ok: true, filename });
  } catch (e: any) { res.status(400).send(e.message || String(e)); }
});

// ── Blog 模組 CRUD ──
app.get("/fs/blog/categories", (_req, res) => {
  const categories = readBlogCategoriesFile();
  res.json({ categories });
});

app.post("/fs/blog/category", (req, res) => {
  try {
    const { parentId, title, description } = req.body as {
      parentId?: string;
      title?: string;
      description?: string;
    };
    const name = (title ?? "").toString().trim();
    if (!name) throw new Error("title required");
    const categories = readBlogCategoriesFile();
    const id = slugify(name, parentId ? "subcat" : "cat");
    if (!id) throw new Error("無法產生 slug");
    const desc = (description ?? "").toString().trim() || undefined;

    if (parentId) {
      const parent = categories.find((cat: any) => cat.id === parentId);
      if (!parent) return res.status(404).send("父分類不存在");
      if (parent.children.some((child: any) => child.id === id)) {
        throw new Error("子分類 slug 重複");
      }
      parent.children.push({ id, title: name, description: desc });
    } else {
      if (categories.some((cat: any) => cat.id === id)) throw new Error("分類 slug 重複");
      categories.push({ id, title: name, description: desc, children: [] });
    }

    writeBlogCategoriesFile(categories);
    res.json({ ok: true, id });
  } catch (e: any) {
    res.status(400).send(e.message || String(e));
  }
});

app.put("/fs/blog/category", (req, res) => {
  try {
    const { id, parentId, title, description } = req.body as {
      id?: string;
      parentId?: string;
      title?: string;
      description?: string;
    };
    if (!id) throw new Error("id required");
    const categories = readBlogCategoriesFile();
    const name = (title ?? "").toString().trim();
    const desc = (description ?? "").toString().trim() || undefined;
    if (parentId) {
      const parent = categories.find((cat: any) => cat.id === parentId);
      if (!parent) return res.status(404).send("父分類不存在");
      const child = parent.children.find((c: any) => c.id === id);
      if (!child) return res.status(404).send("子分類不存在");
      if (name) child.title = name;
      child.description = desc;
    } else {
      const category = categories.find((cat: any) => cat.id === id);
      if (!category) return res.status(404).send("分類不存在");
      if (name) category.title = name;
      category.description = desc;
    }
    writeBlogCategoriesFile(categories);
    res.json({ ok: true, id });
  } catch (e: any) {
    res.status(400).send(e.message || String(e));
  }
});

app.delete("/fs/blog/category", (req, res) => {
  try {
    const { id, parentId } = req.body as { id?: string; parentId?: string };
    if (!id) throw new Error("id required");
    const categories = readBlogCategoriesFile();
    const posts = readBlogPostsFile();
    if (parentId) {
      if (posts.some((post: any) => post.subcategoryId === id)) {
        return res.status(400).send("仍有文章屬於此子分類");
      }
      const parent = categories.find((cat: any) => cat.id === parentId);
      if (!parent) return res.status(404).send("父分類不存在");
      parent.children = parent.children.filter((child: any) => child.id !== id);
    } else {
      if (posts.some((post: any) => post.categoryId === id)) {
        return res.status(400).send("仍有文章屬於此分類");
      }
      const next = categories.filter((cat: any) => cat.id !== id);
      if (next.length === categories.length) return res.status(404).send("分類不存在");
      writeBlogCategoriesFile(next);
      return res.json({ ok: true, id });
    }
    writeBlogCategoriesFile(categories);
    res.json({ ok: true, id });
  } catch (e: any) {
    res.status(400).send(e.message || String(e));
  }
});

app.get("/fs/blog/posts", (_req, res) => {
  const posts = readBlogPostsFile();
  res.json({ posts });
});

app.post("/fs/blog/post", (req, res) => {
  try {
    const { post } = req.body as { post?: any };
    if (!post) throw new Error("post payload required");
    const categories = readBlogCategoriesFile();
    const normalized = normalizeBlogPostInput(post, categories);
    ensureBlogStructure();
    const date = normalized.publishedAt.slice(0, 10);
    let filenameBase = `${date}-${normalized.slug}`;
    let filename = `${filenameBase}.json`;
    let counter = 1;
    while (existsSync(blogPostFullPath(filename))) {
      filename = `${filenameBase}-${counter++}.json`;
    }
    writeFileSync(blogPostFullPath(filename), JSON.stringify(normalized, null, 2) + "\n", "utf8");
    res.json({ ok: true, filename });
  } catch (e: any) {
    res.status(400).send(e.message || String(e));
  }
});

app.put("/fs/blog/post", (req, res) => {
  try {
    const { filename, post } = req.body as { filename?: string; post?: any };
    if (!filename) throw new Error("filename required");
    if (!post) throw new Error("post payload required");
    const full = blogPostFullPath(filename);
    if (!existsSync(full)) return res.status(404).send("找不到文章");
    const categories = readBlogCategoriesFile();
    let existingData: any = null;
    try {
      existingData = JSON.parse(readFileSync(full, "utf8"));
    } catch {
      existingData = null;
    }
    const normalized = normalizeBlogPostInput(post, categories, existingData || undefined);
    if (existingData?.createdAt) normalized.createdAt = existingData.createdAt;
    writeFileSync(full, JSON.stringify(normalized, null, 2) + "\n", "utf8");
    res.json({ ok: true, filename });
  } catch (e: any) {
    res.status(400).send(e.message || String(e));
  }
});

app.delete("/fs/blog/post", (req, res) => {
  try {
    const { filename } = req.body as { filename?: string };
    if (!filename) throw new Error("filename required");
    const full = blogPostFullPath(filename);
    if (!existsSync(full)) return res.status(404).send("找不到文章");
    rmSync(full);
    res.json({ ok: true, filename });
  } catch (e: any) {
    res.status(400).send(e.message || String(e));
  }
});

app.listen(PORT, HOST, () => {
  console.log(`[toolbelt] http://${HOST}:${PORT}`);
  console.log(`[toolbelt] key: ${TOOLBELT_KEY}`);
  console.log(`[toolbelt] repo: ${REPO}`);
});

```

---
Generated with UTF-8 to avoid mojibake.
